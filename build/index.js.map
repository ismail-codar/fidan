{"version":3,"file":"index.js","sources":["../src/evented-array.ts","../src/f.ts","../src/reuse-nodes.ts","../src/dom.ts","../src/util.ts","../src/html.ts","../src/observable.ts","../src/index.ts"],"sourcesContent":["export type ArrayMutableMethods =\n  | \"copyWithin\" // TODO ArrayMutableMethods copyWithin\n  | \"fill\" // TODO ArrayMutableMethods fill\n  | \"pop\"\n  | \"push\"\n  | \"reverse\" // TODO ArrayMutableMethods reverse\n  | \"shift\"\n  | \"sort\" // TODO ArrayMutableMethods sort\n  | \"splice\"\n  | \"unshift\";\n\n// TODO concat vs..\n\nexport function EventedArray(items) {\n  var _self = this,\n    _array = [];\n\n  _self._handlers = {\n    itemadded: [],\n    itemremoved: [],\n    itemset: [],\n    beforemulti: [],\n    aftermulti: []\n  };\n\n  function defineIndexProperty(index) {\n    if (!(index in _self)) {\n      Object.defineProperty(_self, index, {\n        configurable: true,\n        enumerable: true,\n        get: function() {\n          return _array[index];\n        },\n        set: function(v) {\n          _array[index] = v;\n          raiseEvent({\n            type: \"itemset\",\n            index: index,\n            item: v\n          });\n        }\n      });\n    }\n  }\n\n  function raiseEvent(event) {\n    _self._handlers[event.type].forEach(function(h) {\n      h.call(_self, event);\n    });\n  }\n\n  _self.on = function(eventName, handler) {\n    _self._handlers[eventName].push(handler);\n  };\n\n  _self.off = function(eventName, handler) {\n    var h = _self._handlers[eventName];\n    var ln = h.length;\n    while (--ln >= 0) {\n      if (h[ln] === handler) {\n        h.splice(ln, 1);\n      }\n    }\n  };\n\n  _self.push = function() {\n    var index;\n    arguments.length > 1 &&\n      raiseEvent({\n        type: \"beforemulti\"\n      });\n    for (var i = 0, ln = arguments.length; i < ln; i++) {\n      index = _array.length;\n      _array.push(arguments[i]);\n      defineIndexProperty(index);\n      raiseEvent({\n        type: \"itemadded\",\n        index: index,\n        item: arguments[i]\n      });\n    }\n    arguments.length > 1 &&\n      raiseEvent({\n        type: \"aftermulti\"\n      });\n    return _array.length;\n  };\n\n  _self.pop = function() {\n    if (_array.length > -1) {\n      var index = _array.length - 1,\n        item = _array.pop();\n      delete _self[index];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: index,\n        item: item\n      });\n      return item;\n    }\n  };\n\n  _self.unshift = function() {\n    for (var i = 0, ln = arguments.length; i < ln; i++) {\n      _array.splice(i, 0, arguments[i]);\n      defineIndexProperty(_array.length - 1);\n      raiseEvent({\n        type: \"itemadded\",\n        index: i,\n        item: arguments[i]\n      });\n    }\n    for (; i < _array.length; i++) {\n      raiseEvent({\n        type: \"itemset\",\n        index: i,\n        item: _array[i]\n      });\n    }\n    return _array.length;\n  };\n\n  _self.shift = function() {\n    if (_array.length > -1) {\n      var item = _array.shift();\n      delete _self[_array.length];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: 0,\n        item: item\n      });\n      return item;\n    }\n  };\n\n  _self.splice = function(index, howMany /*, element1, element2, ... */) {\n    var removed = [],\n      item,\n      pos;\n\n    index = index == null ? 0 : index < 0 ? _array.length + index : index;\n\n    howMany =\n      howMany == null ? _array.length - index : howMany > 0 ? howMany : 0;\n\n    while (howMany--) {\n      item = _array.splice(index, 1)[0];\n      removed.push(item);\n      delete _self[_array.length];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: index + removed.length - 1,\n        item: item\n      });\n    }\n\n    for (var i = 2, ln = arguments.length; i < ln; i++) {\n      _array.splice(index, 0, arguments[i]);\n      defineIndexProperty(_array.length - 1);\n      raiseEvent({\n        type: \"itemadded\",\n        index: index,\n        item: arguments[i]\n      });\n      index++;\n    }\n\n    return removed;\n  };\n\n  Object.defineProperty(_self, \"length\", {\n    configurable: false,\n    enumerable: false,\n    get: function() {\n      return _array.length;\n    },\n    set: function(value) {\n      var n = Number(value);\n      var length = _array.length;\n      if (n % 1 === 0 && n >= 0) {\n        if (n < length) {\n          _self.splice(n);\n        } else if (n > length) {\n          _self.push.apply(_self, new Array(n - length));\n        }\n      } else {\n        throw new RangeError(\"Invalid array length\");\n      }\n      _array.length = n;\n      return value;\n    }\n  });\n\n  Object.defineProperty(_self, \"innerArray\", {\n    configurable: false,\n    enumerable: false,\n    get: function() {\n      return _array;\n    },\n    set: function(v) {\n      _array = v;\n      for (var i = 0; i < v.length; i++) {\n        defineIndexProperty(i);\n      }\n    }\n  });\n\n  Object.getOwnPropertyNames(Array.prototype).forEach(function(name) {\n    if (!(name in _self)) {\n      Object.defineProperty(_self, name, {\n        configurable: false,\n        enumerable: false,\n        writable: false,\n        value: Array.prototype[name]\n      });\n    }\n  });\n\n  _self.setEventsFrom = function(val) {\n    _self.on = val.on;\n    _self.off = val.off;\n    _self._handlers = val._handlers;\n  };\n\n  _self.toJSON = () => {\n    return _array;\n  };\n\n  if (Array.isArray(items)) {\n    _self.push.apply(_self, items);\n  }\n}\n","import { EventedArray } from \"./evented-array\";\r\nimport { FidanArray, FidanValue, FidanData } from \".\";\r\n\r\nlet autoTrackDependencies: any[] = null;\r\n\r\nexport const array = <T>(items: T[]): FidanArray<T> => {\r\n  const arr = value(new EventedArray(items)) as FidanArray<T>;\r\n  arr[\"toJSON\"] = () => arr.$val.innerArray;\r\n\r\n  arr.size = value(items.length);\r\n\r\n  arr.$val.on(\"itemadded\", () => arr.size(arr.$val.innerArray.length));\r\n  arr.$val.on(\"itemremoved\", () => arr.size(arr.$val.innerArray.length));\r\n\r\n  return arr;\r\n};\r\n\r\nexport const value = <T>(val?: T): FidanValue<T> => {\r\n  const innerFn: any = (val?) => {\r\n    if (val === undefined) {\r\n      if (\r\n        autoTrackDependencies &&\r\n        autoTrackDependencies.indexOf(innerFn) === -1\r\n      ) {\r\n        autoTrackDependencies.push(innerFn);\r\n      }\r\n      return innerFn[\"$val\"];\r\n    } else {\r\n      if (Array.isArray(val)) {\r\n        val = new EventedArray(val.slice(0));\r\n        val.setEventsFrom(innerFn[\"$val\"]);\r\n      } else if (val && val.hasOwnProperty(\"innerArray\")) {\r\n        // val.innerArray = val.innerArray.slice(0); array reuseMode !!!\r\n        var arr = new EventedArray(val.innerArray.slice(0));\r\n        arr.setEventsFrom(val);\r\n        val = arr;\r\n      }\r\n      let depends = innerFn[\"bc_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i].beforeCompute(val, innerFn[\"$val\"], innerFn);\r\n        }\r\n      innerFn[\"$val\"] = val;\r\n      depends = innerFn[\"c_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i](depends[i].compute(val));\r\n        }\r\n\r\n      if (val && val.hasOwnProperty(\"innerArray\")) {\r\n        innerFn.size && innerFn.size(val.innerArray.length);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (Array.isArray(val)) {\r\n    val = new EventedArray(val.slice(0));\r\n  } else if (val && val.hasOwnProperty(\"innerArray\")) {\r\n    val = new EventedArray(val[\"innerArray\"].slice(0));\r\n  }\r\n  innerFn[\"$val\"] = val;\r\n  innerFn[\"bc_depends\"] = [];\r\n  innerFn[\"c_depends\"] = [];\r\n  innerFn.depends = (dependencies: () => FidanData<any>[]): FidanValue<T> => {\r\n    const deps = dependencies();\r\n    for (var i = 0; i < deps.length; i++) innerFn[\"c_depends\"].push(deps[i]);\r\n    return innerFn;\r\n  };\r\n  innerFn.debugName = (name: string) => {\r\n    Object.defineProperty(innerFn, \"name\", { value: name });\r\n    return innerFn;\r\n  };\r\n  innerFn.toString = innerFn.toJSON = () => innerFn[\"$val\"];\r\n  return innerFn;\r\n};\r\n\r\nexport const compute = <T>(\r\n  fn: (val: T, changedItem?) => any,\r\n  dependencies?: () => FidanData<any>[]\r\n) => {\r\n  autoTrackDependencies = dependencies ? null : [];\r\n  const val = fn(undefined);\r\n  const deps = autoTrackDependencies ? autoTrackDependencies : dependencies();\r\n  autoTrackDependencies = null;\r\n  const cmp = value(val);\r\n  cmp[\"compute\"] = fn;\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"c_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const beforeCompute = <T>(\r\n  initalValue: T,\r\n  fn: (nextValue?: T, prevValue?: T, changedItem?) => void,\r\n  dependencies: () => FidanData<any>[]\r\n) => {\r\n  const cmp = value(fn(initalValue));\r\n  cmp[\"beforeCompute\"] = fn;\r\n  const deps = dependencies();\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"bc_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const destroy = (item: any) => {\r\n  delete item[\"compute\"];\r\n  delete item[\"c_depends\"];\r\n};\r\n","// https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) => {\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n  if (renderedValues.length > data.length) {\n    let i = renderedValues.length,\n      tail =\n        afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n      tmp;\n    while (i > data.length) {\n      tmp = tail.previousSibling;\n      parent.removeChild(tail);\n      tail = tmp;\n      i--;\n    }\n  }\n\n  let _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n  if (_head === afterNode) _head = undefined;\n\n  let _mode = afterNode ? 1 : 0;\n  for (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n    item = data[i];\n    if (head) {\n      noOp(item, renderedValues[i]);\n    } else {\n      head = createFn(item);\n      mode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n    }\n    head = head.nextSibling;\n    if (head === afterNode) head = null;\n  }\n};\n","import { beforeCompute, compute } from \"./f\";\nimport { reuseNodes } from \"./reuse-nodes\";\nimport { FidanArray, FidanData } from \".\";\n\nexport const coditionalDom = (\n  condition: () => boolean,\n  dependencies: () => FidanData<any>[],\n  htmlFragment: DocumentFragment\n) => (parentElement: Element, nextElement: Element) => {\n  const childs = Array.from(htmlFragment.children);\n  let inserted = false;\n  compute(() => {\n    if (condition()) {\n      if (!inserted) {\n        let tmpNextElement = nextElement;\n        for (var i = childs.length - 1; i >= 0; i--) {\n          const child = childs[i];\n          tmpNextElement = parentElement.insertBefore(child, tmpNextElement);\n        }\n        inserted = true;\n      }\n    } else {\n      childs.forEach(child => child.remove());\n      inserted = false;\n    }\n  }, dependencies);\n};\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n  const typeOf = typeof itemElement;\n  if (typeOf === \"function\") {\n    itemElement(parentElement);\n  } else {\n    if (typeOf !== \"object\") {\n      itemElement = document.createTextNode(itemElement);\n    }\n    parentElement.insertBefore(itemElement, parentElement.children[index]);\n  }\n};\n\nexport const arrayMap = <T>(\n  arr: FidanArray<T>,\n  parentDom: Node & ParentNode,\n  nextElement: Element,\n  renderReturn: (item: any, idx?: number, isInsert?: boolean) => Node,\n  reuseMode?: boolean\n) => {\n  let parentRef: { parent: Node & ParentNode; next: Node } = null;\n  arr.$val.on(\"beforemulti\", function() {\n    if (parentDom.parentNode) {\n      parentRef = {\n        parent: parentDom,\n        next: (parentDom as Element).nextElementSibling\n      };\n      parentDom = document.createDocumentFragment();\n    }\n  });\n  arr.$val.on(\"aftermulti\", function() {\n    if (parentRef) {\n      parentRef.parent.insertBefore(parentDom, parentRef.next);\n      parentDom = parentRef.parent;\n    }\n  });\n\n  arr.$val.on(\"itemadded\", function(e) {\n    insertToDom(parentDom, e.index, renderReturn(e.item, e.index));\n  });\n\n  arr.$val.on(\"itemset\", function(e) {\n    parentDom.replaceChild(\n      renderReturn(e.item, e.index) as any,\n      parentDom.children.item(e.index)\n    );\n  });\n\n  arr.$val.on(\"itemremoved\", function(e) {\n    parentDom.removeChild(parentDom.children.item(e.index));\n  });\n\n  let firstRenderOnFragment = undefined;\n  const arrayComputeRenderAll = function(nextVal) {\n    if (!reuseMode) {\n      const parentFragment = document.createDocumentFragment();\n      parentDom.textContent = \"\";\n      for (var i = 0; i < nextVal.length; i++) {\n        parentFragment.appendChild(renderReturn(nextVal[i]));\n      }\n      parentDom.appendChild(parentFragment);\n    } else {\n      if (firstRenderOnFragment === undefined && nextVal && nextVal.length > 0)\n        firstRenderOnFragment = document.createDocumentFragment();\n      reuseNodes(\n        firstRenderOnFragment || parentDom,\n        arr.$val.innerArray,\n        nextVal || [],\n        nextItem => {\n          return renderReturn(nextItem);\n        },\n        (nextItem, prevItem) => {\n          for (var key in nextItem) {\n            if (prevItem[key].hasOwnProperty(\"$val\")) {\n              nextItem[key].c_depends = prevItem[key].c_depends;\n              nextItem[key].bc_depends = prevItem[key].bc_depends;\n              prevItem[key](nextItem[key]());\n            }\n          }\n        }\n      );\n      if (firstRenderOnFragment) {\n        parentDom.appendChild(firstRenderOnFragment);\n        firstRenderOnFragment = null;\n      }\n    }\n  };\n\n  beforeCompute(arr.$val, arrayComputeRenderAll, () => [arr]);\n};\n","import { value } from \"./f\";\n\nexport const setDefaults = <T>(\n  obj: T,\n  defaults: { [key in keyof T]?: any }\n) => {\n  for (var key in defaults) {\n    if (obj[key] === undefined) obj[key] = defaults[key];\n  }\n};\n\nexport const mapProperty = (obj: Object, propertyKey: string, value$: any) => {\n  const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n  if (descr.configurable)\n    Object.defineProperty(obj, propertyKey, {\n      configurable: false,\n      enumerable: true,\n      get: () => {\n        return value$.$val;\n      },\n      set: value$\n    });\n  else {\n    descr.set[\"depends\"].push(\n      value(() => {\n        value$(obj[propertyKey]);\n      })\n    );\n  }\n};\n\nexport const jsRoot = () => {\n  let root;\n\n  if (typeof self !== \"undefined\") {\n    root = self;\n  } else if (typeof window !== \"undefined\") {\n    root = window;\n  } else if (typeof global !== \"undefined\") {\n    root = global;\n  } else if (typeof module !== \"undefined\") {\n    root = module;\n  } else {\n    root = Function(\"return this\")();\n  }\n  return root;\n};\n","import { compute } from \"./f\";\nimport { arrayMap } from \"./dom\";\nimport { FidanArray } from \".\";\n\nconst COMMENT_TEXT = 1;\nconst COMMENT_DOM = 2;\nconst COMMENT_FN = 4; // \"function\" && !isDynamic\nconst COMMENT_HTM = 8;\nconst COMMENT_TEXT_OR_DOM = COMMENT_TEXT | COMMENT_DOM;\n\nconst htmlProps = {\n  id: true,\n  nodeValue: true,\n  textContent: true,\n  className: true,\n  innerHTML: true,\n  innerText: true,\n  tabIndex: true,\n  value: true,\n  checked: true,\n  disabled: true,\n  readonly: true,\n  contentEditable: true\n};\n\nlet _templateMode = false; // TODO kaldırılacak yerine başka bir yöntem geliştirilecek\nlet template = document.createElement(\"template\");\n\nconst isPromise = (obj): obj is Promise<any> => {\n  return (\n    !!obj &&\n    (typeof obj === \"object\" || typeof obj === \"function\") &&\n    typeof obj.then === \"function\"\n  );\n};\n\nconst putCommentToTagStart = (\n  htm: string[],\n  index: number,\n  comment: string\n) => {\n  for (var i = index; i >= 0; i--) {\n    let item = htm[i];\n    let p = item.lastIndexOf(\"<\");\n    if (p !== -1) {\n      htm[i] = item.substr(0, p) + comment + item.substr(p);\n      // htm[i] =\n      //   item.substr(0, p) + comment + item.substr(p, item.lastIndexOf(\" \") - p);\n      // if (htm[index + 1].substr(0, 1) === '\"') {\n      //   htm[index + 1] = htm[index + 1].substr(1);\n      // }\n      break;\n    }\n  }\n};\n\nexport const html = (...args) => {\n  const htm: string[] = args[0].slice();\n  const params = args.slice(1);\n  let attributeName: string = null;\n  let i = 0;\n\n  for (var index = 0; index < htm.length; index++) {\n    let item = htm[index];\n    const param = params[index];\n    if (param === undefined) {\n      break;\n    }\n    const isDynamic = param.hasOwnProperty(\"$val\");\n    if (isDynamic) {\n      if (param[\"$indexes\"] === undefined) {\n        param[\"$indexes\"] = [];\n      }\n      param[\"$indexes\"].push(index);\n    }\n    if (item.endsWith('=\"')) {\n      i = item.lastIndexOf(\" \") + 1;\n      attributeName = item.substr(i, item.length - i - 2);\n      putCommentToTagStart(\n        htm,\n        index,\n        `<!-- cmt_${COMMENT_DOM}_${index}_${attributeName} -->`\n      );\n    } else {\n      let commentType =\n        typeof param === \"function\" && !isDynamic\n          ? COMMENT_FN\n          : typeof param === \"object\"\n          ? COMMENT_HTM\n          : COMMENT_TEXT;\n      htm[index] = item + `<!-- cmt_${commentType}_${index} -->`;\n    }\n  }\n  template = template.cloneNode(false) as HTMLTemplateElement;\n  template.innerHTML = htm.join(\"\");\n  /**    \n    .replace(/\\n/g, \"\")\n    .replace(/  /g, \" \")\n    .replace(/  /g, \"\")\n    .replace(/> /g, \">\")\n    .replace(/ </g, \"<\");\n     */\n  const element = template.content;\n  element[\"$params\"] = params;\n  if (!_templateMode) {\n    var commentNodes = [];\n    walkForCommentNodes(element, commentNodes);\n    updateNodesByCommentNodes(commentNodes, params);\n  }\n  return element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n  var treeWalker = document.createTreeWalker(\n    element,\n    NodeFilter.SHOW_COMMENT,\n    {\n      acceptNode: function(node) {\n        var nodeValue = node.nodeValue.trim();\n        return nodeValue.startsWith(\"cmt_\")\n          ? NodeFilter.FILTER_ACCEPT\n          : NodeFilter.FILTER_REJECT;\n      }\n    },\n    false\n  );\n\n  while (treeWalker.nextNode()) {\n    commentNodes.push(treeWalker.currentNode);\n  }\n};\n\nconst updateNodesByCommentNodes = (commentNodes: Comment[], params: any[]) => {\n  for (var i = 0; i < commentNodes.length; i++) {\n    const commentNode = commentNodes[i];\n    var commentValue = commentNode.nodeValue;\n    let element = null;\n    let attributeName: string = null;\n\n    let i1 = commentValue.indexOf(\"_\") + 1;\n    var i2 = commentValue.indexOf(\"_\", i1);\n    const commentType = parseInt(commentValue.substr(i1, i2 - i1));\n    i1 = commentValue.indexOf(\"_\", i2) + 1;\n    i2 = commentValue.indexOf(\"_\", i1);\n    if (i2 === -1) {\n      i2 = commentValue.indexOf(\" \", i1);\n    }\n    let paramIndex = parseInt(commentValue.substr(i1, i2 - i1));\n    let param = params[paramIndex];\n\n    if (commentType & COMMENT_TEXT_OR_DOM) {\n      if (commentType === COMMENT_TEXT) {\n        attributeName = \"textContent\";\n        element = document.createTextNode(param.$val);\n        commentNode.parentElement.insertBefore(\n          element,\n          commentNode.nextSibling\n        );\n        if (!param.hasOwnProperty(\"$val\")) {\n          if (Array.isArray(param)) {\n            for (var p = 0; p < param.length; p++) {\n              commentNode.parentElement.appendChild(param[p]);\n            }\n          }\n        }\n      } else if (commentType === COMMENT_DOM) {\n        attributeName = commentValue.substr(\n          i2 + 1,\n          commentValue.length - i2 - 2\n        );\n        element = commentNode.nextElementSibling;\n      }\n      // commentType !== COMMENT_FN && commentNode.remove();\n      if (attributeName.startsWith(\"on\")) {\n        (element as Element).addEventListener(attributeName.substr(2), param);\n      } else if (param.hasOwnProperty(\"$val\")) {\n        if (htmlProps[attributeName]) {\n          compute(\n            val => {\n              element[attributeName] = val;\n            },\n            () => [param]\n          );\n          element[attributeName] = param();\n        } else {\n          compute(\n            val => {\n              element.setAttribute(attributeName, val);\n            },\n            () => [param]\n          );\n          element.setAttribute(attributeName, param());\n        }\n      } else {\n        if (htmlProps[attributeName]) {\n          element[attributeName] = param;\n        } else if (typeof param === \"function\") {\n          param(element);\n        } else {\n          element.setAttribute(attributeName, param);\n        }\n      }\n    } else if (commentType === COMMENT_FN) {\n      if (commentNode.parentElement) {\n        param(commentNode.parentElement, commentNode.nextElementSibling);\n        // commentNode.remove();\n      } else {\n        //conditionalDom can be place on root\n        window.requestAnimationFrame(() => {\n          param(commentNode.parentElement, commentNode.nextElementSibling);\n          // commentNode.remove();\n        });\n      }\n    } else if (commentType === COMMENT_HTM) {\n      commentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n    }\n  }\n};\n\nexport const htmlArrayMap = <T>(\n  arr: FidanArray<T>,\n  renderCallback: (data: T) => DocumentFragment,\n  options?: {\n    useCloneNode: boolean;\n    reuseMode?: boolean;\n  }\n) => {\n  options = Object.assign({ useCloneNode: false, reuseMode: false }, options);\n  if (options.useCloneNode) {\n    return (parentElement: Element, nextElement: Element) => {\n      let clonedNode = null;\n      let params = null;\n      let dataParamIndexes = [];\n      // let commentNodesAddresses: number[][] = null;\n      const arrayMapFn = data => {\n        let renderNode = null;\n        var commentNodes = [];\n        if (clonedNode === null) {\n          _templateMode = true;\n          renderNode = renderCallback(data);\n          _templateMode = false;\n          params = renderNode[\"$params\"];\n          for (var key in data) {\n            const indexes = data[key][\"$indexes\"];\n            if (indexes)\n              for (var i = 0; i < indexes.length; i++) {\n                dataParamIndexes.push(indexes[i], key);\n              }\n          }\n          clonedNode = renderNode.cloneNode(true);\n          // walkForCommentNodes(clonedNode, commentNodes);\n          // commentNodesAddresses = generateCommentNodesAddresses(commentNodes);\n        } else {\n          renderNode = clonedNode.cloneNode(true);\n        }\n        for (var i = 0; i < dataParamIndexes.length; i += 2) {\n          params[dataParamIndexes[i]] = data[dataParamIndexes[i + 1]];\n        }\n        // generateCommentNodesFromAddresses(\n        //   commentNodesAddresses,\n        //   renderNode,\n        //   commentNodes\n        // );\n        walkForCommentNodes(renderNode, commentNodes);\n        updateNodesByCommentNodes(commentNodes, params);\n        return renderNode;\n      };\n      arrayMap(arr, parentElement, nextElement, arrayMapFn, options.reuseMode);\n    };\n  } else {\n    return function(parentElement: Element, nextElement: Element) {\n      arrayMap(arr as any, parentElement, nextElement, renderCallback);\n    };\n  }\n};\n\n// const generateCommentNodesAddresses = (commentNodes: Comment[]) => {\n//   const paths: number[][] = [];\n//   for (var i = 0; i < commentNodes.length; i++) {\n//     const path: number[] = [];\n//     let node = commentNodes[i] as Node & ChildNode;\n//     let parent = node.parentNode as Node & ParentNode;\n//     while (parent) {\n//       path.push(Array.from(parent.childNodes).indexOf(node));\n//       node = parent as any;\n//       parent = parent.parentNode;\n//     }\n//     paths.push(path.reverse());\n//   }\n//   return paths;\n// };\n// const generateCommentNodesFromAddresses = (\n//   commentNodesAddresses: number[][],\n//   element: Element,\n//   commentNodes: Comment[]\n// ) => {\n//   for (var i = 0; i < commentNodesAddresses.length; i++) {\n//     const path = commentNodesAddresses[i];\n//     let node = null;\n//     let parent = element;\n//     for (var p = 0; p < path.length; p++) {\n//       node = parent.childNodes.item(path[p]);\n//       parent = node;\n//     }\n//     commentNodes.push(node);\n//   }\n// };\n","import { jsRoot } from \"./util\";\nimport { FidanValue } from \".\";\nimport { value } from \"./f\";\n\nfunction symbolObservablePonyfill(root) {\n  let result;\n  const Symbol = root.Symbol;\n\n  if (typeof Symbol === \"function\") {\n    if (Symbol.observable) {\n      result = Symbol.observable;\n    } else {\n      result = Symbol(\"observable\");\n      Symbol.observable = result;\n    }\n  } else {\n    result = \"@@observable\";\n  }\n\n  return result;\n}\n\nconst $$symbolObservable = symbolObservablePonyfill(jsRoot());\n\nclass Observer {\n  isUnsubscribed = false;\n  handlers: Partial<Observer> = null;\n  _unsubscribe = null;\n  constructor(handlers: Partial<Observer>) {\n    this.handlers = handlers;\n    this.isUnsubscribed = false;\n  }\n\n  next(value) {\n    if (this.handlers.next && !this.isUnsubscribed) {\n      this.handlers.next(value);\n    }\n  }\n\n  error(error) {\n    if (!this.isUnsubscribed) {\n      if (this.handlers.error) {\n        this.handlers.error(error);\n      }\n\n      this.unsubscribe();\n    }\n  }\n\n  complete() {\n    if (!this.isUnsubscribed) {\n      if (this.handlers.complete) {\n        this.handlers.complete();\n      }\n\n      this.unsubscribe();\n    }\n  }\n\n  unsubscribe() {\n    this.isUnsubscribed = true;\n\n    if (this._unsubscribe) {\n      this._unsubscribe();\n    }\n  }\n}\n\nclass Observable {\n  _subscribe: (observer: Observer) => () => void = null;\n  constructor(subscribe) {\n    this._subscribe = subscribe;\n  }\n\n  subscribe(obs: Partial<Observer>) {\n    const observer = new Observer(obs);\n\n    observer._unsubscribe = this._subscribe(observer);\n\n    return {\n      unsubscribe() {\n        observer.unsubscribe();\n      }\n    };\n  }\n\n  [$$symbolObservable]() {\n    return this;\n  }\n}\n\nexport const toObservable = <T>(data: FidanValue<any>): T => {\n  return new Observable(observer => {\n    var compute = value(() => {\n      observer.next(data.$val);\n    });\n    data[\"depends\"].push(compute);\n  }) as any;\n};\n","export interface FidanValue<T> {\n  (val?: T): T;\n  $val: T;\n  debugName: (name: string) => FidanValue<T>;\n  depends: (dependencies: () => FidanData<any>[]) => FidanValue<T>;\n}\n\nexport type FidanArrayEventType =\n  | \"itemadded\"\n  | \"itemset\"\n  | \"itemremoved\"\n  | \"beforemulti\"\n  | \"aftermulti\";\n\nexport interface EventedArrayReturnType<T> extends Array<T> {\n  on: (type: FidanArrayEventType, callback) => void;\n  off: any;\n  innerArray: T[];\n  setEventsFrom: (val: EventedArrayReturnType<T>) => void;\n}\n\nexport interface FidanArray<T> {\n  (val?: T[]): T[] & EventedArrayReturnType<T>;\n  readonly $val: T[] & EventedArrayReturnType<T>;\n  size?: FidanValue<number>;\n  debugName: (name: string) => FidanArray<T>;\n  depends: (dependencies: () => FidanData<any>[]) => FidanArray<T>;\n}\n\nexport type FidanData<T> = FidanValue<T> | FidanArray<T>;\n\nimport * as fidanObj from \"./index-libs\";\nexport const fidan = fidanObj;\n"],"names":["EventedArray","items","_self","_array","_handlers","itemadded","itemremoved","itemset","beforemulti","aftermulti","defineIndexProperty","index","Object","defineProperty","configurable","enumerable","get","set","v","raiseEvent","type","item","event","forEach","h","call","on","eventName","handler","push","off","ln","length","splice","arguments","i","pop","unshift","shift","howMany","removed","value","n","Number","apply","Array","RangeError","getOwnPropertyNames","prototype","name","writable","setEventsFrom","val","toJSON","isArray","let","autoTrackDependencies","const","array","arr","$val","innerArray","size","innerFn","undefined","indexOf","slice","hasOwnProperty","depends","beforeCompute","compute","dependencies","deps","debugName","toString","fn","cmp","initalValue","destroy","reuseNodes","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstChild","tmp","removeChild","textContent","tail","previousSibling","lastChild","_head","_mode","head","mode","insertBefore","appendChild","coditionalDom","condition","htmlFragment","parentElement","nextElement","childs","from","children","inserted","tmpNextElement","child","remove","insertToDom","itemElement","typeOf","document","createTextNode","arrayMap","parentDom","renderReturn","reuseMode","parentRef","parentNode","next","nextElementSibling","createDocumentFragment","e","replaceChild","firstRenderOnFragment","arrayComputeRenderAll","nextVal","parentFragment","nextItem","prevItem","key","c_depends","bc_depends","setDefaults","obj","defaults","mapProperty","propertyKey","value$","descr","getOwnPropertyDescriptor","jsRoot","root","self","window","global","module","Function","COMMENT_TEXT","COMMENT_DOM","COMMENT_FN","COMMENT_HTM","COMMENT_TEXT_OR_DOM","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","checked","disabled","readonly","contentEditable","_templateMode","template","createElement","putCommentToTagStart","htm","comment","p","lastIndexOf","substr","html","args","params","attributeName","param","isDynamic","endsWith","commentType","cloneNode","join","element","content","commentNodes","walkForCommentNodes","updateNodesByCommentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","trim","startsWith","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","commentNode","commentValue","i1","i2","parseInt","paramIndex","addEventListener","setAttribute","requestAnimationFrame","htmlArrayMap","renderCallback","options","assign","useCloneNode","clonedNode","dataParamIndexes","arrayMapFn","renderNode","indexes","symbolObservablePonyfill","result","Symbol","observable","$$symbolObservable","Observer","constructor","handlers","isUnsubscribed","error","unsubscribe","complete","_unsubscribe","Observable","subscribe","_subscribe","obs","observer","toObservable","fidan","fidanObj"],"mappings":"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"}