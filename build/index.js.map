{"version":3,"file":"index.js","sources":["../src/evented-array.ts","../src/f.ts","../src/dom.ts","../src/observable.ts","../src/context.ts","../src/dom-tree.ts","../src/index.ts","../src/util.ts"],"sourcesContent":["export type ArrayMutableMethods =\n  | \"copyWithin\" // TODO ArrayMutableMethods copyWithin\n  | \"fill\" // TODO ArrayMutableMethods fill\n  | \"pop\"\n  | \"push\"\n  | \"reverse\" // TODO ArrayMutableMethods reverse\n  | \"shift\"\n  | \"sort\" // TODO ArrayMutableMethods sort\n  | \"splice\"\n  | \"unshift\";\n\nexport function EventedArray(items) {\n  var _self = this,\n    _array = [],\n    _handlers = {\n      itemadded: [],\n      itemremoved: [],\n      itemset: [],\n      beforemulti: [],\n      aftermulti: []\n    };\n\n  function defineIndexProperty(index) {\n    if (!(index in _self)) {\n      Object.defineProperty(_self, index, {\n        configurable: true,\n        enumerable: true,\n        get: function() {\n          return _array[index];\n        },\n        set: function(v) {\n          _array[index] = v;\n          raiseEvent({\n            type: \"itemset\",\n            index: index,\n            item: v\n          });\n        }\n      });\n    }\n  }\n\n  function raiseEvent(event) {\n    _handlers[event.type].forEach(function(h) {\n      h.call(_self, event);\n    });\n  }\n\n  _self.on = function(eventName, handler) {\n    _handlers[eventName].push(handler);\n  };\n\n  _self.off = function(eventName, handler) {\n    var h = _handlers[eventName];\n    var ln = h.length;\n    while (--ln >= 0) {\n      if (h[ln] === handler) {\n        h.splice(ln, 1);\n      }\n    }\n  };\n\n  _self.push = function() {\n    var index;\n    arguments.length > 1 &&\n      raiseEvent({\n        type: \"beforemulti\"\n      });\n    for (var i = 0, ln = arguments.length; i < ln; i++) {\n      index = _array.length;\n      _array.push(arguments[i]);\n      defineIndexProperty(index);\n      raiseEvent({\n        type: \"itemadded\",\n        index: index,\n        item: arguments[i]\n      });\n    }\n    arguments.length > 1 &&\n      raiseEvent({\n        type: \"aftermulti\"\n      });\n    return _array.length;\n  };\n\n  _self.pop = function() {\n    if (_array.length > -1) {\n      var index = _array.length - 1,\n        item = _array.pop();\n      delete _self[index];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: index,\n        item: item\n      });\n      return item;\n    }\n  };\n\n  _self.unshift = function() {\n    for (var i = 0, ln = arguments.length; i < ln; i++) {\n      _array.splice(i, 0, arguments[i]);\n      defineIndexProperty(_array.length - 1);\n      raiseEvent({\n        type: \"itemadded\",\n        index: i,\n        item: arguments[i]\n      });\n    }\n    for (; i < _array.length; i++) {\n      raiseEvent({\n        type: \"itemset\",\n        index: i,\n        item: _array[i]\n      });\n    }\n    return _array.length;\n  };\n\n  _self.shift = function() {\n    if (_array.length > -1) {\n      var item = _array.shift();\n      delete _self[_array.length];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: 0,\n        item: item\n      });\n      return item;\n    }\n  };\n\n  _self.splice = function(index, howMany /*, element1, element2, ... */) {\n    var removed = [],\n      item,\n      pos;\n\n    index = index == null ? 0 : index < 0 ? _array.length + index : index;\n\n    howMany =\n      howMany == null ? _array.length - index : howMany > 0 ? howMany : 0;\n\n    while (howMany--) {\n      item = _array.splice(index, 1)[0];\n      removed.push(item);\n      delete _self[_array.length];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: index + removed.length - 1,\n        item: item\n      });\n    }\n\n    for (var i = 2, ln = arguments.length; i < ln; i++) {\n      _array.splice(index, 0, arguments[i]);\n      defineIndexProperty(_array.length - 1);\n      raiseEvent({\n        type: \"itemadded\",\n        index: index,\n        item: arguments[i]\n      });\n      index++;\n    }\n\n    return removed;\n  };\n\n  Object.defineProperty(_self, \"length\", {\n    configurable: false,\n    enumerable: false,\n    get: function() {\n      return _array.length;\n    },\n    set: function(value) {\n      var n = Number(value);\n      var length = _array.length;\n      if (n % 1 === 0 && n >= 0) {\n        if (n < length) {\n          _self.splice(n);\n        } else if (n > length) {\n          _self.push.apply(_self, new Array(n - length));\n        }\n      } else {\n        throw new RangeError(\"Invalid array length\");\n      }\n      _array.length = n;\n      return value;\n    }\n  });\n\n  Object.defineProperty(_self, \"innerArray\", {\n    configurable: false,\n    enumerable: false,\n    get: function() {\n      return _array;\n    },\n    set: function(v) {\n      _array = v;\n      for (var i = 0; i < v.length; i++) {\n        defineIndexProperty(i);\n      }\n    }\n  });\n\n  Object.getOwnPropertyNames(Array.prototype).forEach(function(name) {\n    if (!(name in _self)) {\n      Object.defineProperty(_self, name, {\n        configurable: false,\n        enumerable: false,\n        writable: false,\n        value: Array.prototype[name]\n      });\n    }\n  });\n\n  _self.toJSON = () => {\n    return _array;\n  };\n\n  if (items instanceof Array) {\n    _self.push.apply(_self, items);\n  }\n}\n","import { EventedArray } from \"./evented-array\";\r\n\r\nexport interface FidanValue<T> {\r\n  (val: T): void;\r\n  readonly $val: T;\r\n  freezed: boolean;\r\n}\r\n\r\nexport type FidanArrayEventType = \"itemadded\" | \"itemset\" | \"itemremoved\";\r\n\r\nexport const value = <T>(value?: T, freezed?: boolean): FidanValue<T> => {\r\n  if (value && value[\"$val\"] != undefined)\r\n    throw \"Fidan: Higher ordered signals is not supported.\";\r\n  const innerFn: any = (val?) => {\r\n    if (val === undefined) {\r\n      return innerFn[\"$val\"];\r\n    } else if (Array.isArray(val)) {\r\n      innerFn[\"$val\"].innerArray = val;\r\n    } else innerFn[\"$val\"] = val;\r\n    const depends = innerFn[\"depends\"];\r\n    if (depends.length)\r\n      for (var i = 0; i < depends.length; i++)\r\n        !depends[i][\"freezed\"] && depends[i](depends[i].compute());\r\n  };\r\n  innerFn[\"$val\"] = value;\r\n  innerFn[\"freezed\"] = freezed;\r\n\r\n  innerFn[\"depends\"] = [];\r\n  innerFn.toString = innerFn.toJSON = () => innerFn[\"$val\"].toString();\r\n  return innerFn;\r\n};\r\n\r\nexport const array = <T>(\r\n  items: T[]\r\n): {\r\n  on?: (\r\n    type: FidanArrayEventType,\r\n    callback: (e: { item: T; index: number }) => void\r\n  ) => void;\r\n  removeEventListener?: (type: FidanArrayEventType) => void;\r\n  $val: T[];\r\n} & FidanValue<T[]> => {\r\n  const arr = value(new EventedArray(items)) as any;\r\n  arr.on = arr.$val.on;\r\n  arr.off = arr.$val.off;\r\n  arr.toJSON = () => arr.$val.innerArray;\r\n\r\n  return arr;\r\n};\r\n\r\nexport const on = (\r\n  arr: any[],\r\n  type: FidanArrayEventType,\r\n  callback: (e: { item: any; index: number }) => void\r\n) => {\r\n  arr[\"$val\"].on(type, callback);\r\n};\r\n\r\nexport const off = (\r\n  arr: any[],\r\n  type: FidanArrayEventType,\r\n  callback: (e: { item: any; index: number }) => void\r\n) => {\r\n  arr[\"$val\"].off(type, callback);\r\n};\r\n\r\nexport const compute = (fn: () => void, ...args: any[]) => {\r\n  var compute = value();\r\n  compute[\"compute\"] = fn;\r\n  for (var i = 0; i < args.length; i++) args[i][\"depends\"].push(compute);\r\n  fn();\r\n};\r\n\r\nexport const initCompute = (fn: () => any, ...args: any[]) => {\r\n  const cValue = value(fn());\r\n  compute(() => {\r\n    cValue(fn());\r\n  }, ...args);\r\n  return cValue;\r\n};\r\n\r\n// TODO typedCompute, typedValue ...\r\nexport const computeReturn = <T>(fn: () => T, ...args: any[]): T =>\r\n  initCompute(fn, ...args) as any;\r\n\r\nexport const setCompute = (prev: any, fn: () => void, ...args: any[]) => {\r\n  destroy(prev);\r\n  return initCompute(prev, fn, ...args);\r\n};\r\n\r\nexport const destroy = (item: any) => {\r\n  delete item[\"compute\"];\r\n  delete item[\"depends\"];\r\n};\r\n","import { FidanValue } from \"./f\";\nimport { EventedArray } from \"./evented-array\";\nimport { compute } from \"./f\";\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n  if (itemElement instanceof Function) itemElement(parentElement);\n  else {\n    if (itemElement instanceof Node === false)\n      itemElement = document.createTextNode(itemElement);\n    parentElement.insertBefore(itemElement, parentElement.children[index]);\n  }\n};\n\nexport const arrayMap = (\n  arr: FidanValue<any[]>,\n  parentDom: Node,\n  renderReturn: (item: any, idx?: number, isInsert?: boolean) => void\n) => {\n  const oArr =\n    arr.$val instanceof EventedArray ? arr.$val : new EventedArray(arr.$val);\n\n  let parentRef: { parent: Node; next: Node } = null;\n  oArr.on(\"beforemulti\", function() {\n    if (parentDom.parentNode) {\n      parentRef = { parent: parentDom, next: parentDom.nextSibling };\n      parentDom = document.createDocumentFragment();\n    }\n  });\n  oArr.on(\"aftermulti\", function() {\n    if (parentRef) {\n      parentRef.parent.insertBefore(parentDom, parentRef.next);\n      parentDom = parentRef.parent;\n    }\n  });\n\n  oArr.on(\"itemadded\", function(e) {\n    insertToDom(parentDom, e.index, renderReturn(e.item, e.index));\n  });\n\n  oArr.on(\"itemset\", function(e) {\n    parentDom.replaceChild(\n      renderReturn(e.item, e.index) as any,\n      parentDom.childNodes.item(e.index)\n    );\n  });\n\n  oArr.on(\"itemremoved\", function(e) {\n    parentDom.removeChild(parentDom.childNodes.item(e.index));\n  });\n  arr(oArr);\n\n  const renderAll = () => {\n    if (arr.$val.length === 0) parentDom.textContent = \"\";\n    else {\n      const parentFragment = document.createDocumentFragment();\n      parentDom.textContent = \"\";\n      for (\n        var i = (parentDom as Element).childElementCount;\n        i < arr.$val.length;\n        i++\n      )\n        insertToDom(parentFragment, i, renderReturn(arr.$val[i], i));\n      parentDom.appendChild(parentFragment);\n    }\n  };\n  compute(renderAll, arr);\n};\n","import $$symbolObservable from 'symbol-observable';\nimport { FidanValue, value } from './f';\n\n// https://medium.com/@fknussel/a-simple-observable-implementation-c9c809c89c69\n\nclass Observer {\n\tisUnsubscribed = false;\n\thandlers: Partial<Observer> = null;\n\t_unsubscribe = null;\n\tconstructor(handlers: Partial<Observer>) {\n\t\tthis.handlers = handlers; // next, error and complete logic\n\t\tthis.isUnsubscribed = false;\n\t}\n\n\tnext(value) {\n\t\tif (this.handlers.next && !this.isUnsubscribed) {\n\t\t\tthis.handlers.next(value);\n\t\t}\n\t}\n\n\terror(error) {\n\t\tif (!this.isUnsubscribed) {\n\t\t\tif (this.handlers.error) {\n\t\t\t\tthis.handlers.error(error);\n\t\t\t}\n\n\t\t\tthis.unsubscribe();\n\t\t}\n\t}\n\n\tcomplete() {\n\t\tif (!this.isUnsubscribed) {\n\t\t\tif (this.handlers.complete) {\n\t\t\t\tthis.handlers.complete();\n\t\t\t}\n\n\t\t\tthis.unsubscribe();\n\t\t}\n\t}\n\n\tunsubscribe() {\n\t\tthis.isUnsubscribed = true;\n\n\t\tif (this._unsubscribe) {\n\t\t\tthis._unsubscribe();\n\t\t}\n\t}\n}\n\nclass Observable {\n\t_subscribe: (observer: Observer) => () => void = null;\n\tconstructor(subscribe) {\n\t\tthis._subscribe = subscribe;\n\t}\n\n\tsubscribe(obs: Partial<Observer>) {\n\t\tconst observer = new Observer(obs);\n\n\t\tobserver._unsubscribe = this._subscribe(observer);\n\n\t\treturn {\n\t\t\tunsubscribe() {\n\t\t\t\tobserver.unsubscribe();\n\t\t\t}\n\t\t};\n\t}\n\n\t[$$symbolObservable]() {\n\t\treturn this;\n\t}\n}\n\nexport const toObservable = <T>(data: FidanValue<any>): T => {\n\treturn new Observable((observer) => {\n\t\tvar compute = value(() => {\n\t\t\tobserver.next(data.$val);\n\t\t});\n\t\tdata['depends'].push(compute);\n\t}) as any;\n};\n","const activeContextKeys = [];\nconst appContext: { [key: string]: any[] } = {};\n\nexport const startContext = (key: string, value: any) => {\n  if (!appContext[key]) appContext[key] = [];\n  appContext[key].push(value);\n  activeContextKeys.push(key);\n};\n\nexport const getContextValue = (key: string, componentProps: any) => {\n  if (componentProps && componentProps[\"$context\"][key])\n    return componentProps[\"$context\"][key];\n  if (appContext[key]) return appContext[key][appContext[key].length - 1];\n};\n\nexport const injectContexts = (componentProps: any) => {\n  if (!componentProps[\"$context\"])\n    Object.defineProperty(componentProps, \"$context\", {\n      configurable: false,\n      enumerable: false,\n      value: {}\n    });\n  let key = null;\n  for (var i = 0; i < activeContextKeys.length; i++) {\n    key = activeContextKeys[i];\n    componentProps[\"$context\"][key] =\n      appContext[key][appContext[key].length - 1];\n  }\n};\n\nexport const endContext = (key: string) => {\n  appContext[key].pop();\n  activeContextKeys.pop();\n};\n\nexport const activateContext = context => {\n  for (var key in context) startContext(key, context[key]);\n};\n\nexport const deactivateContext = context => {\n  for (var key in context) endContext(key);\n};\n\nexport const Context = (props: { key: string; value: any }) => null;\n","import { injectContexts, activateContext, deactivateContext } from \"./context\";\r\n\r\nvar jsxEventProperty = /^on[A-Z]/;\r\nconst svgNS = \"http://www.w3.org/2000/svg\";\r\nexport const Fragment = Symbol(\"fjsx.Fragment\");\r\n\r\nexport const conditionalElement = (\r\n  parentElement,\r\n  oldElement,\r\n  newElementFn: () => any\r\n) => {\r\n  parentElement[\"$props\"] &&\r\n    activateContext(parentElement[\"$props\"][\"$context\"]);\r\n  let newElement = newElementFn();\r\n  parentElement[\"$props\"] &&\r\n    deactivateContext(parentElement[\"$props\"][\"$context\"]);\r\n  if (newElement instanceof Node === false)\r\n    newElement = document.createTextNode(newElement || \"\");\r\n  if (oldElement) parentElement.replaceChild(newElement, oldElement);\r\n  else parentElement.appendChild(newElement);\r\n  return newElement;\r\n};\r\n\r\nexport const setElementAttributes = (\r\n  element: Element,\r\n  attributes,\r\n  forceSetAttr?: boolean\r\n) => {\r\n  let attribute = null;\r\n  for (var attributeName in attributes) {\r\n    attribute = attributes[attributeName];\r\n    if (attribute != undefined) {\r\n      if (attribute instanceof Function) {\r\n        if (jsxEventProperty.test(attributeName)) {\r\n          attributeName = attributeName.toLowerCase();\r\n          element[attributeName] = attribute;\r\n        } else attribute(element);\r\n      } else if (attribute instanceof Object) {\r\n        if (Array.isArray(attribute)) {\r\n          addChildElements(element, attribute);\r\n        } else {\r\n          for (var key in attribute) {\r\n            if (typeof attribute[key] === \"function\") attribute[key](element);\r\n            else element[attributeName][key] = attribute[key]; // style like\r\n          }\r\n        }\r\n      } else {\r\n        if (forceSetAttr || attributeName.indexOf(\"-\") !== -1)\r\n          element.setAttribute(attributeName, attribute);\r\n        else element[attributeName] = attribute;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport const createElement = (\r\n  tagName: string | Function | Symbol,\r\n  attributes: { [key: string]: any },\r\n  ...childs: any[]\r\n) => {\r\n  let element = null;\r\n  if (tagName instanceof Function) {\r\n    if (attributes === null) attributes = {};\r\n    if (childs && childs.length) attributes[\"children\"] = childs;\r\n    injectContexts(attributes);\r\n    element = (tagName as any)(attributes);\r\n    if (element) element[\"$props\"] = attributes;\r\n  } else {\r\n    if (tagName === Fragment) {\r\n      element = document.createDocumentFragment();\r\n    } else {\r\n      element = document.createElement(tagName as any);\r\n      attributes &&\r\n        setElementAttributes(\r\n          element,\r\n          attributes,\r\n          (tagName as string).indexOf(\"-\") !== -1\r\n        );\r\n    }\r\n    element[\"$props\"] = attributes;\r\n    childs && childs.length && addChildElements(element, childs);\r\n  }\r\n  return element;\r\n};\r\n\r\nexport const createSvgElement = (\r\n  tagName: string,\r\n  attributes: { [key: string]: any },\r\n  ...childs: any[]\r\n) => {\r\n  let element = document.createElementNS(svgNS, tagName);\r\n  if (attributes) {\r\n    if (attributes.className) {\r\n      // TODO compile time\r\n      attributes.class = attributes.className;\r\n      delete attributes.className;\r\n    }\r\n    setElementAttributes(element, attributes, true);\r\n  }\r\n  element[\"$props\"] = attributes;\r\n  childs && childs.length && addChildElements(element, childs);\r\n  return element;\r\n};\r\n\r\nexport const addChildElements = (element, childs) => {\r\n  let props = null;\r\n  for (var i = 0; i < childs.length; i++) {\r\n    if (Array.isArray(childs[i])) addChildElements(element, childs[i]);\r\n    else if (childs[i] instanceof Function) childs[i](element);\r\n    else {\r\n      if (childs[i] != null) {\r\n        props = childs[i][\"$props\"];\r\n        element.appendChild(\r\n          childs[i] instanceof Node\r\n            ? childs[i]\r\n            : document.createTextNode(childs[i])\r\n        );\r\n        props && props.didMount && props.didMount(element, childs[i]);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport const createTextNode = parent => {\r\n  return parent.appendChild(document.createTextNode(\"\"));\r\n};\r\n\r\nexport const cloneElement = (element: Element, attributes: any) => {\r\n  element = element.cloneNode(true) as Element;\r\n  attributes && setElementAttributes(element, attributes, false);\r\n  return element;\r\n};\r\n","/// <reference path=\"../types/JSX.d.ts\" />\nimport * as fidanObj from \"./libs\";\nexport const fidan = fidanObj;\nfidan[\"VERSION\"] = \"0.0.4\";\n","import { value } from './f';\n\nexport const setDefaults = <T>(obj: T, defaults: { [key in keyof T]?: any }) => {\n\tfor (var key in defaults) {\n\t\tif (obj[key] === undefined) obj[key] = defaults[key];\n\t}\n};\n\nexport const mapProperty = (obj: Object, propertyKey: string, value$: any) => {\n\tconst descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n\tif (descr.configurable)\n\t\tObject.defineProperty(obj, propertyKey, {\n\t\t\tconfigurable: false,\n\t\t\tenumerable: true,\n\t\t\tget: () => {\n\t\t\t\treturn value$.$val;\n\t\t\t},\n\t\t\tset: value$\n\t\t});\n\telse {\n\t\tdescr.set['depends'].push(\n\t\t\tvalue(() => {\n\t\t\t\tvalue$(obj[propertyKey]);\n\t\t\t})\n\t\t);\n\t}\n};\n"],"names":["EventedArray","items","_self","this","_array","_handlers","itemadded","itemremoved","itemset","beforemulti","aftermulti","defineIndexProperty","index","Object","defineProperty","configurable","enumerable","get","set","v","raiseEvent","type","item","event","forEach","h","call","on","eventName","handler","push","off","ln","length","splice","arguments","i","pop","unshift","shift","howMany","removed","value","n","Number","RangeError","apply","Array","getOwnPropertyNames","prototype","name","writable","toJSON","const","freezed","undefined","innerFn","val","isArray","innerArray","depends","compute","toString","fn","args","initCompute","cValue","destroy","insertToDom","parentElement","itemElement","Function","Node","document","createTextNode","insertBefore","children","Observer","constructor","handlers","isUnsubscribed","next","error","unsubscribe","complete","_unsubscribe","Observable","subscribe","_subscribe","obs","observer","$$symbolObservable","activeContextKeys","appContext","startContext","key","injectContexts","componentProps","endContext","activateContext","context","deactivateContext","jsxEventProperty","Fragment","Symbol","setElementAttributes","element","attributes","forceSetAttr","attribute","attributeName","test","toLowerCase","addChildElements","indexOf","setAttribute","childs","props","appendChild","didMount","fidan","arr","$val","callback","prev","parentDom","renderReturn","oArr","parentRef","parentNode","parent","nextSibling","createDocumentFragment","e","replaceChild","childNodes","removeChild","textContent","parentFragment","childElementCount","obj","defaults","propertyKey","value$","descr","getOwnPropertyDescriptor","data","oldElement","newElementFn","newElement","tagName","createElement","createElementNS","className","class","cloneNode"],"mappings":"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"}