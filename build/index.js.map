{"version":3,"file":"index.js","sources":["../src/f.ts","../src/util.ts","../src/reconcile.ts","../src/reuse-nodes.ts","../src/html.ts"],"sourcesContent":["import { FidanValue, ComputionMethodArguments, FidanValueFn } from '.';\n\nlet autoTracks: any[] = null;\n\nexport const value = <T>(val?: T): FidanValueFn<T> => {\n\tif (val && val.hasOwnProperty('$val')) return val as any;\n\tconst innerFn: any = (val?: T, opt?: ComputionMethodArguments<T>) => {\n\t\tif (val === undefined) {\n\t\t\tif (autoTracks && autoTracks.indexOf(innerFn) === -1) autoTracks.push(innerFn);\n\t\t\treturn innerFn['$val'];\n\t\t} else {\n\t\t\tconst updateAfter = Array.isArray(val);\n\t\t\tif (!updateAfter) innerFn['$val'] = val;\n\t\t\tlet depends: FidanValue<any>[] = innerFn['c_depends'];\n\t\t\tif (depends.length)\n\t\t\t\tfor (var i = 0; i < depends.length; i++) {\n\t\t\t\t\tif (depends[i].compute) {\n\t\t\t\t\t\tdepends[i](depends[i].compute(val, { caller: innerFn }), { caller: depends[i] });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdepends[i](innerFn.$val, innerFn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\tif (updateAfter) innerFn['$val'] = val;\n\t\t}\n\t};\n\n\tinnerFn['$val'] = val;\n\tinnerFn['c_depends'] = [];\n\tinnerFn.debugName = (name: string) => {\n\t\tObject.defineProperty(innerFn, 'name', { value: name });\n\t\treturn innerFn;\n\t};\n\tinnerFn.toString = innerFn.toJSON = () =>\n\t\tinnerFn['$val'] && innerFn['$val'].toJSON ? innerFn['$val'].toJSON() : innerFn['$val'];\n\tinnerFn.depends = (...deps: (FidanValue<any> | Function)[]): any => {\n\t\tfor (var i = 0; i < deps.length; i++) innerFn['c_depends'].push(deps[i]);\n\t\tinnerFn(innerFn()); //trigger to c_depends\n\t\treturn innerFn;\n\t};\n\n\tif (Array.isArray(val)) {\n\t\tinnerFn['map'] = (renderFn, renderMode) => ({\n\t\t\tarr: innerFn,\n\t\t\trenderFn,\n\t\t\trenderMode\n\t\t});\n\t}\n\n\treturn innerFn;\n};\n\nexport const computed = <T>(fn: (val: T, opt?: ComputionMethodArguments<T>) => any, dependencies?: any[]): any => {\n\tautoTracks = dependencies ? null : [];\n\tconst cmp = value<T>(undefined);\n\tconst val = fn(undefined, { caller: cmp } as any);\n\tcmp.$val = val;\n\tconst deps = autoTracks ? autoTracks : dependencies;\n\tautoTracks = null;\n\tcmp['compute'] = fn;\n\tfor (var i = 0; i < deps.length; i++) deps[i]['c_depends'].push(cmp);\n\treturn cmp;\n};\n","import { value } from './f';\nimport { FidanValue, FidanArray, DataArrayEvents, ComputionMethodArguments } from '.';\n\nexport const injectToProperty = (obj: Object, propertyKey: string, val: FidanValue<any>) => {\n\t// const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n\t// if (descr.configurable)\n\tObject.defineProperty(obj, propertyKey, {\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t\tget: () => {\n\t\t\tval();\n\t\t\treturn val;\n\t\t},\n\t\tset: (v) => (v.hasOwnProperty('$val') ? (val = v) : val(v))\n\t});\n\t// else {\n\t//   // descr.get().c_depends.push(val);\n\t//   // val[\"c_depends\"].push(descr.get());\n\t// }\n};\n\nexport const inject = <T extends Object>(obj: T): T => {\n\tfor (var key in obj) {\n\t\tinjectToProperty(obj, key, value(obj[key]));\n\t}\n\treturn obj;\n};\n\nexport const debounce = (func, wait, immediate?) => {\n\tlet timeout;\n\n\treturn function() {\n\t\tlet context = this;\n\t\tlet args = arguments;\n\t\tlet later = function() {\n\t\t\ttimeout = null;\n\t\t\tif (!immediate) func.apply(context, args);\n\t\t};\n\t\tlet callNow = immediate && !timeout;\n\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t\tif (callNow) func.apply(context, args);\n\t};\n};\n","// Original: https://github.com/Freak613/stage0/blob/master/reconcile.js\n\nexport function reconcile(parent, renderedValues, data, createFn, noOp, beforeNode?, afterNode?) {\n\t// Fast path for clear\n\tif (data.length === 0) {\n\t\tif (beforeNode !== undefined || afterNode !== undefined) {\n\t\t\tlet node = beforeNode !== undefined ? beforeNode.nextSibling : parent.firstElementChild,\n\t\t\t\ttmp;\n\n\t\t\tif (afterNode === undefined) afterNode = null;\n\n\t\t\twhile (node && node !== afterNode) {\n\t\t\t\ttmp = node.nextSibling;\n\t\t\t\tparent.removeChild(node);\n\t\t\t\tnode = tmp;\n\t\t\t}\n\t\t} else {\n\t\t\tparent.textContent = '';\n\t\t}\n\t\treturn;\n\t}\n\n\t// Fast path for create\n\tif (renderedValues.length === 0) {\n\t\tlet node,\n\t\t\tmode = afterNode !== undefined ? 1 : 0;\n\t\tfor (let i = 0, len = data.length; i < len; i++) {\n\t\t\tnode = createFn(data[i], i);\n\t\t\tmode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n\t\t}\n\t\treturn;\n\t}\n\n\tlet prevStart = 0,\n\t\tnewStart = 0,\n\t\tloop = true,\n\t\tprevEnd = renderedValues.length - 1,\n\t\tnewEnd = data.length - 1,\n\t\ta,\n\t\tb,\n\t\tprevStartNode = beforeNode ? beforeNode.nextSibling : parent.firstElementChild,\n\t\tnewStartNode = prevStartNode,\n\t\tprevEndNode = afterNode ? afterNode.previousSibling : parent.lastElementChild,\n\t\tnewEndNode = prevEndNode;\n\n\tfixes: while (loop) {\n\t\tloop = false;\n\t\tlet _node;\n\n\t\t// Skip prefix\n\t\t(a = renderedValues[prevStart]), (b = data[newStart]);\n\t\twhile (a === b) {\n\t\t\tnoOp(prevStartNode, b);\n\t\t\tprevStart++;\n\t\t\tnewStart++;\n\t\t\tnewStartNode = prevStartNode = prevStartNode.nextSibling;\n\t\t\tif (prevEnd < prevStart || newEnd < newStart) break fixes;\n\t\t\ta = renderedValues[prevStart];\n\t\t\tb = data[newStart];\n\t\t}\n\n\t\t// Skip suffix\n\t\t(a = renderedValues[prevEnd]), (b = data[newEnd]);\n\t\twhile (a === b) {\n\t\t\tnoOp(prevEndNode, b);\n\t\t\tprevEnd--;\n\t\t\tnewEnd--;\n\t\t\tafterNode = prevEndNode;\n\t\t\tnewEndNode = prevEndNode = prevEndNode.previousSibling;\n\t\t\tif (prevEnd < prevStart || newEnd < newStart) break fixes;\n\t\t\ta = renderedValues[prevEnd];\n\t\t\tb = data[newEnd];\n\t\t}\n\n\t\t// Fast path to swap backward\n\t\t(a = renderedValues[prevEnd]), (b = data[newStart]);\n\t\twhile (a === b) {\n\t\t\tloop = true;\n\t\t\tnoOp(prevEndNode, b);\n\t\t\t_node = prevEndNode.previousSibling;\n\t\t\tparent.insertBefore(prevEndNode, newStartNode);\n\t\t\tnewEndNode = prevEndNode = _node;\n\t\t\tnewStart++;\n\t\t\tprevEnd--;\n\t\t\tif (prevEnd < prevStart || newEnd < newStart) break fixes;\n\t\t\ta = renderedValues[prevEnd];\n\t\t\tb = data[newStart];\n\t\t}\n\n\t\t// Fast path to swap forward\n\t\t(a = renderedValues[prevStart]), (b = data[newEnd]);\n\t\twhile (a === b) {\n\t\t\tloop = true;\n\t\t\tnoOp(prevStartNode, b);\n\t\t\t_node = prevStartNode.nextSibling;\n\t\t\tparent.insertBefore(prevStartNode, afterNode);\n\t\t\tprevStart++;\n\t\t\tafterNode = newEndNode = prevStartNode;\n\t\t\tprevStartNode = _node;\n\t\t\tnewEnd--;\n\t\t\tif (prevEnd < prevStart || newEnd < newStart) break fixes;\n\t\t\ta = renderedValues[prevStart];\n\t\t\tb = data[newEnd];\n\t\t}\n\t}\n\n\t// Fast path for shrink\n\tif (newEnd < newStart) {\n\t\tif (prevStart <= prevEnd) {\n\t\t\tlet next;\n\t\t\twhile (prevStart <= prevEnd) {\n\t\t\t\tif (prevEnd === 0) {\n\t\t\t\t\tparent.removeChild(prevEndNode);\n\t\t\t\t} else {\n\t\t\t\t\tnext = prevEndNode.previousSibling;\n\t\t\t\t\tparent.removeChild(prevEndNode);\n\t\t\t\t\tprevEndNode = next;\n\t\t\t\t}\n\t\t\t\tprevEnd--;\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\t// Fast path for add\n\tif (prevEnd < prevStart) {\n\t\tif (newStart <= newEnd) {\n\t\t\tlet node,\n\t\t\t\tmode = afterNode ? 1 : 0;\n\t\t\twhile (newStart <= newEnd) {\n\t\t\t\tnode = createFn(data[newStart], newStart);\n\t\t\t\tmode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n\t\t\t\tnewStart++;\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\t// Positions for reusing nodes from current DOM state\n\tconst P = new Array(newEnd + 1 - newStart);\n\tfor (let i = newStart; i <= newEnd; i++) P[i] = -1;\n\n\t// Index to resolve position from current to new\n\tconst I = new Map();\n\tfor (let i = newStart; i <= newEnd; i++) I.set(data[i], i);\n\n\tlet reusingNodes = newStart + data.length - 1 - newEnd,\n\t\ttoRemove = [];\n\n\tfor (let i = prevStart; i <= prevEnd; i++) {\n\t\tif (I.has(renderedValues[i])) {\n\t\t\tP[I.get(renderedValues[i])] = i;\n\t\t\treusingNodes++;\n\t\t} else {\n\t\t\ttoRemove.push(i);\n\t\t}\n\t}\n\n\t// Fast path for full replace\n\tif (reusingNodes === 0) {\n\t\tif (beforeNode !== undefined || afterNode !== undefined) {\n\t\t\tlet node = beforeNode !== undefined ? beforeNode.nextSibling : parent.firstElementChild,\n\t\t\t\ttmp;\n\n\t\t\tif (afterNode === undefined) afterNode = null;\n\n\t\t\twhile (node !== afterNode) {\n\t\t\t\ttmp = node.nextSibling;\n\t\t\t\tparent.removeChild(node);\n\t\t\t\tnode = tmp;\n\t\t\t\tprevStart++;\n\t\t\t}\n\t\t} else {\n\t\t\tparent.textContent = '';\n\t\t}\n\n\t\tlet node,\n\t\t\tmode = afterNode ? 1 : 0;\n\t\tfor (let i = newStart; i <= newEnd; i++) {\n\t\t\tnode = createFn(data[i], i);\n\t\t\tmode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n\t\t}\n\n\t\treturn;\n\t}\n\n\t// What else?\n\tconst longestSeq = longestPositiveIncreasingSubsequence(P, newStart);\n\n\t// Collect nodes to work with them\n\tconst nodes = [];\n\tlet tmpC = prevStartNode;\n\tfor (let i = prevStart; i <= prevEnd; i++) {\n\t\tnodes[i] = tmpC;\n\t\ttmpC = tmpC.nextSibling;\n\t}\n\n\tfor (let i = 0; i < toRemove.length; i++) parent.removeChild(nodes[toRemove[i]]);\n\n\tlet lisIdx = longestSeq.length - 1,\n\t\ttmpD;\n\tfor (let i = newEnd; i >= newStart; i--) {\n\t\tif (longestSeq[lisIdx] === i) {\n\t\t\tafterNode = nodes[P[longestSeq[lisIdx]]];\n\t\t\tnoOp(afterNode, data[i]);\n\t\t\tlisIdx--;\n\t\t} else {\n\t\t\tif (P[i] === -1) {\n\t\t\t\ttmpD = createFn(data[i], i);\n\t\t\t} else {\n\t\t\t\ttmpD = nodes[P[i]];\n\t\t\t\tnoOp(tmpD, data[i]);\n\t\t\t}\n\t\t\tparent.insertBefore(tmpD, afterNode);\n\t\t\tafterNode = tmpD;\n\t\t}\n\t}\n}\n\nexport default reconcile;\n\n// Picked from\n// https://github.com/adamhaile/surplus/blob/master/src/runtime/content.ts#L368\n\n// return an array of the indices of ns that comprise the longest increasing subsequence within ns\nfunction longestPositiveIncreasingSubsequence(ns, newStart) {\n\tvar seq = [],\n\t\tis = [],\n\t\tl = -1,\n\t\tpre = new Array(ns.length);\n\n\tfor (var i = newStart, len = ns.length; i < len; i++) {\n\t\tvar n = ns[i];\n\t\tif (n < 0) continue;\n\t\tvar j = findGreatestIndexLEQ(seq, n);\n\t\tif (j !== -1) pre[i] = is[j];\n\t\tif (j === l) {\n\t\t\tl++;\n\t\t\tseq[l] = n;\n\t\t\tis[l] = i;\n\t\t} else if (n < seq[j + 1]) {\n\t\t\tseq[j + 1] = n;\n\t\t\tis[j + 1] = i;\n\t\t}\n\t}\n\n\tfor (i = is[l]; l >= 0; i = pre[i], l--) {\n\t\tseq[l] = i;\n\t}\n\n\treturn seq;\n}\n\nfunction findGreatestIndexLEQ(seq, n) {\n\t// invariant: lo is guaranteed to be index of a value <= n, hi to be >\n\t// therefore, they actually start out of range: (-1, last + 1)\n\tvar lo = -1,\n\t\thi = seq.length;\n\n\t// fast path for simple increasing sequences\n\tif (hi > 0 && seq[hi - 1] <= n) return hi - 1;\n\n\twhile (hi - lo > 1) {\n\t\tvar mid = Math.floor((lo + hi) / 2);\n\t\tif (seq[mid] > n) {\n\t\t\thi = mid;\n\t\t} else {\n\t\t\tlo = mid;\n\t\t}\n\t}\n\n\treturn lo;\n}\n","// Original: https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (parent, renderedValues, data, createFn, noOp, beforeNode?, afterNode?) => {\n\tif (data.length === 0) {\n\t\tif (beforeNode !== undefined || afterNode !== undefined) {\n\t\t\tlet node = beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n\t\t\t\ttmp;\n\n\t\t\tif (afterNode === undefined) afterNode = null;\n\n\t\t\twhile (node && node !== afterNode) {\n\t\t\t\ttmp = node.nextSibling;\n\t\t\t\tparent.removeChild(node);\n\t\t\t\tnode = tmp;\n\t\t\t}\n\t\t} else {\n\t\t\tparent.textContent = '';\n\t\t}\n\t\treturn;\n\t}\n\tif (renderedValues.length > data.length) {\n\t\tlet i = renderedValues.length,\n\t\t\ttail = afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n\t\t\ttmp;\n\t\twhile (i > data.length) {\n\t\t\ttmp = tail.previousSibling;\n\t\t\tparent.removeChild(tail);\n\t\t\ttail = tmp;\n\t\t\ti--;\n\t\t}\n\t}\n\n\tlet _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n\tif (_head === afterNode) _head = undefined;\n\n\tlet _mode = afterNode ? 1 : 0;\n\tfor (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n\t\titem = data[i];\n\t\tif (head) {\n\t\t\tnoOp(item, renderedValues[i]);\n\t\t} else {\n\t\t\thead = createFn(item, i);\n\t\t\tmode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n\t\t}\n\t\thead = head.nextSibling;\n\t\tif (head === afterNode) head = null;\n\t}\n};\n","// https://github.com/ismail-codar/fidan/blob/master/packages/babel-plugin-fidan-jsx/test/fixtures/call-instance-1/expected.js\n// https://github.com/ismail-codar/fidan/blob/master/src/html.ts\n\nimport { computed } from './f';\nimport { FidanValue } from '.';\nimport reconcile from './reconcile';\nimport { reuseNodes } from './reuse-nodes';\n\nconst TEXT = 1;\nconst DOM = 2;\nconst FN = 4; // \"function\" && !isDynamic\nconst HTM = 8;\nconst ARRAY = 16;\nconst TEXT_OR_DOM = TEXT | DOM;\n\nexport const htmlProps = {\n\tid: true,\n\tnodeValue: true,\n\ttextContent: true,\n\tclassName: true,\n\tinnerHTML: true,\n\tinnerText: true,\n\ttabIndex: true,\n\tvalue: true,\n\tchecked: true,\n\tdisabled: true,\n\treadonly: true,\n\tcontentEditable: true\n};\n\nlet template = document.createElement('template');\n\nexport const html = (literals, ...vars): DocumentFragment => {\n\tlet raw = literals.raw,\n\t\tresult = '',\n\t\ti = 0,\n\t\tlen = vars.length,\n\t\tstr = '';\n\n\twhile (i < len) {\n\t\tstr = raw[i];\n\t\tif (str.startsWith('\"')) {\n\t\t\tstr = str.substr(1);\n\t\t}\n\t\tif (raw[i].endsWith('=\"')) {\n\t\t\t//attributes\n\t\t\tvar p = str.lastIndexOf(' ') + 1;\n\t\t\tvar attr = str.substr(p, str.length - p - 2);\n\t\t\tp = str.lastIndexOf('<');\n\t\t\tvar comment = '<!--$cmt_' + attr + '-->';\n\t\t\tif (p === -1) {\n\t\t\t\t//next attributes\n\t\t\t\tp = result.lastIndexOf('<');\n\t\t\t\tresult =\n\t\t\t\t\tresult.substr(0, p) +\n\t\t\t\t\tcomment +\n\t\t\t\t\tresult.substr(p) +\n\t\t\t\t\tstr.substr(0, str.length - attr.length - 3).trim();\n\t\t\t} else {\n\t\t\t\t// fist attribute\n\t\t\t\tresult += str.substr(0, p) + comment + str.substr(p, str.length - p - attr.length - 3).trim();\n\t\t\t}\n\t\t} else {\n\t\t\t//text nodes\n\t\t\tresult += str + '<!--$cmt' + '-->';\n\t\t}\n\t\ti++;\n\t}\n\tlet extra = raw[raw.length - 1];\n\tif (extra.startsWith('\"')) {\n\t\textra = extra.substr(1);\n\t}\n\tresult += extra;\n\n\ttemplate = template.cloneNode(false) as HTMLTemplateElement;\n\ttemplate.innerHTML = result;\n\n\tconst element = template.content;\n\tconst commentNodes = [];\n\twalkForCommentNodes(element, commentNodes);\n\tupdateNodesByCommentNodes(commentNodes, vars);\n\n\treturn element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n\tvar treeWalker = document.createTreeWalker(\n\t\telement,\n\t\tNodeFilter.SHOW_COMMENT,\n\t\t{\n\t\t\tacceptNode: function(node) {\n\t\t\t\tvar nodeValue = node.nodeValue.trim();\n\t\t\t\treturn nodeValue.startsWith('$cmt') ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;\n\t\t\t}\n\t\t},\n\t\tfalse\n\t);\n\n\twhile (treeWalker.nextNode()) {\n\t\tcommentNodes.push(treeWalker.currentNode);\n\t}\n};\n\nconst updateNodesByCommentNodes = (commentNodes: Comment[], params: any[]) => {\n\tfor (var i = 0; i < commentNodes.length; i++) {\n\t\tconst commentNode = commentNodes[i];\n\t\tvar commentValue = commentNode.nodeValue;\n\t\tlet element = null;\n\t\tlet attributeName: string = null;\n\t\tlet param = params[i];\n\t\tconst isDynamic = param && param.hasOwnProperty('$val');\n\n\t\tconst attrIdx = commentValue.indexOf('_');\n\t\tconst paramType =\n\t\t\tattrIdx !== -1\n\t\t\t\t? DOM\n\t\t\t\t: typeof param === 'function' && !isDynamic\n\t\t\t\t\t? FN\n\t\t\t\t\t: Array.isArray(param) ? ARRAY : typeof param === 'object' && param ? HTM : TEXT;\n\n\t\tif (paramType & TEXT_OR_DOM) {\n\t\t\tif (paramType === TEXT) {\n\t\t\t\tattributeName = 'textContent';\n\t\t\t\telement = document.createTextNode(isDynamic ? param.$val : param);\n\t\t\t\tcommentNode.parentElement.insertBefore(element, commentNode.nextSibling);\n\t\t\t\tif (!isDynamic) {\n\t\t\t\t\tif (Array.isArray(param)) {\n\t\t\t\t\t\tfor (var p = 0; p < param.length; p++) {\n\t\t\t\t\t\t\tcommentNode.parentElement.appendChild(param[p]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (paramType === DOM) {\n\t\t\t\tattributeName = commentValue.substr(attrIdx + 1);\n\t\t\t\telement = commentNode.nextElementSibling;\n\t\t\t}\n\t\t\tparamType !== FN && commentNode.remove();\n\t\t\tif (attributeName.startsWith('on')) {\n\t\t\t\t(element as Element).addEventListener(attributeName.substr(2), param);\n\t\t\t} else if (isDynamic) {\n\t\t\t\tif (htmlProps[attributeName]) {\n\t\t\t\t\tcomputed(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\telement[attributeName] = param();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[ param ]\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tcomputed(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\telement.setAttribute(attributeName, param());\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[ param ]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (htmlProps[attributeName]) {\n\t\t\t\t\telement[attributeName] = param;\n\t\t\t\t} else if (typeof param === 'function') {\n\t\t\t\t\tparam(element);\n\t\t\t\t} else {\n\t\t\t\t\telement.setAttribute(attributeName, param);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (paramType === FN) {\n\t\t\tif (commentNode.parentElement) {\n\t\t\t\tparam(commentNode.parentElement, commentNode.nextElementSibling);\n\t\t\t\tcommentNode.remove();\n\t\t\t} else {\n\t\t\t\t//conditionalDom can be place on root\n\t\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t\tparam(commentNode.parentElement, commentNode.nextElementSibling);\n\t\t\t\t\tcommentNode.remove();\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (paramType === ARRAY) {\n\t\t\tconst fragment = document.createDocumentFragment();\n\t\t\tparam.forEach((p) => {\n\t\t\t\tfragment.appendChild(p);\n\t\t\t});\n\t\t\tcommentNode.parentElement.insertBefore(fragment, commentNode.nextSibling);\n\t\t} else if (paramType === HTM) {\n\t\t\tif (param.renderFn) {\n\t\t\t\tarrayMap(\n\t\t\t\t\tparam.arr,\n\t\t\t\t\tcommentNode.parentElement,\n\t\t\t\t\tcommentNode.nextSibling as any,\n\t\t\t\t\tparam.renderFn,\n\t\t\t\t\tparam.renderMode\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tcommentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport const arrayMap = <T>(\n\tarr: FidanValue<T[]>,\n\tparentDom: Node & ParentNode,\n\tnextElement: Element,\n\trenderCallback: (item: any, idx?: number, isInsert?: boolean) => Node,\n\trenderMode: 'reuse' | 'reconcile' = 'reconcile'\n) => {\n\tconst prevElement = nextElement ? document.createTextNode('') : undefined;\n\tnextElement && parentDom.insertBefore(prevElement, nextElement);\n\tcomputed<any[]>(\n\t\t(nextVal, { caller }) => {\n\t\t\tconst beforeVal = caller.$val;\n\t\t\tconst renderFunction: (parent, renderedValues, data, createFn, noOp, beforeNode?, afterNode?) => void =\n\t\t\t\trenderMode === 'reconcile' ? reconcile : reuseNodes;\n\t\t\trenderFunction(\n\t\t\t\tparentDom,\n\t\t\t\tbeforeVal || [],\n\t\t\t\tnextVal || [],\n\t\t\t\t(nextItem, index) => {\n\t\t\t\t\tlet rendered = renderCallback(nextItem, index) as any;\n\t\t\t\t\treturn rendered instanceof Node ? rendered : document.createTextNode(rendered);\n\t\t\t\t},\n\t\t\t\t() => {},\n\t\t\t\tprevElement,\n\t\t\t\tnextElement\n\t\t\t);\n\t\t},\n\t\t[ arr ]\n\t);\n\tconst nextVal = arr.$val.slice(0);\n\tarr.$val = [];\n\tarr(nextVal);\n};\n"],"names":["let","autoTracks","value","val","hasOwnProperty","innerFn","opt","undefined","indexOf","push","updateAfter","Array","isArray","depends","length","i","compute","caller","$val","debugName","name","Object","defineProperty","toString","toJSON","deps","renderFn","renderMode","arr","computed","fn","dependencies","cmp","injectToProperty","obj","propertyKey","configurable","enumerable","get","set","v","inject","key","debounce","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","reconcile","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstElementChild","tmp","removeChild","textContent","mode","len","insertBefore","appendChild","prevStart","newStart","loop","prevEnd","newEnd","a","b","prevStartNode","newStartNode","prevEndNode","previousSibling","lastElementChild","newEndNode","fixes","_node","next","P","I","Map","reusingNodes","toRemove","has","longestSeq","longestPositiveIncreasingSubsequence","nodes","tmpC","lisIdx","tmpD","ns","seq","is","l","pre","n","j","findGreatestIndexLEQ","lo","hi","mid","Math","floor","const","reuseNodes","firstChild","tail","lastChild","_head","_mode","item","head","TEXT","DOM","FN","HTM","ARRAY","TEXT_OR_DOM","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","checked","disabled","readonly","contentEditable","template","document","createElement","html","literals","raw","result","vars","str","startsWith","substr","endsWith","p","lastIndexOf","attr","comment","trim","extra","cloneNode","element","content","commentNodes","walkForCommentNodes","updateNodesByCommentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","params","commentNode","commentValue","attributeName","param","isDynamic","attrIdx","paramType","createTextNode","parentElement","nextElementSibling","remove","addEventListener","setAttribute","window","requestAnimationFrame","fragment","createDocumentFragment","forEach","arrayMap","parentDom","nextElement","renderCallback","prevElement","nextVal","beforeVal","renderFunction","nextItem","index","rendered","Node","slice"],"mappings":"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"}