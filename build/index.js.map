{"version":3,"file":"index.js","sources":["../src/evented-array.ts","../src/f.ts","../src/context.ts","../src/dom.ts","../src/dom-tree.ts","../src/observable.ts","../src/util.ts"],"sourcesContent":["// https://stackoverflow.com/questions/5100376/how-to-watch-for-array-changes\nexport function EventedArray(items) {\n\tvar _self = this,\n\t\t_array = [],\n\t\t_handlers = {\n\t\t\titemadded: [],\n\t\t\titemremoved: [],\n\t\t\titemset: [],\n\t\t\tbeforemulti: [],\n\t\t\taftermulti: []\n\t\t};\n\n\tfunction defineIndexProperty(index) {\n\t\tif (!(index in _self)) {\n\t\t\tObject.defineProperty(_self, index, {\n\t\t\t\tconfigurable: true,\n\t\t\t\tenumerable: true,\n\t\t\t\tget: function() {\n\t\t\t\t\treturn _array[index];\n\t\t\t\t},\n\t\t\t\tset: function(v) {\n\t\t\t\t\t_array[index] = v;\n\t\t\t\t\traiseEvent({\n\t\t\t\t\t\ttype: 'itemset',\n\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\titem: v\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction raiseEvent(event) {\n\t\t_handlers[event.type].forEach(function(h) {\n\t\t\th.call(_self, event);\n\t\t});\n\t}\n\n\t_self.on = function(eventName, handler) {\n\t\t_handlers[eventName].push(handler);\n\t};\n\n\t_self.off = function(eventName, handler) {\n\t\tvar h = _handlers[eventName];\n\t\tvar ln = h.length;\n\t\twhile (--ln >= 0) {\n\t\t\tif (h[ln] === handler) {\n\t\t\t\th.splice(ln, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\t_self.push = function() {\n\t\tvar index;\n\t\targuments.length > 1 &&\n\t\t\traiseEvent({\n\t\t\t\ttype: 'beforemulti'\n\t\t\t});\n\t\tfor (var i = 0, ln = arguments.length; i < ln; i++) {\n\t\t\tindex = _array.length;\n\t\t\t_array.push(arguments[i]);\n\t\t\tdefineIndexProperty(index);\n\t\t\traiseEvent({\n\t\t\t\ttype: 'itemadded',\n\t\t\t\tindex: index,\n\t\t\t\titem: arguments[i]\n\t\t\t});\n\t\t}\n\t\targuments.length > 1 &&\n\t\t\traiseEvent({\n\t\t\t\ttype: 'aftermulti'\n\t\t\t});\n\t\treturn _array.length;\n\t};\n\n\t_self.pop = function() {\n\t\tif (_array.length > -1) {\n\t\t\tvar index = _array.length - 1,\n\t\t\t\titem = _array.pop();\n\t\t\tdelete _self[index];\n\t\t\traiseEvent({\n\t\t\t\ttype: 'itemremoved',\n\t\t\t\tindex: index,\n\t\t\t\titem: item\n\t\t\t});\n\t\t\treturn item;\n\t\t}\n\t};\n\n\t_self.unshift = function() {\n\t\tfor (var i = 0, ln = arguments.length; i < ln; i++) {\n\t\t\t_array.splice(i, 0, arguments[i]);\n\t\t\tdefineIndexProperty(_array.length - 1);\n\t\t\traiseEvent({\n\t\t\t\ttype: 'itemadded',\n\t\t\t\tindex: i,\n\t\t\t\titem: arguments[i]\n\t\t\t});\n\t\t}\n\t\tfor (; i < _array.length; i++) {\n\t\t\traiseEvent({\n\t\t\t\ttype: 'itemset',\n\t\t\t\tindex: i,\n\t\t\t\titem: _array[i]\n\t\t\t});\n\t\t}\n\t\treturn _array.length;\n\t};\n\n\t_self.shift = function() {\n\t\tif (_array.length > -1) {\n\t\t\tvar item = _array.shift();\n\t\t\tdelete _self[_array.length];\n\t\t\traiseEvent({\n\t\t\t\ttype: 'itemremoved',\n\t\t\t\tindex: 0,\n\t\t\t\titem: item\n\t\t\t});\n\t\t\treturn item;\n\t\t}\n\t};\n\n\t_self.splice = function(index, howMany /*, element1, element2, ... */) {\n\t\tvar removed = [],\n\t\t\titem,\n\t\t\tpos;\n\n\t\tindex = index == null ? 0 : index < 0 ? _array.length + index : index;\n\n\t\thowMany = howMany == null ? _array.length - index : howMany > 0 ? howMany : 0;\n\n\t\twhile (howMany--) {\n\t\t\titem = _array.splice(index, 1)[0];\n\t\t\tremoved.push(item);\n\t\t\tdelete _self[_array.length];\n\t\t\traiseEvent({\n\t\t\t\ttype: 'itemremoved',\n\t\t\t\tindex: index + removed.length - 1,\n\t\t\t\titem: item\n\t\t\t});\n\t\t}\n\n\t\tfor (var i = 2, ln = arguments.length; i < ln; i++) {\n\t\t\t_array.splice(index, 0, arguments[i]);\n\t\t\tdefineIndexProperty(_array.length - 1);\n\t\t\traiseEvent({\n\t\t\t\ttype: 'itemadded',\n\t\t\t\tindex: index,\n\t\t\t\titem: arguments[i]\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\n\t\treturn removed;\n\t};\n\n\tObject.defineProperty(_self, 'length', {\n\t\tconfigurable: false,\n\t\tenumerable: false,\n\t\tget: function() {\n\t\t\treturn _array.length;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar n = Number(value);\n\t\t\tvar length = _array.length;\n\t\t\tif (n % 1 === 0 && n >= 0) {\n\t\t\t\tif (n < length) {\n\t\t\t\t\t_self.splice(n);\n\t\t\t\t} else if (n > length) {\n\t\t\t\t\t_self.push.apply(_self, new Array(n - length));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new RangeError('Invalid array length');\n\t\t\t}\n\t\t\t_array.length = n;\n\t\t\treturn value;\n\t\t}\n\t});\n\n\tObject.defineProperty(_self, 'innerArray', {\n\t\tconfigurable: false,\n\t\tenumerable: false,\n\t\tget: function() {\n\t\t\treturn _array;\n\t\t},\n\t\tset: function(v) {\n\t\t\t// _self.push.apply(_self, v); // renderAll\n\t\t\t_array = v;\n\t\t\tfor (var i = 0; i < v.length; i++) {\n\t\t\t\tdefineIndexProperty(i);\n\t\t\t}\n\t\t}\n\t});\n\n\tObject.getOwnPropertyNames(Array.prototype).forEach(function(name) {\n\t\tif (!(name in _self)) {\n\t\t\tObject.defineProperty(_self, name, {\n\t\t\t\tconfigurable: false,\n\t\t\t\tenumerable: false,\n\t\t\t\twritable: false,\n\t\t\t\tvalue: Array.prototype[name]\n\t\t\t});\n\t\t}\n\t});\n\n\t_self.toJSON = () => {\n\t\treturn _array;\n\t};\n\n\tif (items instanceof Array) {\n\t\t_self.push.apply(_self, items);\n\t}\n}\n","import { EventedArray } from './evented-array';\r\n\r\nexport interface FidanValue<T> {\r\n\t(val: T): void;\r\n\treadonly $val: T;\r\n\tfreezed: boolean;\r\n}\r\n\r\nexport type FidanArrayEventType = 'itemadded' | 'itemset' | 'itemremoved';\r\n\r\nexport const value = <T>(value?: T, freezed?: boolean): FidanValue<T> => {\r\n\tif (value && value['$val'] != undefined) throw 'Fidan: Higher ordered signals is not supported.';\r\n\tconst innerFn: any = (val?) => {\r\n\t\tif (Array.isArray(val)) {\r\n\t\t\t// TODO arrayler için compile time x.$val = y şeklinde tanımlama olmuş olmalı o zaman yukardaki innerFn gereksiz olur\r\n\t\t\t// TODO https://github.com/WebReflection/majinbuu\r\n\t\t\tinnerFn['$val'].innerArray = val;\r\n\t\t} else innerFn['$val'] = val;\r\n\t\tconst depends = innerFn['depends'];\r\n\t\tif (depends.length)\r\n\t\t\tfor (var i = 0; i < depends.length; i++) !depends[i]['freezed'] && depends[i](depends[i].compute());\r\n\t};\r\n\tinnerFn['$val'] = value;\r\n\tinnerFn['freezed'] = freezed;\r\n\r\n\tinnerFn['depends'] = [];\r\n\tinnerFn.toString = innerFn.toJSON = () => innerFn['$val'].toString();\r\n\treturn innerFn;\r\n};\r\n\r\nexport const array = <T>(\r\n\titems: T[]\r\n): {\r\n\ton?: (type: FidanArrayEventType, callback: (e: { item: T; index: number }) => void) => void;\r\n\tremoveEventListener?: (type: FidanArrayEventType) => void;\r\n\t$val: T[];\r\n} & FidanValue<T> => {\r\n\tconst arr = value(new EventedArray(items)) as any;\r\n\tarr.on = arr.$val.on;\r\n\tarr.off = arr.$val.off;\r\n\tarr.toJSON = () => arr.$val.innerArray;\r\n\r\n\treturn arr;\r\n};\r\n\r\nexport const on = (arr: any[], type: FidanArrayEventType, callback: (e: { item: any; index: number }) => void) => {\r\n\tarr['$val'].on(type, callback);\r\n};\r\n\r\nexport const off = (arr: any[], type: FidanArrayEventType, callback: (e: { item: any; index: number }) => void) => {\r\n\tarr['$val'].off(type, callback);\r\n};\r\n\r\nexport const compute = (fn: () => void, ...args: any[]) => {\r\n\tvar compute = value();\r\n\tcompute['compute'] = fn;\r\n\tfor (var i = 0; i < args.length; i++) args[i]['depends'].push(compute);\r\n\tfn();\r\n};\r\n\r\nexport const initCompute = (fn: () => any, ...args: any[]) => {\r\n\tconst cValue = value(fn());\r\n\tcompute(() => {\r\n\t\tcValue(fn());\r\n\t}, ...args);\r\n\treturn cValue;\r\n};\r\n\r\nexport const computeReturn = <T>(fn: () => T, ...args: any[]): T => initCompute(fn, ...args) as any;\r\n\r\nexport const setCompute = (prev: any, fn: () => void, ...args: any[]) => {\r\n\tdestroy(prev);\r\n\treturn initCompute(prev, fn, ...args);\r\n};\r\n\r\nexport const destroy = (item: any) => {\r\n\tdelete item['compute'];\r\n\tdelete item['depends'];\r\n};\r\n","const activeContextKeys = [];\nconst appContext: { [key: string]: any[] } = {};\n\nexport const startContext = (key: string, value: any) => {\n  if (!appContext[key]) appContext[key] = [];\n  appContext[key].push(value);\n  activeContextKeys.push(key);\n};\n\nexport const getContextValue = (key: string, componentProps: any) => {\n  if (componentProps && componentProps[\"$context\"][key])\n    return componentProps[\"$context\"][key];\n  if (appContext[key]) return appContext[key][appContext[key].length - 1];\n};\n\nexport const injectContexts = (componentProps: any) => {\n  if (!componentProps[\"$context\"])\n    Object.defineProperty(componentProps, \"$context\", {\n      configurable: false,\n      enumerable: false,\n      value: {}\n    });\n  let key = null;\n  for (var i = 0; i < activeContextKeys.length; i++) {\n    key = activeContextKeys[i];\n    componentProps[\"$context\"][key] =\n      appContext[key][appContext[key].length - 1];\n  }\n};\n\nexport const endContext = (key: string) => {\n  appContext[key].pop();\n  activeContextKeys.pop();\n};\n\nexport const activateContext = context => {\n  for (var key in context) startContext(key, context[key]);\n};\n\nexport const deactivateContext = context => {\n  for (var key in context) endContext(key);\n};\n\nexport const Context = (props: { key: string; value: any }) => null;\n","import { FidanValue } from '.';\nimport { EventedArray } from './evented-array';\nimport { compute } from './f';\nimport { activateContext, deactivateContext } from '../src/context';\n\nexport const conditionalElement = (parentElement, oldElement, newElementFn: () => any) => {\n\tparentElement['$props'] && activateContext(parentElement['$props']['$context']);\n\tlet newElement = newElementFn();\n\tparentElement['$props'] && deactivateContext(parentElement['$props']['$context']);\n\tif (newElement instanceof Node === false) newElement = document.createTextNode(newElement || '');\n\tif (oldElement) parentElement.replaceChild(newElement, oldElement);\n\telse parentElement.appendChild(newElement);\n\treturn newElement;\n};\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n\tif (itemElement instanceof Function) itemElement(parentElement);\n\telse {\n\t\tif (itemElement instanceof Node === false) itemElement = document.createTextNode(itemElement);\n\t\tparentElement.insertBefore(itemElement, parentElement.childNodes[index]);\n\t}\n};\n\nexport const arrayMap = (\n\tarr: FidanValue<any[]>,\n\tparentDom: Node,\n\trenderReturn: (item: any, idx?: number, isInsert?: boolean) => void\n) => {\n\tconst oArr = arr.$val instanceof EventedArray ? arr.$val : new EventedArray(arr.$val);\n\n\tlet parentRef: { parent: Node; next: Node } = null;\n\toArr.on('beforemulti', function() {\n\t\tif (parentDom.parentNode) {\n\t\t\tparentRef = { parent: parentDom, next: parentDom.nextSibling };\n\t\t\tparentDom = document.createDocumentFragment();\n\t\t}\n\t});\n\toArr.on('aftermulti', function() {\n\t\tif (parentRef) {\n\t\t\tparentRef.parent.insertBefore(parentDom, parentRef.next);\n\t\t\tparentDom = parentRef.parent;\n\t\t}\n\t});\n\n\toArr.on('itemadded', function(e) {\n\t\tinsertToDom(parentDom, e.index, renderReturn(e.item, e.index));\n\t});\n\n\toArr.on('itemset', function(e) {\n\t\tparentDom.replaceChild(renderReturn(e.item, e.index) as any, parentDom.childNodes.item(e.index));\n\t});\n\n\toArr.on('itemremoved', function(e) {\n\t\tparentDom.removeChild(parentDom.childNodes.item(e.index));\n\t});\n\tarr(oArr);\n\n\tconst renderAll = () => {\n\t\tif (arr.$val.length === 0) parentDom.textContent = '';\n\t\telse {\n\t\t\tconst parentFragment = document.createDocumentFragment();\n\t\t\tparentDom.textContent = '';\n\t\t\tfor (var i = (parentDom as Element).childElementCount; i < arr.$val.length; i++)\n\t\t\t\tinsertToDom(parentFragment, i, renderReturn(arr.$val[i], i));\n\t\t\tparentDom.appendChild(parentFragment);\n\t\t}\n\t};\n\tcompute(renderAll, arr);\n};\n","import { injectContexts } from './context';\r\n\r\nvar jsxEventProperty = /^on[A-Z]/;\r\nconst svgNS = 'http://www.w3.org/2000/svg';\r\nexport const Fragment = Symbol('fjsx.Fragment');\r\n\r\nexport const setElementAttributes = (element: Element, attributes, forceSetAttr?: boolean) => {\r\n\tlet attribute = null;\r\n\tfor (var attributeName in attributes) {\r\n\t\tattribute = attributes[attributeName];\r\n\t\tif (attribute != undefined) {\r\n\t\t\tif (attribute instanceof Function) {\r\n\t\t\t\tif (jsxEventProperty.test(attributeName)) {\r\n\t\t\t\t\tattributeName = attributeName.toLowerCase();\r\n\t\t\t\t\telement[attributeName] = attribute;\r\n\t\t\t\t} else attribute(element);\r\n\t\t\t} else if (attribute instanceof Object) {\r\n\t\t\t\tif (Array.isArray(attribute)) {\r\n\t\t\t\t\taddChildElements(element, attribute);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (var key in attribute) {\r\n\t\t\t\t\t\tif (typeof attribute[key] === 'function') attribute[key](element);\r\n\t\t\t\t\t\telse element[attributeName][key] = attribute[key]; // style like\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (forceSetAttr || attributeName.indexOf('-') !== -1) element.setAttribute(attributeName, attribute);\r\n\t\t\t\telse element[attributeName] = attribute;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport const createElement = (\r\n\ttagName: string | Function | Symbol,\r\n\tattributes: { [key: string]: any },\r\n\t...childs: any[]\r\n) => {\r\n\tlet element = null;\r\n\tif (tagName instanceof Function) {\r\n\t\tif (attributes === null) attributes = {};\r\n\t\tif (childs && childs.length) attributes['children'] = childs;\r\n\t\tinjectContexts(attributes);\r\n\t\telement = (tagName as any)(attributes);\r\n\t\tif (element) element['$props'] = attributes;\r\n\t} else {\r\n\t\tif (tagName === Fragment) {\r\n\t\t\telement = document.createDocumentFragment();\r\n\t\t} else {\r\n\t\t\telement = document.createElement(tagName as any);\r\n\t\t\tattributes && setElementAttributes(element, attributes, (tagName as string).indexOf('-') !== -1);\r\n\t\t}\r\n\t\telement['$props'] = attributes;\r\n\t\tchilds && childs.length && addChildElements(element, childs);\r\n\t}\r\n\treturn element;\r\n};\r\n\r\nexport const createSvgElement = (tagName: string, attributes: { [key: string]: any }, ...childs: any[]) => {\r\n\tlet element = document.createElementNS(svgNS, tagName);\r\n\tif (attributes) {\r\n\t\tif (attributes.className) {\r\n\t\t\t// TODO compile time\r\n\t\t\tattributes.class = attributes.className;\r\n\t\t\tdelete attributes.className;\r\n\t\t}\r\n\t\tsetElementAttributes(element, attributes, true);\r\n\t}\r\n\telement['$props'] = attributes;\r\n\tchilds && childs.length && addChildElements(element, childs);\r\n\treturn element;\r\n};\r\n\r\nexport const addChildElements = (element, childs) => {\r\n\tlet props = null;\r\n\tfor (var i = 0; i < childs.length; i++) {\r\n\t\tif (Array.isArray(childs[i])) addChildElements(element, childs[i]);\r\n\t\telse if (childs[i] instanceof Function) childs[i](element);\r\n\t\telse {\r\n\t\t\tif (childs[i]) {\r\n\t\t\t\tprops = childs[i]['$props'];\r\n\t\t\t\telement.appendChild(childs[i] instanceof Node ? childs[i] : document.createTextNode(childs[i]));\r\n\t\t\t\tprops && props.didMount && props.didMount(element, childs[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport const createTextNode = (parent) => {\r\n\treturn parent.appendChild(document.createTextNode(''));\r\n};\r\n\r\nexport const cloneElement = (element: Element, attributes: any) => {\r\n\telement = element.cloneNode(true) as Element;\r\n\tattributes && setElementAttributes(element, attributes, false);\r\n\treturn element;\r\n};\r\n","import { FidanValue, value } from '.';\nimport $$symbolObservable from 'symbol-observable';\n\n// https://medium.com/@fknussel/a-simple-observable-implementation-c9c809c89c69\n\nclass Observer {\n\tisUnsubscribed = false;\n\thandlers: Partial<Observer> = null;\n\t_unsubscribe = null;\n\tconstructor(handlers: Partial<Observer>) {\n\t\tthis.handlers = handlers; // next, error and complete logic\n\t\tthis.isUnsubscribed = false;\n\t}\n\n\tnext(value) {\n\t\tif (this.handlers.next && !this.isUnsubscribed) {\n\t\t\tthis.handlers.next(value);\n\t\t}\n\t}\n\n\terror(error) {\n\t\tif (!this.isUnsubscribed) {\n\t\t\tif (this.handlers.error) {\n\t\t\t\tthis.handlers.error(error);\n\t\t\t}\n\n\t\t\tthis.unsubscribe();\n\t\t}\n\t}\n\n\tcomplete() {\n\t\tif (!this.isUnsubscribed) {\n\t\t\tif (this.handlers.complete) {\n\t\t\t\tthis.handlers.complete();\n\t\t\t}\n\n\t\t\tthis.unsubscribe();\n\t\t}\n\t}\n\n\tunsubscribe() {\n\t\tthis.isUnsubscribed = true;\n\n\t\tif (this._unsubscribe) {\n\t\t\tthis._unsubscribe();\n\t\t}\n\t}\n}\n\nclass Observable {\n\t_subscribe: (observer: Observer) => () => void = null;\n\tconstructor(subscribe) {\n\t\tthis._subscribe = subscribe;\n\t}\n\n\tsubscribe(obs: Partial<Observer>) {\n\t\tconst observer = new Observer(obs);\n\n\t\tobserver._unsubscribe = this._subscribe(observer);\n\n\t\treturn {\n\t\t\tunsubscribe() {\n\t\t\t\tobserver.unsubscribe();\n\t\t\t}\n\t\t};\n\t}\n\n\t[$$symbolObservable]() {\n\t\treturn this;\n\t}\n}\n\nexport const toObservable = <T>(data: FidanValue<any>): T => {\n\treturn new Observable((observer) => {\n\t\tvar compute = value(() => {\n\t\t\tobserver.next(data.$val);\n\t\t});\n\t\tdata['depends'].push(compute);\n\t}) as any;\n};\n","import { value } from './f';\n\nexport const setDefaults = <T>(obj: T, defaults: { [key in keyof T]?: any }) => {\n\tfor (var key in defaults) {\n\t\tif (obj[key] === undefined) obj[key] = defaults[key];\n\t}\n};\n\nexport const mapProperty = (obj: Object, propertyKey: string, value$: any) => {\n\tconst descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n\tif (descr.configurable)\n\t\tObject.defineProperty(obj, propertyKey, {\n\t\t\tconfigurable: false,\n\t\t\tenumerable: true,\n\t\t\tget: () => {\n\t\t\t\treturn value$.$val;\n\t\t\t},\n\t\t\tset: value$\n\t\t});\n\telse {\n\t\tdescr.set['depends'].push(\n\t\t\tvalue(() => {\n\t\t\t\tvalue$(obj[propertyKey]);\n\t\t\t})\n\t\t);\n\t}\n};\n"],"names":["EventedArray","items","_self","this","_array","_handlers","itemadded","itemremoved","itemset","beforemulti","aftermulti","defineIndexProperty","index","Object","defineProperty","configurable","enumerable","get","set","v","raiseEvent","type","item","event","forEach","h","call","on","eventName","handler","push","off","ln","length","splice","arguments","i","pop","unshift","shift","howMany","removed","value","n","Number","RangeError","apply","Array","getOwnPropertyNames","prototype","name","writable","toJSON","freezed","undefined","const","innerFn","val","isArray","innerArray","depends","compute","toString","fn","args","initCompute","cValue","destroy","activeContextKeys","appContext","startContext","key","injectContexts","componentProps","let","endContext","activateContext","context","deactivateContext","insertToDom","parentElement","itemElement","Function","Node","document","createTextNode","insertBefore","childNodes","jsxEventProperty","Fragment","Symbol","setElementAttributes","element","attributes","forceSetAttr","attribute","attributeName","test","toLowerCase","addChildElements","indexOf","setAttribute","childs","props","appendChild","didMount","Observer","handlers","isUnsubscribed","next","error","unsubscribe","complete","_unsubscribe","Observable","subscribe","_subscribe","obs","observer","$$symbolObservable","arr","$val","callback","prev","oldElement","newElementFn","newElement","replaceChild","parentDom","renderReturn","oArr","parentRef","parentNode","parent","nextSibling","createDocumentFragment","e","removeChild","textContent","parentFragment","childElementCount","tagName","createElement","createElementNS","className","class","cloneNode","data","obj","defaults","propertyKey","value$","descr","getOwnPropertyDescriptor"],"mappings":"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"}