{"version":3,"file":"index.js","sources":["../src/overrided-array.ts","../src/f.ts","../src/reuse-nodes.ts","../src/reconcile.ts","../src/dom.ts","../src/util.ts","../src/html.ts"],"sourcesContent":["import { FidanArray } from \".\";\n\nexport const overrideArrayMutators = <T>(dataArray: FidanArray<T>) => {\n  // if (!dataArray.$val[\"$overrided\"])\n  [\n    \"copyWithin\",\n    \"fill\",\n    \"pop\",\n    \"push\",\n    \"reverse\",\n    \"shift\",\n    \"sort\",\n    \"splice\",\n    \"unshift\"\n  ].forEach(method => {\n    dataArray.$val[method] = function() {\n      const arr = this.slice(0);\n      Array.prototype[method].apply(arr, arguments);\n      dataArray(arr);\n    };\n    // dataArray.$val[\"$overrided\"] = true;\n  });\n};\n","import { FidanArray, FidanValue, FidanData } from \".\";\r\nimport { overrideArrayMutators } from \"./overrided-array\";\r\n\r\nlet autoTrackDependencies: any[] = null;\r\n\r\nexport const array = <T>(items: T[]): FidanArray<T> => {\r\n  const arr = value(items) as FidanArray<T>;\r\n  arr[\"toJSON\"] = () => arr.$val;\r\n\r\n  // arr.size = value(items.length);\r\n\r\n  // arr.$val.on(\"itemadded\", () => arr.size(arr.$val.innerArray.length));\r\n  // arr.$val.on(\"itemremoved\", () => arr.size(arr.$val.innerArray.length));\r\n\r\n  return arr;\r\n};\r\n\r\nexport const value = <T>(val?: T): FidanValue<T> => {\r\n  const innerFn: any = (val?) => {\r\n    if (val === undefined) {\r\n      if (\r\n        autoTrackDependencies &&\r\n        autoTrackDependencies.indexOf(innerFn) === -1\r\n      ) {\r\n        autoTrackDependencies.push(innerFn);\r\n      }\r\n      return innerFn[\"$val\"];\r\n    } else {\r\n      let depends = innerFn[\"bc_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i].beforeCompute(val, innerFn[\"$val\"], innerFn);\r\n        }\r\n      innerFn[\"$val\"] = val;\r\n      if (Array.isArray(val)) {\r\n        overrideArrayMutators(innerFn);\r\n      }\r\n      depends = innerFn[\"c_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i](depends[i].compute(val));\r\n        }\r\n    }\r\n  };\r\n\r\n  innerFn[\"$val\"] = val;\r\n  innerFn[\"bc_depends\"] = [];\r\n  innerFn[\"c_depends\"] = [];\r\n  innerFn.depends = (dependencies: () => FidanData<any>[]): FidanValue<T> => {\r\n    const deps = dependencies();\r\n    for (var i = 0; i < deps.length; i++) innerFn[\"c_depends\"].push(deps[i]);\r\n    return innerFn;\r\n  };\r\n  innerFn.debugName = (name: string) => {\r\n    Object.defineProperty(innerFn, \"name\", { value: name });\r\n    return innerFn;\r\n  };\r\n  innerFn.toString = innerFn.toJSON = () => innerFn[\"$val\"];\r\n  return innerFn;\r\n};\r\n\r\nexport const compute = <T>(\r\n  fn: (val: T, changedItem?) => any,\r\n  dependencies?: () => FidanData<any>[]\r\n) => {\r\n  autoTrackDependencies = dependencies ? null : [];\r\n  const val = fn(undefined);\r\n  const deps = autoTrackDependencies ? autoTrackDependencies : dependencies();\r\n  autoTrackDependencies = null;\r\n  const cmp = value(val);\r\n  cmp[\"compute\"] = fn;\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"c_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const beforeCompute = <T>(\r\n  initalValue: T,\r\n  fn: (nextValue?: T, prevValue?: T, changedItem?) => void,\r\n  dependencies: () => FidanData<any>[]\r\n) => {\r\n  const cmp = value(fn(initalValue));\r\n  cmp[\"beforeCompute\"] = fn;\r\n  const deps = dependencies();\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"bc_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const destroy = (item: any) => {\r\n  delete item[\"compute\"];\r\n  delete item[\"c_depends\"];\r\n};\r\n","// https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) => {\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n  if (renderedValues.length > data.length) {\n    let i = renderedValues.length,\n      tail =\n        afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n      tmp;\n    while (i > data.length) {\n      tmp = tail.previousSibling;\n      parent.removeChild(tail);\n      tail = tmp;\n      i--;\n    }\n  }\n\n  let _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n  if (_head === afterNode) _head = undefined;\n\n  let _mode = afterNode ? 1 : 0;\n  for (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n    item = data[i];\n    if (head) {\n      noOp(item, renderedValues[i]);\n    } else {\n      head = createFn(item);\n      mode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n    }\n    head = head.nextSibling;\n    if (head === afterNode) head = null;\n  }\n};\n","// This is almost straightforward implementation of reconcillation algorithm\n// based on ivi documentation:\n// https://github.com/localvoid/ivi/blob/2c81ead934b9128e092cc2a5ef2d3cabc73cb5dd/packages/ivi/src/vdom/implementation.ts#L1366\n// With some fast paths from Surplus implementation:\n// https://github.com/adamhaile/surplus/blob/master/src/runtime/content.ts#L86\n//\n// How this implementation differs from others, is that it's working with data directly,\n// without maintaining nodes arrays, and uses dom props firstElementChild/lastElementChild/nextElementSibling\n// for markers moving.\nexport function reconcile(\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) {\n  // Fast path for clear\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined\n            ? beforeNode.nextElementSibling\n            : parent.firstElementChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextElementSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n\n  // Fast path for create\n  if (renderedValues.length === 0) {\n    let node,\n      mode = afterNode !== undefined ? 1 : 0;\n    for (let i = 0, len = data.length; i < len; i++) {\n      node = createFn(data[i]);\n      mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n    }\n    return;\n  }\n\n  let prevStart = 0,\n    newStart = 0,\n    loop = true,\n    prevEnd = renderedValues.length - 1,\n    newEnd = data.length - 1,\n    a,\n    b,\n    prevStartNode = beforeNode\n      ? beforeNode.nextElementSibling\n      : parent.firstElementChild,\n    newStartNode = prevStartNode,\n    prevEndNode = afterNode\n      ? afterNode.previousElementSibling\n      : parent.lastElementChild,\n    newEndNode = prevEndNode;\n\n  fixes: while (loop) {\n    loop = false;\n    let _node;\n\n    // Skip prefix\n    (a = renderedValues[prevStart]), (b = data[newStart]);\n    while (a === b) {\n      noOp(prevStartNode, b);\n      prevStart++;\n      newStart++;\n      newStartNode = prevStartNode = prevStartNode.nextElementSibling;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevStart];\n      b = data[newStart];\n    }\n\n    // Skip suffix\n    (a = renderedValues[prevEnd]), (b = data[newEnd]);\n    while (a === b) {\n      noOp(prevEndNode, b);\n      prevEnd--;\n      newEnd--;\n      afterNode = prevEndNode;\n      newEndNode = prevEndNode = prevEndNode.previousElementSibling;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevEnd];\n      b = data[newEnd];\n    }\n\n    // Fast path to swap backward\n    (a = renderedValues[prevEnd]), (b = data[newStart]);\n    while (a === b) {\n      loop = true;\n      noOp(prevEndNode, b);\n      _node = prevEndNode.previousElementSibling;\n      parent.insertBefore(prevEndNode, newStartNode);\n      newEndNode = prevEndNode = _node;\n      newStart++;\n      prevEnd--;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevEnd];\n      b = data[newStart];\n    }\n\n    // Fast path to swap forward\n    (a = renderedValues[prevStart]), (b = data[newEnd]);\n    while (a === b) {\n      loop = true;\n      noOp(prevStartNode, b);\n      _node = prevStartNode.nextElementSibling;\n      parent.insertBefore(prevStartNode, afterNode);\n      prevStart++;\n      afterNode = newEndNode = prevStartNode;\n      prevStartNode = _node;\n      newEnd--;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevStart];\n      b = data[newEnd];\n    }\n  }\n\n  // Fast path for shrink\n  if (newEnd < newStart) {\n    if (prevStart <= prevEnd) {\n      let next;\n      while (prevStart <= prevEnd) {\n        if (prevEnd === 0) {\n          parent.removeChild(prevEndNode);\n        } else {\n          next = prevEndNode.previousElementSibling;\n          parent.removeChild(prevEndNode);\n          prevEndNode = next;\n        }\n        prevEnd--;\n      }\n    }\n    return;\n  }\n\n  // Fast path for add\n  if (prevEnd < prevStart) {\n    if (newStart <= newEnd) {\n      let node,\n        mode = afterNode ? 1 : 0;\n      while (newStart <= newEnd) {\n        node = createFn(data[newStart]);\n        mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n        newStart++;\n      }\n    }\n    return;\n  }\n\n  // Positions for reusing nodes from current DOM state\n  const P = new Array(newEnd + 1 - newStart);\n  for (let i = newStart; i <= newEnd; i++) P[i] = -1;\n\n  // Index to resolve position from current to new\n  const I = new Map();\n  for (let i = newStart; i <= newEnd; i++) I.set(data[i], i);\n\n  let reusingNodes = newStart + data.length - 1 - newEnd,\n    toRemove = [];\n\n  for (let i = prevStart; i <= prevEnd; i++) {\n    if (I.has(renderedValues[i])) {\n      P[I.get(renderedValues[i])] = i;\n      reusingNodes++;\n    } else {\n      toRemove.push(i);\n    }\n  }\n\n  // Fast path for full replace\n  if (reusingNodes === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined\n            ? beforeNode.nextElementSibling\n            : parent.firstElementChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextElementSibling;\n        parent.removeChild(node);\n        node = tmp;\n        prevStart++;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n\n    let node,\n      mode = afterNode ? 1 : 0;\n    for (let i = newStart; i <= newEnd; i++) {\n      node = createFn(data[i]);\n      mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n    }\n\n    return;\n  }\n\n  // What else?\n  const longestSeq = longestPositiveIncreasingSubsequence(P, newStart);\n\n  // Collect nodes to work with them\n  const nodes = [];\n  let tmpC = prevStartNode;\n  for (let i = prevStart; i <= prevEnd; i++) {\n    nodes[i] = tmpC;\n    tmpC = tmpC.nextElementSibling;\n  }\n\n  for (let i = 0; i < toRemove.length; i++)\n    parent.removeChild(nodes[toRemove[i]]);\n\n  let lisIdx = longestSeq.length - 1,\n    tmpD;\n  for (let i = newEnd; i >= newStart; i--) {\n    if (longestSeq[lisIdx] === i) {\n      afterNode = nodes[P[longestSeq[lisIdx]]];\n      noOp(afterNode, data[i]);\n      lisIdx--;\n    } else {\n      if (P[i] === -1) {\n        tmpD = createFn(data[i]);\n      } else {\n        tmpD = nodes[P[i]];\n        noOp(tmpD, data[i]);\n      }\n      parent.insertBefore(tmpD, afterNode);\n      afterNode = tmpD;\n    }\n  }\n}\n\nexport default reconcile;\n\n// Picked from\n// https://github.com/adamhaile/surplus/blob/master/src/runtime/content.ts#L368\n\n// return an array of the indices of ns that comprise the longest increasing subsequence within ns\nfunction longestPositiveIncreasingSubsequence(ns, newStart) {\n  var seq = [],\n    is = [],\n    l = -1,\n    pre = new Array(ns.length);\n\n  for (var i = newStart, len = ns.length; i < len; i++) {\n    var n = ns[i];\n    if (n < 0) continue;\n    var j = findGreatestIndexLEQ(seq, n);\n    if (j !== -1) pre[i] = is[j];\n    if (j === l) {\n      l++;\n      seq[l] = n;\n      is[l] = i;\n    } else if (n < seq[j + 1]) {\n      seq[j + 1] = n;\n      is[j + 1] = i;\n    }\n  }\n\n  for (i = is[l]; l >= 0; i = pre[i], l--) {\n    seq[l] = i;\n  }\n\n  return seq;\n}\n\nfunction findGreatestIndexLEQ(seq, n) {\n  // invariant: lo is guaranteed to be index of a value <= n, hi to be >\n  // therefore, they actually start out of range: (-1, last + 1)\n  var lo = -1,\n    hi = seq.length;\n\n  // fast path for simple increasing sequences\n  if (hi > 0 && seq[hi - 1] <= n) return hi - 1;\n\n  while (hi - lo > 1) {\n    var mid = Math.floor((lo + hi) / 2);\n    if (seq[mid] > n) {\n      hi = mid;\n    } else {\n      lo = mid;\n    }\n  }\n\n  return lo;\n}\n","import { beforeCompute, compute } from \"./f\";\nimport { reuseNodes } from \"./reuse-nodes\";\nimport { FidanArray, FidanData } from \".\";\nimport reconcile from \"./reconcile\";\n\nexport const coditionalDom = (\n  condition: () => boolean,\n  dependencies: () => FidanData<any>[],\n  htmlFragment: DocumentFragment\n) => (parentElement: Element, nextElement: Element) => {\n  const childs = Array.from(htmlFragment.children);\n  let inserted = false;\n  compute(() => {\n    if (condition()) {\n      if (!inserted) {\n        let tmpNextElement = nextElement;\n        for (var i = childs.length - 1; i >= 0; i--) {\n          const child = childs[i];\n          tmpNextElement = parentElement.insertBefore(child, tmpNextElement);\n        }\n        inserted = true;\n      }\n    } else {\n      childs.forEach(child => child.remove());\n      inserted = false;\n    }\n  }, dependencies);\n};\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n  const typeOf = typeof itemElement;\n  if (typeOf === \"function\") {\n    itemElement(parentElement);\n  } else {\n    if (typeOf !== \"object\") {\n      itemElement = document.createTextNode(itemElement);\n    }\n    parentElement.insertBefore(itemElement, parentElement.children[index]);\n  }\n};\n\nexport const arrayMap = <T>(\n  arr: FidanArray<T>,\n  parentDom: Node & ParentNode,\n  nextElement: Element,\n  renderCallback: (item: any, idx?: number, isInsert?: boolean) => Node,\n  renderMode?: \"reuse\" | \"reconcile\"\n) => {\n  beforeCompute(\n    arr.$val,\n    (nextVal, beforeVal) => {\n      // reconcile(\n      //   parentDom,\n      //   beforeVal || [],\n      //   nextVal,\n      //   item => {\n      //     return renderCallback(item);\n      //   },\n      //   () => {}\n      // );\n\n      if (!renderMode) {\n        const parentFragment = document.createDocumentFragment();\n        parentDom.textContent = \"\";\n        for (var i = 0; i < arr.$val.length; i++) {\n          insertToDom(parentFragment, i, renderCallback(arr.$val[i], i));\n        }\n        parentDom.appendChild(parentFragment);\n      } else {\n        let renderFunction: (\n          parent,\n          renderedValues,\n          data,\n          createFn,\n          noOp,\n          beforeNode?,\n          afterNode?\n        ) => void = renderMode === \"reconcile\" ? reconcile : reuseNodes;\n        renderFunction(\n          parentDom,\n          beforeVal || [],\n          nextVal || [],\n          nextItem => {\n            // create\n            return renderCallback(nextItem);\n          },\n          (nextItem, prevItem) => {\n            // update\n            // for (var key in nextItem) {\n            //   if (prevItem[key].hasOwnProperty(\"$val\")) {\n            //     nextItem[key].depends = prevItem[key].depends;\n            //     prevItem[key](nextItem[key]());\n            //   }\n            // }\n          }\n        );\n      }\n    },\n    () => [arr]\n  );\n};\n","import { FidanData } from \".\";\nimport { value } from \"./f\";\n\nexport const injectToProperty = (\n  obj: Object,\n  propertyKey: string,\n  val: FidanData<any>\n) => {\n  const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n  if (descr.configurable)\n    Object.defineProperty(obj, propertyKey, {\n      configurable: false,\n      enumerable: true,\n      get: () => {\n        val();\n        return val;\n      },\n      set: v => val(v)\n    });\n  else {\n    descr.set[\"c_depends\"].push(val);\n  }\n};\n\nexport const inject = <T extends Object>(obj: T): T => {\n  for (var key in obj) {\n    injectToProperty(obj, key, value(obj[key]));\n  }\n  return obj;\n};\n\nexport const jsRoot = () => {\n  let root;\n\n  if (typeof self !== \"undefined\") {\n    root = self;\n  } else if (typeof window !== \"undefined\") {\n    root = window;\n  } else if (typeof global !== \"undefined\") {\n    root = global;\n  } else if (typeof module !== \"undefined\") {\n    root = module;\n  } else {\n    root = Function(\"return this\")();\n  }\n  return root;\n};\n","import { compute } from \"./f\";\nimport { arrayMap } from \"./dom\";\nimport { FidanArray } from \".\";\n\nconst COMMENT_TEXT = 1;\nconst COMMENT_DOM = 2;\nconst COMMENT_FN = 4; // \"function\" && !isDynamic\nconst COMMENT_HTM = 8;\nconst COMMENT_TEXT_OR_DOM = COMMENT_TEXT | COMMENT_DOM;\n\nconst htmlProps = {\n  id: true,\n  nodeValue: true,\n  textContent: true,\n  className: true,\n  innerHTML: true,\n  innerText: true,\n  tabIndex: true,\n  value: true,\n  checked: true,\n  disabled: true,\n  readonly: true,\n  contentEditable: true\n};\n\nlet _templateMode = false; // TODO kaldırılacak yerine başka bir yöntem geliştirilecek\nlet template = document.createElement(\"template\");\n\nconst isPromise = (obj): obj is Promise<any> => {\n  return (\n    !!obj &&\n    (typeof obj === \"object\" || typeof obj === \"function\") &&\n    typeof obj.then === \"function\"\n  );\n};\n\nconst putCommentToTagStart = (\n  htm: string[],\n  index: number,\n  comment: string\n) => {\n  for (var i = index; i >= 0; i--) {\n    let item = htm[i];\n    let p = item.lastIndexOf(\"<\");\n    if (p !== -1) {\n      htm[i] = item.substr(0, p) + comment + item.substr(p);\n      // htm[i] =\n      //   item.substr(0, p) + comment + item.substr(p, item.lastIndexOf(\" \") - p);\n      // if (htm[index + 1].substr(0, 1) === '\"') {\n      //   htm[index + 1] = htm[index + 1].substr(1);\n      // }\n      break;\n    }\n  }\n};\n\nexport const html = (...args) => {\n  const htm: string[] = args[0].slice();\n  const params = args.slice(1);\n  let attributeName: string = null;\n  let i = 0;\n\n  for (var index = 0; index < htm.length; index++) {\n    let item = htm[index];\n    const param = params[index];\n    if (param === undefined) {\n      break;\n    }\n    const isDynamic = param.hasOwnProperty(\"$val\");\n    if (isDynamic) {\n      if (param[\"$indexes\"] === undefined) {\n        param[\"$indexes\"] = [];\n      }\n      param[\"$indexes\"].push(index);\n    }\n    if (item.endsWith('=\"')) {\n      i = item.lastIndexOf(\" \") + 1;\n      attributeName = item.substr(i, item.length - i - 2);\n      putCommentToTagStart(\n        htm,\n        index,\n        `<!-- cmt_${COMMENT_DOM}_${index}_${attributeName} -->`\n      );\n    } else {\n      let commentType =\n        typeof param === \"function\" && !isDynamic\n          ? COMMENT_FN\n          : typeof param === \"object\"\n          ? COMMENT_HTM\n          : COMMENT_TEXT;\n      htm[index] = item + `<!-- cmt_${commentType}_${index} -->`;\n    }\n  }\n  template = template.cloneNode(false) as HTMLTemplateElement;\n  template.innerHTML = htm.join(\"\");\n  /**    \n    .replace(/\\n/g, \"\")\n    .replace(/  /g, \" \")\n    .replace(/  /g, \"\")\n    .replace(/> /g, \">\")\n    .replace(/ </g, \"<\");\n     */\n  const element = template.content;\n  element[\"$params\"] = params;\n  if (!_templateMode) {\n    var commentNodes = [];\n    walkForCommentNodes(element, commentNodes);\n    updateNodesByCommentNodes(commentNodes, params);\n  }\n  return element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n  var treeWalker = document.createTreeWalker(\n    element,\n    NodeFilter.SHOW_COMMENT,\n    {\n      acceptNode: function(node) {\n        var nodeValue = node.nodeValue.trim();\n        return nodeValue.startsWith(\"cmt_\")\n          ? NodeFilter.FILTER_ACCEPT\n          : NodeFilter.FILTER_REJECT;\n      }\n    },\n    false\n  );\n\n  while (treeWalker.nextNode()) {\n    commentNodes.push(treeWalker.currentNode);\n  }\n};\n\nconst updateNodesByCommentNodes = (commentNodes: Comment[], params: any[]) => {\n  for (var i = 0; i < commentNodes.length; i++) {\n    const commentNode = commentNodes[i];\n    var commentValue = commentNode.nodeValue;\n    let element = null;\n    let attributeName: string = null;\n\n    let i1 = commentValue.indexOf(\"_\") + 1;\n    var i2 = commentValue.indexOf(\"_\", i1);\n    const commentType = parseInt(commentValue.substr(i1, i2 - i1));\n    i1 = commentValue.indexOf(\"_\", i2) + 1;\n    i2 = commentValue.indexOf(\"_\", i1);\n    if (i2 === -1) {\n      i2 = commentValue.indexOf(\" \", i1);\n    }\n    let paramIndex = parseInt(commentValue.substr(i1, i2 - i1));\n    let param = params[paramIndex];\n\n    if (commentType & COMMENT_TEXT_OR_DOM) {\n      if (commentType === COMMENT_TEXT) {\n        attributeName = \"textContent\";\n        element = document.createTextNode(param.$val);\n        commentNode.parentElement.insertBefore(\n          element,\n          commentNode.nextSibling\n        );\n        if (!param.hasOwnProperty(\"$val\")) {\n          if (Array.isArray(param)) {\n            for (var p = 0; p < param.length; p++) {\n              commentNode.parentElement.appendChild(param[p]);\n            }\n          }\n        }\n      } else if (commentType === COMMENT_DOM) {\n        attributeName = commentValue.substr(\n          i2 + 1,\n          commentValue.length - i2 - 2\n        );\n        element = commentNode.nextElementSibling;\n      }\n      // commentType !== COMMENT_FN && commentNode.remove();\n      if (attributeName.startsWith(\"on\")) {\n        (element as Element).addEventListener(attributeName.substr(2), param);\n      } else if (param.hasOwnProperty(\"$val\")) {\n        if (htmlProps[attributeName]) {\n          compute(\n            val => {\n              element[attributeName] = val;\n            },\n            () => [param]\n          );\n          element[attributeName] = param();\n        } else {\n          compute(\n            val => {\n              element.setAttribute(attributeName, val);\n            },\n            () => [param]\n          );\n          element.setAttribute(attributeName, param());\n        }\n      } else {\n        if (htmlProps[attributeName]) {\n          element[attributeName] = param;\n        } else if (typeof param === \"function\") {\n          param(element);\n        } else {\n          element.setAttribute(attributeName, param);\n        }\n      }\n    } else if (commentType === COMMENT_FN) {\n      if (commentNode.parentElement) {\n        param(commentNode.parentElement, commentNode.nextElementSibling);\n        // commentNode.remove();\n      } else {\n        //conditionalDom can be place on root\n        window.requestAnimationFrame(() => {\n          param(commentNode.parentElement, commentNode.nextElementSibling);\n          // commentNode.remove();\n        });\n      }\n    } else if (commentType === COMMENT_HTM) {\n      commentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n    }\n  }\n};\n\nexport const htmlArrayMap = <T>(\n  arr: FidanArray<T>,\n  renderCallback: (data: T) => DocumentFragment,\n  options?: {\n    useCloneNode: boolean;\n    renderMode?: \"reuse\" | \"reconcile\";\n  }\n) => {\n  options = Object.assign({ useCloneNode: false, reuseMode: false }, options);\n  if (options.useCloneNode) {\n    return (parentElement: Element, nextElement: Element) => {\n      let clonedNode = null;\n      let params = null;\n      let dataParamIndexes = [];\n      // let commentNodesAddresses: number[][] = null;\n      const arrayMapFn = data => {\n        let renderNode = null;\n        var commentNodes = [];\n        if (clonedNode === null) {\n          _templateMode = true;\n          renderNode = renderCallback(data);\n          _templateMode = false;\n          params = renderNode[\"$params\"];\n          for (var key in data) {\n            const indexes = data[key][\"$indexes\"];\n            if (indexes)\n              for (var i = 0; i < indexes.length; i++) {\n                dataParamIndexes.push(indexes[i], key);\n              }\n          }\n          clonedNode = renderNode.cloneNode(true);\n          // walkForCommentNodes(clonedNode, commentNodes);\n          // commentNodesAddresses = generateCommentNodesAddresses(commentNodes);\n        } else {\n          renderNode = clonedNode.cloneNode(true);\n        }\n        for (var i = 0; i < dataParamIndexes.length; i += 2) {\n          params[dataParamIndexes[i]] = data[dataParamIndexes[i + 1]];\n        }\n        // generateCommentNodesFromAddresses(\n        //   commentNodesAddresses,\n        //   renderNode,\n        //   commentNodes\n        // );\n        walkForCommentNodes(renderNode, commentNodes);\n        updateNodesByCommentNodes(commentNodes, params);\n        return renderNode;\n      };\n      arrayMap(arr, parentElement, nextElement, arrayMapFn, options.renderMode);\n    };\n  } else {\n    return function(parentElement: Element, nextElement: Element) {\n      arrayMap(arr as any, parentElement, nextElement, renderCallback);\n    };\n  }\n};\n\n// const generateCommentNodesAddresses = (commentNodes: Comment[]) => {\n//   const paths: number[][] = [];\n//   for (var i = 0; i < commentNodes.length; i++) {\n//     const path: number[] = [];\n//     let node = commentNodes[i] as Node & ChildNode;\n//     let parent = node.parentNode as Node & ParentNode;\n//     while (parent) {\n//       path.push(Array.from(parent.childNodes).indexOf(node));\n//       node = parent as any;\n//       parent = parent.parentNode;\n//     }\n//     paths.push(path.reverse());\n//   }\n//   return paths;\n// };\n// const generateCommentNodesFromAddresses = (\n//   commentNodesAddresses: number[][],\n//   element: Element,\n//   commentNodes: Comment[]\n// ) => {\n//   for (var i = 0; i < commentNodesAddresses.length; i++) {\n//     const path = commentNodesAddresses[i];\n//     let node = null;\n//     let parent = element;\n//     for (var p = 0; p < path.length; p++) {\n//       node = parent.childNodes.item(path[p]);\n//       parent = node;\n//     }\n//     commentNodes.push(node);\n//   }\n// };\n"],"names":["const","overrideArrayMutators","dataArray","forEach","method","$val","arr","slice","Array","prototype","apply","arguments","let","autoTrackDependencies","array","items","value","val","innerFn","undefined","indexOf","push","depends","length","i","beforeCompute","isArray","compute","dependencies","deps","debugName","name","Object","defineProperty","toString","toJSON","fn","cmp","initalValue","destroy","item","reuseNodes","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstChild","tmp","removeChild","textContent","tail","previousSibling","lastChild","_head","_mode","head","mode","insertBefore","appendChild","reconcile","nextElementSibling","firstElementChild","len","prevStart","newStart","loop","prevEnd","newEnd","a","b","prevStartNode","newStartNode","prevEndNode","previousElementSibling","lastElementChild","newEndNode","fixes","_node","next","P","I","Map","set","reusingNodes","toRemove","has","get","longestSeq","longestPositiveIncreasingSubsequence","nodes","tmpC","lisIdx","tmpD","ns","seq","is","l","pre","n","j","findGreatestIndexLEQ","lo","hi","mid","Math","floor","coditionalDom","condition","htmlFragment","parentElement","nextElement","childs","from","children","inserted","tmpNextElement","child","remove","insertToDom","index","itemElement","typeOf","document","createTextNode","arrayMap","parentDom","renderCallback","renderMode","nextVal","beforeVal","parentFragment","createDocumentFragment","renderFunction","nextItem","prevItem","injectToProperty","obj","propertyKey","descr","getOwnPropertyDescriptor","configurable","enumerable","v","inject","key","jsRoot","root","self","window","global","module","Function","COMMENT_TEXT","COMMENT_DOM","COMMENT_FN","COMMENT_HTM","COMMENT_TEXT_OR_DOM","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","checked","disabled","readonly","contentEditable","_templateMode","template","createElement","putCommentToTagStart","htm","comment","p","lastIndexOf","substr","html","args","params","attributeName","param","isDynamic","hasOwnProperty","endsWith","commentType","cloneNode","join","element","content","commentNodes","walkForCommentNodes","updateNodesByCommentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","trim","startsWith","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","commentNode","commentValue","i1","i2","parseInt","paramIndex","addEventListener","setAttribute","requestAnimationFrame","htmlArrayMap","options","assign","useCloneNode","reuseMode","clonedNode","dataParamIndexes","arrayMapFn","renderNode","indexes"],"mappings":"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"}