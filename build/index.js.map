{"version":3,"file":"index.js","sources":["../src/evented-array.ts","../src/f.ts","../src/reuse-nodes.ts","../src/dom.ts","../src/util.ts","../src/html.ts","../src/observable.ts","../src/index.ts"],"sourcesContent":["export type ArrayMutableMethods =\n  | \"copyWithin\" // TODO ArrayMutableMethods copyWithin\n  | \"fill\" // TODO ArrayMutableMethods fill\n  | \"pop\"\n  | \"push\"\n  | \"reverse\" // TODO ArrayMutableMethods reverse\n  | \"shift\"\n  | \"sort\" // TODO ArrayMutableMethods sort\n  | \"splice\"\n  | \"unshift\";\n\n// TODO concat vs..\n\nexport function EventedArray(items) {\n  var _self = this,\n    _array = [];\n\n  _self._handlers = {\n    itemadded: [],\n    itemremoved: [],\n    itemset: [],\n    beforemulti: [],\n    aftermulti: []\n  };\n\n  function defineIndexProperty(index) {\n    if (!(index in _self)) {\n      Object.defineProperty(_self, index, {\n        configurable: true,\n        enumerable: true,\n        get: function() {\n          return _array[index];\n        },\n        set: function(v) {\n          _array[index] = v;\n          raiseEvent({\n            type: \"itemset\",\n            index: index,\n            item: v\n          });\n        }\n      });\n    }\n  }\n\n  function raiseEvent(event) {\n    _self._handlers[event.type].forEach(function(h) {\n      h.call(_self, event);\n    });\n  }\n\n  _self.on = function(eventName, handler) {\n    _self._handlers[eventName].push(handler);\n  };\n\n  _self.off = function(eventName, handler) {\n    var h = _self._handlers[eventName];\n    var ln = h.length;\n    while (--ln >= 0) {\n      if (h[ln] === handler) {\n        h.splice(ln, 1);\n      }\n    }\n  };\n\n  _self.push = function() {\n    var index;\n    arguments.length > 1 &&\n      raiseEvent({\n        type: \"beforemulti\"\n      });\n    for (var i = 0, ln = arguments.length; i < ln; i++) {\n      index = _array.length;\n      _array.push(arguments[i]);\n      defineIndexProperty(index);\n      raiseEvent({\n        type: \"itemadded\",\n        index: index,\n        item: arguments[i]\n      });\n    }\n    arguments.length > 1 &&\n      raiseEvent({\n        type: \"aftermulti\"\n      });\n    return _array.length;\n  };\n\n  _self.pop = function() {\n    if (_array.length > -1) {\n      var index = _array.length - 1,\n        item = _array.pop();\n      delete _self[index];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: index,\n        item: item\n      });\n      return item;\n    }\n  };\n\n  _self.unshift = function() {\n    for (var i = 0, ln = arguments.length; i < ln; i++) {\n      _array.splice(i, 0, arguments[i]);\n      defineIndexProperty(_array.length - 1);\n      raiseEvent({\n        type: \"itemadded\",\n        index: i,\n        item: arguments[i]\n      });\n    }\n    for (; i < _array.length; i++) {\n      raiseEvent({\n        type: \"itemset\",\n        index: i,\n        item: _array[i]\n      });\n    }\n    return _array.length;\n  };\n\n  _self.shift = function() {\n    if (_array.length > -1) {\n      var item = _array.shift();\n      delete _self[_array.length];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: 0,\n        item: item\n      });\n      return item;\n    }\n  };\n\n  _self.splice = function(index, howMany /*, element1, element2, ... */) {\n    var removed = [],\n      item,\n      pos;\n\n    index = index == null ? 0 : index < 0 ? _array.length + index : index;\n\n    howMany =\n      howMany == null ? _array.length - index : howMany > 0 ? howMany : 0;\n\n    while (howMany--) {\n      item = _array.splice(index, 1)[0];\n      removed.push(item);\n      delete _self[_array.length];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: index + removed.length - 1,\n        item: item\n      });\n    }\n\n    for (var i = 2, ln = arguments.length; i < ln; i++) {\n      _array.splice(index, 0, arguments[i]);\n      defineIndexProperty(_array.length - 1);\n      raiseEvent({\n        type: \"itemadded\",\n        index: index,\n        item: arguments[i]\n      });\n      index++;\n    }\n\n    return removed;\n  };\n\n  Object.defineProperty(_self, \"length\", {\n    configurable: false,\n    enumerable: false,\n    get: function() {\n      return _array.length;\n    },\n    set: function(value) {\n      var n = Number(value);\n      var length = _array.length;\n      if (n % 1 === 0 && n >= 0) {\n        if (n < length) {\n          _self.splice(n);\n        } else if (n > length) {\n          _self.push.apply(_self, new Array(n - length));\n        }\n      } else {\n        throw new RangeError(\"Invalid array length\");\n      }\n      _array.length = n;\n      return value;\n    }\n  });\n\n  Object.defineProperty(_self, \"innerArray\", {\n    configurable: false,\n    enumerable: false,\n    get: function() {\n      return _array;\n    },\n    set: function(v) {\n      _array = v;\n      for (var i = 0; i < v.length; i++) {\n        defineIndexProperty(i);\n      }\n    }\n  });\n\n  Object.getOwnPropertyNames(Array.prototype).forEach(function(name) {\n    if (!(name in _self)) {\n      Object.defineProperty(_self, name, {\n        configurable: false,\n        enumerable: false,\n        writable: false,\n        value: Array.prototype[name]\n      });\n    }\n  });\n\n  _self.setEventsFrom = function(val) {\n    _self.on = val.on;\n    _self.off = val.off;\n    _self._handlers = val._handlers;\n  };\n\n  _self.toJSON = () => {\n    return _array;\n  };\n\n  if (Array.isArray(items)) {\n    _self.push.apply(_self, items);\n  }\n}\n","import { EventedArray } from \"./evented-array\";\r\nimport { FidanArray, FidanValue } from \".\";\r\n\r\nlet animFrameId = 0;\r\nconst arrayRefresh = (arr: FidanArray<any>) => {\r\n  if (animFrameId) cancelAnimationFrame(animFrameId);\r\n  animFrameId = window.requestAnimationFrame(() => {\r\n    const depends = arr[\"c_depends\"];\r\n    console.log(depends);\r\n    if (depends.length)\r\n      for (var i = 0; i < depends.length; i++) {\r\n        depends[i](depends[i].compute(arr.$val));\r\n      }\r\n  });\r\n};\r\n\r\nconst anyPropertyChange = (obj: FidanValue<any>, callback: () => any) => {\r\n  // TODO deep check & isArray\r\n  for (var key in obj) {\r\n    if (obj[key].hasOwnProperty(\"$val\")) {\r\n      compute(callback, obj[key]);\r\n    }\r\n  }\r\n};\r\n\r\nconst arrayItemsAnyPropertyChange = (arr: any[], callback: () => any) => {\r\n  console.log(arr.length);\r\n  arr.forEach(item => {\r\n    console.log(item);\r\n    anyPropertyChange(item as any, callback);\r\n  });\r\n};\r\n\r\nexport const array = <T>(items: T[]): FidanArray<T> => {\r\n  const arr = value(new EventedArray(items)) as FidanArray<T>;\r\n  arr[\"toJSON\"] = () => arr.$val.innerArray;\r\n\r\n  arr.$val.on(\"itemadded\", e => {\r\n    anyPropertyChange(e.item, () => arrayRefresh(arr));\r\n    arrayRefresh(arr);\r\n  });\r\n  arr.$val.on(\"itemremoved\", arrayRefresh);\r\n  arr.$val.on(\"itemset\", e => {\r\n    anyPropertyChange(e.item, () => arrayRefresh(arr));\r\n    arrayRefresh(arr);\r\n  });\r\n\r\n  arrayItemsAnyPropertyChange(arr.$val, () => arrayRefresh(arr));\r\n\r\n  return arr;\r\n};\r\n\r\nexport const value = <T>(val?: T): FidanValue<T> => {\r\n  const innerFn: any = (val?) => {\r\n    if (val === undefined) {\r\n      return innerFn[\"$val\"];\r\n    } else {\r\n      if (Array.isArray(val)) {\r\n        val = new EventedArray(val.slice(0));\r\n        val.setEventsFrom(innerFn[\"$val\"]);\r\n        arrayItemsAnyPropertyChange(val, () => arrayRefresh(innerFn));\r\n      } else if (val && val.hasOwnProperty(\"innerArray\")) {\r\n        // val.innerArray = val.innerArray.slice(0); array reuseMode !!!\r\n        var arr = new EventedArray(val.innerArray.slice(0));\r\n        arr.setEventsFrom(val);\r\n        val = arr;\r\n        // arrayItemsAnyPropertyChange(val, () => arrayRefresh(innerFn));\r\n      }\r\n      let depends = innerFn[\"bc_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i].beforeCompute(val, innerFn[\"$val\"], innerFn);\r\n        }\r\n      innerFn[\"$val\"] = val;\r\n      depends = innerFn[\"c_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i](depends[i].compute(val));\r\n        }\r\n    }\r\n  };\r\n\r\n  if (Array.isArray(val)) {\r\n    val = new EventedArray(val.slice(0));\r\n  } else if (val && val.hasOwnProperty(\"innerArray\")) {\r\n    val = new EventedArray(val[\"innerArray\"].slice(0));\r\n  }\r\n  innerFn[\"$val\"] = val;\r\n  innerFn[\"bc_depends\"] = [];\r\n  innerFn[\"c_depends\"] = [];\r\n  innerFn.toString = innerFn.toJSON = () => innerFn[\"$val\"];\r\n  return innerFn;\r\n};\r\n\r\nexport const compute = <T>(\r\n  fn: (val: T, changedItem?) => void,\r\n  ...args: any[]\r\n) => {\r\n  const cmp = value(fn(undefined));\r\n  cmp[\"compute\"] = fn;\r\n  for (var i = 0; i < args.length; i++) args[i][\"c_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const beforeCompute = <T>(\r\n  initalValue: T,\r\n  fn: (nextValue?: T, prevValue?: T, changedItem?) => void,\r\n  ...args: any[]\r\n) => {\r\n  const cmp = value(fn(initalValue));\r\n  cmp[\"beforeCompute\"] = fn;\r\n  for (var i = 0; i < args.length; i++) args[i][\"bc_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\n// TODO typedCompute, typedValue ...\r\n// export const computeReturn = <T>(fn: () => T, ...args: any[]): T =>\r\n//   initCompute(fn, ...args) as any;\r\n\r\n// export const setCompute = (prev: any, fn: () => void, ...args: any[]) => {\r\n//   destroy(prev);\r\n//   return initCompute(prev, fn, ...args);\r\n// };\r\n\r\nexport const destroy = (item: any) => {\r\n  delete item[\"compute\"];\r\n  delete item[\"c_depends\"];\r\n};\r\n","// https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) => {\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n  if (renderedValues.length > data.length) {\n    let i = renderedValues.length,\n      tail =\n        afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n      tmp;\n    while (i > data.length) {\n      tmp = tail.previousSibling;\n      parent.removeChild(tail);\n      tail = tmp;\n      i--;\n    }\n  }\n\n  let _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n  if (_head === afterNode) _head = undefined;\n\n  let _mode = afterNode ? 1 : 0;\n  for (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n    item = data[i];\n    if (head) {\n      noOp(item, renderedValues[i]);\n    } else {\n      head = createFn(item);\n      mode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n    }\n    head = head.nextSibling;\n    if (head === afterNode) head = null;\n  }\n};\n","import { beforeCompute } from \"./f\";\nimport { reuseNodes } from \"./reuse-nodes\";\nimport { FidanArray } from \".\";\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n  const typeOf = typeof itemElement;\n  if (typeOf === \"function\") {\n    itemElement(parentElement);\n  } else {\n    if (typeOf !== \"object\") {\n      itemElement = document.createTextNode(itemElement);\n    }\n    parentElement.insertBefore(itemElement, parentElement.children[index]);\n  }\n};\n\nexport const arrayMap = <T>(\n  arr: FidanArray<T>,\n  parentDom: Node & ParentNode,\n  renderReturn: (item: any, idx?: number, isInsert?: boolean) => Node,\n  reuseMode?: boolean\n) => {\n  let parentRef: { parent: Node & ParentNode; next: Node } = null;\n  arr.$val.on(\"beforemulti\", function() {\n    if (parentDom.parentNode) {\n      parentRef = {\n        parent: parentDom,\n        next: (parentDom as Element).nextElementSibling\n      };\n      parentDom = document.createDocumentFragment();\n    }\n  });\n  arr.$val.on(\"aftermulti\", function() {\n    if (parentRef) {\n      parentRef.parent.insertBefore(parentDom, parentRef.next);\n      parentDom = parentRef.parent;\n    }\n  });\n\n  arr.$val.on(\"itemadded\", function(e) {\n    insertToDom(parentDom, e.index, renderReturn(e.item, e.index));\n  });\n\n  arr.$val.on(\"itemset\", function(e) {\n    parentDom.replaceChild(\n      renderReturn(e.item, e.index) as any,\n      parentDom.children.item(e.index)\n    );\n  });\n\n  arr.$val.on(\"itemremoved\", function(e) {\n    parentDom.removeChild(parentDom.children.item(e.index));\n  });\n\n  let firstRenderOnFragment = undefined;\n  const arrayComputeRenderAll = function(nextVal) {\n    if (!reuseMode) {\n      const parentFragment = document.createDocumentFragment();\n      parentDom.textContent = \"\";\n      for (var i = 0; i < nextVal.length; i++) {\n        parentFragment.appendChild(renderReturn(nextVal[i]));\n      }\n      parentDom.appendChild(parentFragment);\n    } else {\n      if (firstRenderOnFragment === undefined && nextVal && nextVal.length > 0)\n        firstRenderOnFragment = document.createDocumentFragment();\n      reuseNodes(\n        firstRenderOnFragment || parentDom,\n        arr.$val.innerArray,\n        nextVal || [],\n        nextItem => {\n          return renderReturn(nextItem);\n        },\n        (nextItem, prevItem) => {\n          for (var key in nextItem) {\n            if (prevItem[key].hasOwnProperty(\"$val\")) {\n              nextItem[key].c_depends = prevItem[key].c_depends;\n              nextItem[key].bc_depends = prevItem[key].bc_depends;\n              prevItem[key](nextItem[key]());\n            }\n          }\n        }\n      );\n      if (firstRenderOnFragment) {\n        parentDom.appendChild(firstRenderOnFragment);\n        firstRenderOnFragment = null;\n      }\n    }\n  };\n\n  beforeCompute(arr.$val, arrayComputeRenderAll, arr);\n};\n","import { value } from \"./f\";\n\nexport const setDefaults = <T>(\n  obj: T,\n  defaults: { [key in keyof T]?: any }\n) => {\n  for (var key in defaults) {\n    if (obj[key] === undefined) obj[key] = defaults[key];\n  }\n};\n\nexport const mapProperty = (obj: Object, propertyKey: string, value$: any) => {\n  const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n  if (descr.configurable)\n    Object.defineProperty(obj, propertyKey, {\n      configurable: false,\n      enumerable: true,\n      get: () => {\n        return value$.$val;\n      },\n      set: value$\n    });\n  else {\n    descr.set[\"depends\"].push(\n      value(() => {\n        value$(obj[propertyKey]);\n      })\n    );\n  }\n};\n\nexport const jsRoot = () => {\n  let root;\n\n  if (typeof self !== \"undefined\") {\n    root = self;\n  } else if (typeof window !== \"undefined\") {\n    root = window;\n  } else if (typeof global !== \"undefined\") {\n    root = global;\n  } else if (typeof module !== \"undefined\") {\n    root = module;\n  } else {\n    root = Function(\"return this\")();\n  }\n  return root;\n};\n","import { compute } from \"./f\";\nimport { arrayMap } from \"./dom\";\nimport { FidanArray } from \".\";\n\nconst COMMENT_TEXT = 1;\nconst COMMENT_DOM = 2;\nconst COMMENT_FN = 4;\nconst COMMENT_HTM = 8;\nconst COMMENT_TEXT_OR_DOM = COMMENT_TEXT | COMMENT_DOM;\n\nconst htmlProps = {\n  id: true,\n  nodeValue: true,\n  textContent: true,\n  className: true,\n  innerHTML: true,\n  innerText: true,\n  tabIndex: true,\n  value: true\n};\n\nlet _templateMode = false; // TODO kaldırılacak yerine başka bir yöntem geliştirilecek\nlet template = document.createElement(\"template\");\n\nconst putCommentToTagStart = (\n  htm: string[],\n  index: number,\n  comment: string\n) => {\n  for (var i = index; i >= 0; i--) {\n    let item = htm[i];\n    let p = item.lastIndexOf(\"<\");\n    if (p !== -1) {\n      htm[i] = item.substr(0, p) + comment + item.substr(p);\n      // htm[i] =\n      //   item.substr(0, p) + comment + item.substr(p, item.lastIndexOf(\" \") - p);\n      // if (htm[index + 1].substr(0, 1) === '\"') {\n      //   htm[index + 1] = htm[index + 1].substr(1);\n      // }\n      break;\n    }\n  }\n};\n\nexport const html = (...args) => {\n  const htm: string[] = args[0].slice();\n  const params = args.slice(1);\n  let attributeName: string = null;\n  let i = 0;\n\n  for (var index = 0; index < htm.length; index++) {\n    let item = htm[index];\n    const param = params[index];\n    if (param === undefined) {\n      break;\n    }\n    const isDynamic = param.hasOwnProperty(\"$val\");\n    if (isDynamic) {\n      if (param[\"$indexes\"] === undefined) {\n        param[\"$indexes\"] = [];\n      }\n      param[\"$indexes\"].push(index);\n    }\n    if (item.endsWith('=\"')) {\n      i = item.lastIndexOf(\" \") + 1;\n      attributeName = item.substr(i, item.length - i - 2);\n      putCommentToTagStart(\n        htm,\n        index,\n        `<!-- cmt_${COMMENT_DOM}_${index}_${attributeName} -->`\n      );\n    } else {\n      let commentType =\n        typeof param === \"function\" && !isDynamic\n          ? COMMENT_FN\n          : typeof param === \"object\"\n          ? COMMENT_HTM\n          : COMMENT_TEXT;\n      htm[index] = item + `<!-- cmt_${commentType}_${index} -->`;\n    }\n  }\n  template = template.cloneNode(false) as HTMLTemplateElement;\n  template.innerHTML = htm.join(\"\");\n  const element = template.content;\n  element[\"$params\"] = params;\n  if (!_templateMode) {\n    updateNodesByCommentNodes(element, params);\n  }\n  return element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n  var treeWalker = document.createTreeWalker(\n    element,\n    NodeFilter.SHOW_COMMENT,\n    {\n      acceptNode: function(node) {\n        var nodeValue = node.nodeValue.trim();\n        return nodeValue.startsWith(\"cmt_\")\n          ? NodeFilter.FILTER_ACCEPT\n          : NodeFilter.FILTER_REJECT;\n      }\n    },\n    false\n  );\n\n  while (treeWalker.nextNode()) {\n    commentNodes.push(treeWalker.currentNode);\n  }\n};\n\nconst updateNodesByCommentNodes = (element: Node, params: any[]) => {\n  var commentNodes = [];\n  walkForCommentNodes(element, commentNodes);\n\n  for (var i = 0; i < commentNodes.length; i++) {\n    const commentNode = commentNodes[i];\n    var commentValue = commentNode.nodeValue;\n    let element = null;\n    let attributeName: string = null;\n\n    let i1 = commentValue.indexOf(\"_\") + 1;\n    var i2 = commentValue.indexOf(\"_\", i1);\n    const commentType = parseInt(commentValue.substr(i1, i2 - i1));\n    i1 = commentValue.indexOf(\"_\", i2) + 1;\n    i2 = commentValue.indexOf(\"_\", i1);\n    if (i2 === -1) {\n      i2 = commentValue.indexOf(\" \", i1);\n    }\n    let paramIndex = parseInt(commentValue.substr(i1, i2 - i1));\n    let param = params[paramIndex];\n\n    if (commentType & COMMENT_TEXT_OR_DOM) {\n      if (commentType === COMMENT_TEXT) {\n        attributeName = \"textContent\";\n        element = document.createTextNode(param.$val);\n        commentNode.parentElement.insertBefore(\n          element,\n          commentNode.nextSibling\n        );\n        if (!param.hasOwnProperty(\"$val\")) {\n          if (Array.isArray(param)) {\n            for (var p = 0; p < param.length; p++) {\n              commentNode.parentElement.appendChild(param[p]);\n            }\n          }\n        }\n      } else if (commentType === COMMENT_DOM) {\n        attributeName = commentValue.substr(\n          i2 + 1,\n          commentValue.length - i2 - 2\n        );\n        element = commentNode.nextElementSibling;\n      }\n      if (attributeName.startsWith(\"on\")) {\n        (element as Element).addEventListener(attributeName.substr(2), param);\n      } else if (param.hasOwnProperty(\"$val\")) {\n        if (typeof param() === \"boolean\") {\n          compute(() => {\n            param()\n              ? element.setAttribute(attributeName, true)\n              : element.removeAttribute(attributeName);\n          }, param);\n        } else if (htmlProps[attributeName]) {\n          compute(val => {\n            element[attributeName] = val;\n          }, param)[\"name$\"] = \"[\" + attributeName + \"]\";\n          element[attributeName] = param();\n        } else {\n          compute(val => {\n            element.setAttribute(attributeName, val);\n          }, param)[\"name$\"] = \"attr(\" + attributeName + \")\";\n          element.setAttribute(attributeName, param());\n        }\n      } else {\n        if (typeof param === \"boolean\") {\n          param\n            ? element.setAttribute(attributeName, param)\n            : element.removeAttribute(attributeName);\n        } else if (typeof param === \"function\") {\n          param(element);\n        } else if (htmlProps[attributeName]) {\n          element[attributeName] = param;\n        } else {\n          element.setAttribute(attributeName, param);\n        }\n      }\n    } else if (commentType === COMMENT_FN) {\n      param(commentNode);\n    } else if (commentType === COMMENT_HTM) {\n      commentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n    }\n  }\n};\n\nexport const htmlArrayMap = <T>(\n  arr: FidanArray<T>,\n  renderCallback: (data: T) => DocumentFragment,\n  options?: {\n    useCloneNode: boolean;\n    reuseMode?: boolean;\n  }\n) => {\n  options = Object.assign({ useCloneNode: false, reuseMode: false }, options);\n  if (options.useCloneNode) {\n    return (commentNode: Node) => {\n      const element = commentNode.parentElement;\n      let clonedNode = null;\n      let params = null;\n      let dataParamIndexes = [];\n      const arrayMapFn = data => {\n        let renderNode = null;\n        if (clonedNode === null) {\n          _templateMode = true;\n          renderNode = renderCallback(data);\n          _templateMode = false;\n          params = renderNode[\"$params\"];\n          for (var key in data) {\n            const indexes = data[key][\"$indexes\"];\n            if (indexes)\n              for (var i = 0; i < indexes.length; i++) {\n                dataParamIndexes.push(indexes[i], key);\n              }\n          }\n          clonedNode = renderNode.cloneNode(true);\n        } else {\n          renderNode = clonedNode.cloneNode(true);\n        }\n        for (var i = 0; i < dataParamIndexes.length; i += 2) {\n          params[dataParamIndexes[i]] = data[dataParamIndexes[i + 1]];\n        }\n        updateNodesByCommentNodes(renderNode, params);\n        return renderNode;\n      };\n      arrayMap(arr, element, arrayMapFn, options.reuseMode);\n    };\n  } else {\n    return function(commentNode) {\n      var element = commentNode.parentElement;\n      arrayMap(arr as any, element, renderCallback);\n    };\n  }\n};\n","import { jsRoot } from \"./util\";\nimport { FidanValue } from \".\";\nimport { value } from \"./f\";\n\nfunction symbolObservablePonyfill(root) {\n  let result;\n  const Symbol = root.Symbol;\n\n  if (typeof Symbol === \"function\") {\n    if (Symbol.observable) {\n      result = Symbol.observable;\n    } else {\n      result = Symbol(\"observable\");\n      Symbol.observable = result;\n    }\n  } else {\n    result = \"@@observable\";\n  }\n\n  return result;\n}\n\nconst $$symbolObservable = symbolObservablePonyfill(jsRoot());\n\nclass Observer {\n  isUnsubscribed = false;\n  handlers: Partial<Observer> = null;\n  _unsubscribe = null;\n  constructor(handlers: Partial<Observer>) {\n    this.handlers = handlers;\n    this.isUnsubscribed = false;\n  }\n\n  next(value) {\n    if (this.handlers.next && !this.isUnsubscribed) {\n      this.handlers.next(value);\n    }\n  }\n\n  error(error) {\n    if (!this.isUnsubscribed) {\n      if (this.handlers.error) {\n        this.handlers.error(error);\n      }\n\n      this.unsubscribe();\n    }\n  }\n\n  complete() {\n    if (!this.isUnsubscribed) {\n      if (this.handlers.complete) {\n        this.handlers.complete();\n      }\n\n      this.unsubscribe();\n    }\n  }\n\n  unsubscribe() {\n    this.isUnsubscribed = true;\n\n    if (this._unsubscribe) {\n      this._unsubscribe();\n    }\n  }\n}\n\nclass Observable {\n  _subscribe: (observer: Observer) => () => void = null;\n  constructor(subscribe) {\n    this._subscribe = subscribe;\n  }\n\n  subscribe(obs: Partial<Observer>) {\n    const observer = new Observer(obs);\n\n    observer._unsubscribe = this._subscribe(observer);\n\n    return {\n      unsubscribe() {\n        observer.unsubscribe();\n      }\n    };\n  }\n\n  [$$symbolObservable]() {\n    return this;\n  }\n}\n\nexport const toObservable = <T>(data: FidanValue<any>): T => {\n  return new Observable(observer => {\n    var compute = value(() => {\n      observer.next(data.$val);\n    });\n    data[\"depends\"].push(compute);\n  }) as any;\n};\n","export interface FidanValue<T> {\n  (val?: T): T;\n  $val: T;\n}\n\nexport type FidanArrayEventType =\n  | \"itemadded\"\n  | \"itemset\"\n  | \"itemremoved\"\n  | \"beforemulti\"\n  | \"aftermulti\";\n\nexport interface EventedArrayReturnType<T> extends Array<T> {\n  on: (type: FidanArrayEventType, callback) => void;\n  off: any;\n  innerArray: T[];\n  setEventsFrom: (val: EventedArrayReturnType<T>) => void;\n}\n\nexport interface FidanArray<T> {\n  (val?: T[]): T[] & EventedArrayReturnType<T>;\n  readonly $val: T[] & EventedArrayReturnType<T>;\n}\n\nimport * as fidanObj from \"./index-libs\";\nexport const fidan = fidanObj;\n"],"names":["EventedArray","items","_self","_array","_handlers","itemadded","itemremoved","itemset","beforemulti","aftermulti","defineIndexProperty","index","Object","defineProperty","configurable","enumerable","get","set","v","raiseEvent","type","item","event","forEach","h","call","on","eventName","handler","push","off","ln","length","splice","arguments","i","pop","unshift","shift","howMany","removed","value","n","Number","apply","Array","RangeError","getOwnPropertyNames","prototype","name","writable","setEventsFrom","val","toJSON","isArray","let","animFrameId","const","arrayRefresh","arr","cancelAnimationFrame","window","requestAnimationFrame","depends","console","log","compute","$val","anyPropertyChange","obj","callback","key","hasOwnProperty","arrayItemsAnyPropertyChange","array","innerArray","e","innerFn","undefined","slice","beforeCompute","toString","fn","cmp","args","initalValue","destroy","reuseNodes","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstChild","tmp","removeChild","textContent","tail","previousSibling","lastChild","_head","_mode","head","mode","insertBefore","appendChild","insertToDom","parentElement","itemElement","typeOf","document","createTextNode","children","arrayMap","parentDom","renderReturn","reuseMode","parentRef","parentNode","next","nextElementSibling","createDocumentFragment","replaceChild","firstRenderOnFragment","arrayComputeRenderAll","nextVal","parentFragment","nextItem","prevItem","c_depends","bc_depends","setDefaults","defaults","mapProperty","propertyKey","value$","descr","getOwnPropertyDescriptor","jsRoot","root","self","global","module","Function","COMMENT_TEXT","COMMENT_DOM","COMMENT_FN","COMMENT_HTM","COMMENT_TEXT_OR_DOM","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","_templateMode","template","createElement","putCommentToTagStart","htm","comment","p","lastIndexOf","substr","html","params","attributeName","param","isDynamic","endsWith","commentType","cloneNode","join","element","content","updateNodesByCommentNodes","walkForCommentNodes","commentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","trim","startsWith","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","commentNode","commentValue","i1","indexOf","i2","parseInt","paramIndex","addEventListener","setAttribute","removeAttribute","htmlArrayMap","renderCallback","options","assign","useCloneNode","clonedNode","dataParamIndexes","arrayMapFn","renderNode","indexes","symbolObservablePonyfill","result","Symbol","observable","$$symbolObservable","Observer","constructor","handlers","isUnsubscribed","error","unsubscribe","complete","_unsubscribe","Observable","subscribe","_subscribe","obs","observer","toObservable","fidan","fidanObj"],"mappings":"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"}