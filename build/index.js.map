{"version":3,"file":"index.js","sources":["../src/f.ts","../src/reuse-nodes.ts","../src/reconcile.ts","../src/dom.ts","../src/util.ts","../src/html.ts"],"sourcesContent":["import { FidanValue, FidanArray } from \".\";\r\n\r\nlet autoTrackDependencies: any[] = null;\r\n\r\nexport const value = <T>(\r\n  val?: T\r\n): T extends Array<any> ? FidanArray<T> : FidanValue<T> => {\r\n  const innerFn: any = (val?) => {\r\n    if (val === undefined) {\r\n      if (\r\n        autoTrackDependencies &&\r\n        autoTrackDependencies.indexOf(innerFn) === -1\r\n      ) {\r\n        autoTrackDependencies.push(innerFn);\r\n      }\r\n      return innerFn[\"$val\"];\r\n    } else {\r\n      let depends = innerFn[\"bc_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i].beforeCompute(val, innerFn[\"$val\"], innerFn);\r\n        }\r\n      innerFn[\"$val\"] = val;\r\n      if (Array.isArray(val)) {\r\n        overrideArrayMutators(innerFn);\r\n      }\r\n      depends = innerFn[\"c_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i](depends[i].compute(val));\r\n        }\r\n    }\r\n  };\r\n\r\n  innerFn[\"$val\"] = val;\r\n  if (Array.isArray(val)) {\r\n    overrideArrayMutators(innerFn);\r\n  }\r\n  innerFn[\"bc_depends\"] = [];\r\n  innerFn[\"c_depends\"] = [];\r\n  innerFn.depends = (dependencies: () => FidanValue<any>[]): FidanValue<T> => {\r\n    const deps = dependencies();\r\n    for (var i = 0; i < deps.length; i++) innerFn[\"c_depends\"].push(deps[i]);\r\n    return innerFn;\r\n  };\r\n  innerFn.debugName = (name: string) => {\r\n    Object.defineProperty(innerFn, \"name\", { value: name });\r\n    return innerFn;\r\n  };\r\n  innerFn.toString = innerFn.toJSON = () => innerFn[\"$val\"];\r\n  return innerFn;\r\n};\r\n\r\nexport const compute = <T>(\r\n  fn: (val: T, changedItem?) => any,\r\n  dependencies?: () => FidanValue<any>[]\r\n) => {\r\n  autoTrackDependencies = dependencies ? null : [];\r\n  const val = fn(undefined);\r\n  const deps = autoTrackDependencies ? autoTrackDependencies : dependencies();\r\n  autoTrackDependencies = null;\r\n  const cmp = value(val);\r\n  cmp[\"compute\"] = fn;\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"c_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const beforeCompute = <T>(\r\n  initalValue: T,\r\n  fn: (nextValue?: T, prevValue?: T, changedItem?) => void,\r\n  dependencies: () => FidanValue<any>[]\r\n) => {\r\n  const cmp = value(fn(initalValue));\r\n  cmp[\"beforeCompute\"] = fn;\r\n  const deps = dependencies();\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"bc_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nconst overrideArrayMutators = (dataArray: FidanArray<any[]>) => {\r\n  dataArray.size = value(dataArray().length);\r\n  [\r\n    \"copyWithin\",\r\n    \"fill\",\r\n    \"pop\",\r\n    \"push\",\r\n    \"reverse\",\r\n    \"shift\",\r\n    \"sort\",\r\n    \"splice\",\r\n    \"unshift\"\r\n  ].forEach(method => {\r\n    dataArray.$val[method] = function() {\r\n      const arr = this.slice(0);\r\n      const size1 = arr.length;\r\n      Array.prototype[method].apply(arr, arguments);\r\n      const size2 = arr.length;\r\n      if (size1 !== size2) dataArray.size(size2);\r\n      dataArray(arr);\r\n    };\r\n  });\r\n};\r\n","// Original: https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) => {\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n  if (renderedValues.length > data.length) {\n    let i = renderedValues.length,\n      tail =\n        afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n      tmp;\n    while (i > data.length) {\n      tmp = tail.previousSibling;\n      parent.removeChild(tail);\n      tail = tmp;\n      i--;\n    }\n  }\n\n  let _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n  if (_head === afterNode) _head = undefined;\n\n  let _mode = afterNode ? 1 : 0;\n  for (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n    item = data[i];\n    if (head) {\n      noOp(item, renderedValues[i]);\n    } else {\n      head = createFn(item);\n      mode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n    }\n    head = head.nextSibling;\n    if (head === afterNode) head = null;\n  }\n};\n","// Original: https://github.com/Freak613/stage0/blob/master/reconcile.js\n\nexport function reconcile(\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) {\n  // Fast path for clear\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined\n            ? beforeNode.nextElementSibling\n            : parent.firstElementChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextElementSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n\n  // Fast path for create\n  if (renderedValues.length === 0) {\n    let node,\n      mode = afterNode !== undefined ? 1 : 0;\n    for (let i = 0, len = data.length; i < len; i++) {\n      node = createFn(data[i]);\n      mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n    }\n    return;\n  }\n\n  let prevStart = 0,\n    newStart = 0,\n    loop = true,\n    prevEnd = renderedValues.length - 1,\n    newEnd = data.length - 1,\n    a,\n    b,\n    prevStartNode = beforeNode\n      ? beforeNode.nextElementSibling\n      : parent.firstElementChild,\n    newStartNode = prevStartNode,\n    prevEndNode = afterNode\n      ? afterNode.previousElementSibling\n      : parent.lastElementChild,\n    newEndNode = prevEndNode;\n\n  fixes: while (loop) {\n    loop = false;\n    let _node;\n\n    // Skip prefix\n    (a = renderedValues[prevStart]), (b = data[newStart]);\n    while (a === b) {\n      noOp(prevStartNode, b);\n      prevStart++;\n      newStart++;\n      newStartNode = prevStartNode = prevStartNode.nextElementSibling;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevStart];\n      b = data[newStart];\n    }\n\n    // Skip suffix\n    (a = renderedValues[prevEnd]), (b = data[newEnd]);\n    while (a === b) {\n      noOp(prevEndNode, b);\n      prevEnd--;\n      newEnd--;\n      afterNode = prevEndNode;\n      newEndNode = prevEndNode = prevEndNode.previousElementSibling;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevEnd];\n      b = data[newEnd];\n    }\n\n    // Fast path to swap backward\n    (a = renderedValues[prevEnd]), (b = data[newStart]);\n    while (a === b) {\n      loop = true;\n      noOp(prevEndNode, b);\n      _node = prevEndNode.previousElementSibling;\n      parent.insertBefore(prevEndNode, newStartNode);\n      newEndNode = prevEndNode = _node;\n      newStart++;\n      prevEnd--;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevEnd];\n      b = data[newStart];\n    }\n\n    // Fast path to swap forward\n    (a = renderedValues[prevStart]), (b = data[newEnd]);\n    while (a === b) {\n      loop = true;\n      noOp(prevStartNode, b);\n      _node = prevStartNode.nextElementSibling;\n      parent.insertBefore(prevStartNode, afterNode);\n      prevStart++;\n      afterNode = newEndNode = prevStartNode;\n      prevStartNode = _node;\n      newEnd--;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevStart];\n      b = data[newEnd];\n    }\n  }\n\n  // Fast path for shrink\n  if (newEnd < newStart) {\n    if (prevStart <= prevEnd) {\n      let next;\n      while (prevStart <= prevEnd) {\n        if (prevEnd === 0) {\n          parent.removeChild(prevEndNode);\n        } else {\n          next = prevEndNode.previousElementSibling;\n          parent.removeChild(prevEndNode);\n          prevEndNode = next;\n        }\n        prevEnd--;\n      }\n    }\n    return;\n  }\n\n  // Fast path for add\n  if (prevEnd < prevStart) {\n    if (newStart <= newEnd) {\n      let node,\n        mode = afterNode ? 1 : 0;\n      while (newStart <= newEnd) {\n        node = createFn(data[newStart]);\n        mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n        newStart++;\n      }\n    }\n    return;\n  }\n\n  // Positions for reusing nodes from current DOM state\n  const P = new Array(newEnd + 1 - newStart);\n  for (let i = newStart; i <= newEnd; i++) P[i] = -1;\n\n  // Index to resolve position from current to new\n  const I = new Map();\n  for (let i = newStart; i <= newEnd; i++) I.set(data[i], i);\n\n  let reusingNodes = newStart + data.length - 1 - newEnd,\n    toRemove = [];\n\n  for (let i = prevStart; i <= prevEnd; i++) {\n    if (I.has(renderedValues[i])) {\n      P[I.get(renderedValues[i])] = i;\n      reusingNodes++;\n    } else {\n      toRemove.push(i);\n    }\n  }\n\n  // Fast path for full replace\n  if (reusingNodes === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined\n            ? beforeNode.nextElementSibling\n            : parent.firstElementChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextElementSibling;\n        parent.removeChild(node);\n        node = tmp;\n        prevStart++;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n\n    let node,\n      mode = afterNode ? 1 : 0;\n    for (let i = newStart; i <= newEnd; i++) {\n      node = createFn(data[i]);\n      mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n    }\n\n    return;\n  }\n\n  // What else?\n  const longestSeq = longestPositiveIncreasingSubsequence(P, newStart);\n\n  // Collect nodes to work with them\n  const nodes = [];\n  let tmpC = prevStartNode;\n  for (let i = prevStart; i <= prevEnd; i++) {\n    nodes[i] = tmpC;\n    tmpC = tmpC.nextElementSibling;\n  }\n\n  for (let i = 0; i < toRemove.length; i++)\n    parent.removeChild(nodes[toRemove[i]]);\n\n  let lisIdx = longestSeq.length - 1,\n    tmpD;\n  for (let i = newEnd; i >= newStart; i--) {\n    if (longestSeq[lisIdx] === i) {\n      afterNode = nodes[P[longestSeq[lisIdx]]];\n      noOp(afterNode, data[i]);\n      lisIdx--;\n    } else {\n      if (P[i] === -1) {\n        tmpD = createFn(data[i]);\n      } else {\n        tmpD = nodes[P[i]];\n        noOp(tmpD, data[i]);\n      }\n      parent.insertBefore(tmpD, afterNode);\n      afterNode = tmpD;\n    }\n  }\n}\n\nexport default reconcile;\n\n// Picked from\n// https://github.com/adamhaile/surplus/blob/master/src/runtime/content.ts#L368\n\n// return an array of the indices of ns that comprise the longest increasing subsequence within ns\nfunction longestPositiveIncreasingSubsequence(ns, newStart) {\n  var seq = [],\n    is = [],\n    l = -1,\n    pre = new Array(ns.length);\n\n  for (var i = newStart, len = ns.length; i < len; i++) {\n    var n = ns[i];\n    if (n < 0) continue;\n    var j = findGreatestIndexLEQ(seq, n);\n    if (j !== -1) pre[i] = is[j];\n    if (j === l) {\n      l++;\n      seq[l] = n;\n      is[l] = i;\n    } else if (n < seq[j + 1]) {\n      seq[j + 1] = n;\n      is[j + 1] = i;\n    }\n  }\n\n  for (i = is[l]; l >= 0; i = pre[i], l--) {\n    seq[l] = i;\n  }\n\n  return seq;\n}\n\nfunction findGreatestIndexLEQ(seq, n) {\n  // invariant: lo is guaranteed to be index of a value <= n, hi to be >\n  // therefore, they actually start out of range: (-1, last + 1)\n  var lo = -1,\n    hi = seq.length;\n\n  // fast path for simple increasing sequences\n  if (hi > 0 && seq[hi - 1] <= n) return hi - 1;\n\n  while (hi - lo > 1) {\n    var mid = Math.floor((lo + hi) / 2);\n    if (seq[mid] > n) {\n      hi = mid;\n    } else {\n      lo = mid;\n    }\n  }\n\n  return lo;\n}\n","import { beforeCompute, compute } from \"./f\";\nimport { reuseNodes } from \"./reuse-nodes\";\nimport { FidanValue } from \".\";\nimport reconcile from \"./reconcile\";\n\nexport const coditionalDom = (\n  condition: () => boolean,\n  dependencies: () => FidanValue<any>[],\n  htmlFragment: DocumentFragment\n) => (parentElement: Element, nextElement: Element) => {\n  const childs = Array.from(htmlFragment.children);\n  let inserted = false;\n  compute(() => {\n    if (condition()) {\n      if (!inserted) {\n        let tmpNextElement = nextElement;\n        for (var i = childs.length - 1; i >= 0; i--) {\n          const child = childs[i];\n          tmpNextElement = parentElement.insertBefore(child, tmpNextElement);\n        }\n        inserted = true;\n      }\n    } else {\n      childs.forEach(child => child.remove());\n      inserted = false;\n    }\n  }, dependencies);\n};\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n  const typeOf = typeof itemElement;\n  if (typeOf === \"function\") {\n    itemElement(parentElement);\n  } else {\n    if (typeOf !== \"object\") {\n      itemElement = document.createTextNode(itemElement);\n    }\n    parentElement.insertBefore(itemElement, parentElement.children[index]);\n  }\n};\n\nexport const arrayMap = <T>(\n  arr: FidanValue<T[]>,\n  parentDom: Node & ParentNode,\n  nextElement: Element,\n  renderCallback: (item: any, idx?: number, isInsert?: boolean) => Node,\n  renderMode?: \"reuse\" | \"reconcile\"\n) => {\n  beforeCompute(\n    arr.$val,\n    (nextVal, beforeVal) => {\n      if (!renderMode) {\n        const parentFragment = document.createDocumentFragment();\n        parentDom.textContent = \"\";\n        for (var i = 0; i < nextVal.length; i++) {\n          insertToDom(parentFragment, i, renderCallback(nextVal[i], i));\n        }\n        parentDom.appendChild(parentFragment);\n      } else {\n        let renderFunction: (\n          parent,\n          renderedValues,\n          data,\n          createFn,\n          noOp,\n          beforeNode?,\n          afterNode?\n        ) => void = renderMode === \"reconcile\" ? reconcile : reuseNodes;\n        renderFunction(\n          parentDom,\n          beforeVal || [],\n          nextVal || [],\n          nextItem => {\n            // create\n            return renderCallback(nextItem);\n          },\n          (nextItem, prevItem) => {\n            // update\n            // for (var key in nextItem) {\n            //   if (prevItem[key].hasOwnProperty(\"$val\")) {\n            //     nextItem[key].depends = prevItem[key].depends;\n            //     prevItem[key](nextItem[key]());\n            //   }\n            // }\n          }\n        );\n      }\n    },\n    () => [arr]\n  );\n};\n","import { value } from \"./f\";\nimport { FidanValue } from \".\";\n\nexport const injectToProperty = (\n  obj: Object,\n  propertyKey: string,\n  val: FidanValue<any>\n) => {\n  const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n  if (descr.configurable)\n    Object.defineProperty(obj, propertyKey, {\n      configurable: false,\n      enumerable: true,\n      get: () => {\n        val();\n        return val;\n      },\n      set: v => val(v)\n    });\n  else {\n    descr.set[\"c_depends\"].push(val);\n  }\n};\n\nexport const inject = <T extends Object>(obj: T): T => {\n  for (var key in obj) {\n    injectToProperty(obj, key, value(obj[key]));\n  }\n  return obj;\n};\n","import { compute } from \"./f\";\nimport { arrayMap } from \"./dom\";\nimport { FidanValue } from \".\";\n\nconst COMMENT_TEXT = 1;\nconst COMMENT_DOM = 2;\nconst COMMENT_FN = 4; // \"function\" && !isDynamic\nconst COMMENT_HTM = 8;\nconst COMMENT_TEXT_OR_DOM = COMMENT_TEXT | COMMENT_DOM;\n\nconst htmlProps = {\n  id: true,\n  nodeValue: true,\n  textContent: true,\n  className: true,\n  innerHTML: true,\n  innerText: true,\n  tabIndex: true,\n  value: true,\n  checked: true,\n  disabled: true,\n  readonly: true,\n  contentEditable: true\n};\n\nlet _templateMode = false; // TODO kaldırılacak yerine başka bir yöntem geliştirilecek\nlet template = document.createElement(\"template\");\n\nconst isPromise = (obj): obj is Promise<any> => {\n  return (\n    !!obj &&\n    (typeof obj === \"object\" || typeof obj === \"function\") &&\n    typeof obj.then === \"function\"\n  );\n};\n\nconst putCommentToTagStart = (\n  htm: string[],\n  index: number,\n  comment: string\n) => {\n  for (var i = index; i >= 0; i--) {\n    let item = htm[i];\n    let p = item.lastIndexOf(\"<\");\n    if (p !== -1) {\n      htm[i] = item.substr(0, p) + comment + item.substr(p);\n      // htm[i] =\n      //   item.substr(0, p) + comment + item.substr(p, item.lastIndexOf(\" \") - p);\n      // if (htm[index + 1].substr(0, 1) === '\"') {\n      //   htm[index + 1] = htm[index + 1].substr(1);\n      // }\n      break;\n    }\n  }\n};\n\nexport const html = (...args) => {\n  const htm: string[] = args[0].slice();\n  const params = args.slice(1);\n  let attributeName: string = null;\n  let i = 0;\n\n  for (var index = 0; index < htm.length; index++) {\n    let item = htm[index];\n    const param = params[index];\n    if (param === undefined) {\n      break;\n    }\n    const isDynamic = param.hasOwnProperty(\"$val\");\n    if (isDynamic) {\n      if (param[\"$indexes\"] === undefined) {\n        param[\"$indexes\"] = [];\n      }\n      param[\"$indexes\"].push(index);\n    }\n    if (item.endsWith('=\"')) {\n      i = item.lastIndexOf(\" \") + 1;\n      attributeName = item.substr(i, item.length - i - 2);\n      putCommentToTagStart(\n        htm,\n        index,\n        `<!-- cmt_${COMMENT_DOM}_${index}_${attributeName} -->`\n      );\n    } else {\n      let commentType =\n        typeof param === \"function\" && !isDynamic\n          ? COMMENT_FN\n          : typeof param === \"object\"\n          ? COMMENT_HTM\n          : COMMENT_TEXT;\n      htm[index] = item + `<!-- cmt_${commentType}_${index} -->`;\n    }\n  }\n  template = template.cloneNode(false) as HTMLTemplateElement;\n  template.innerHTML = htm.join(\"\");\n  /**    \n    .replace(/\\n/g, \"\")\n    .replace(/  /g, \" \")\n    .replace(/  /g, \"\")\n    .replace(/> /g, \">\")\n    .replace(/ </g, \"<\");\n     */\n  const element = template.content;\n  element[\"$params\"] = params;\n  if (!_templateMode) {\n    var commentNodes = [];\n    walkForCommentNodes(element, commentNodes);\n    updateNodesByCommentNodes(commentNodes, params);\n  }\n  return element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n  var treeWalker = document.createTreeWalker(\n    element,\n    NodeFilter.SHOW_COMMENT,\n    {\n      acceptNode: function(node) {\n        var nodeValue = node.nodeValue.trim();\n        return nodeValue.startsWith(\"cmt_\")\n          ? NodeFilter.FILTER_ACCEPT\n          : NodeFilter.FILTER_REJECT;\n      }\n    },\n    false\n  );\n\n  while (treeWalker.nextNode()) {\n    commentNodes.push(treeWalker.currentNode);\n  }\n};\n\nconst updateNodesByCommentNodes = (commentNodes: Comment[], params: any[]) => {\n  for (var i = 0; i < commentNodes.length; i++) {\n    const commentNode = commentNodes[i];\n    var commentValue = commentNode.nodeValue;\n    let element = null;\n    let attributeName: string = null;\n\n    let i1 = commentValue.indexOf(\"_\") + 1;\n    var i2 = commentValue.indexOf(\"_\", i1);\n    const commentType = parseInt(commentValue.substr(i1, i2 - i1));\n    i1 = commentValue.indexOf(\"_\", i2) + 1;\n    i2 = commentValue.indexOf(\"_\", i1);\n    if (i2 === -1) {\n      i2 = commentValue.indexOf(\" \", i1);\n    }\n    let paramIndex = parseInt(commentValue.substr(i1, i2 - i1));\n    let param = params[paramIndex];\n\n    if (commentType & COMMENT_TEXT_OR_DOM) {\n      if (commentType === COMMENT_TEXT) {\n        attributeName = \"textContent\";\n        element = document.createTextNode(param.$val);\n        commentNode.parentElement.insertBefore(\n          element,\n          commentNode.nextSibling\n        );\n        if (!param.hasOwnProperty(\"$val\")) {\n          if (Array.isArray(param)) {\n            for (var p = 0; p < param.length; p++) {\n              commentNode.parentElement.appendChild(param[p]);\n            }\n          }\n        }\n      } else if (commentType === COMMENT_DOM) {\n        attributeName = commentValue.substr(\n          i2 + 1,\n          commentValue.length - i2 - 2\n        );\n        element = commentNode.nextElementSibling;\n      }\n      // commentType !== COMMENT_FN && commentNode.remove();\n      if (attributeName.startsWith(\"on\")) {\n        (element as Element).addEventListener(attributeName.substr(2), param);\n      } else if (param.hasOwnProperty(\"$val\")) {\n        if (htmlProps[attributeName]) {\n          compute(\n            val => {\n              element[attributeName] = val;\n            },\n            () => [param]\n          );\n          element[attributeName] = param();\n        } else {\n          compute(\n            val => {\n              element.setAttribute(attributeName, val);\n            },\n            () => [param]\n          );\n          element.setAttribute(attributeName, param());\n        }\n      } else {\n        if (htmlProps[attributeName]) {\n          element[attributeName] = param;\n        } else if (typeof param === \"function\") {\n          param(element);\n        } else {\n          element.setAttribute(attributeName, param);\n        }\n      }\n    } else if (commentType === COMMENT_FN) {\n      if (commentNode.parentElement) {\n        param(commentNode.parentElement, commentNode.nextElementSibling);\n        // commentNode.remove();\n      } else {\n        //conditionalDom can be place on root\n        window.requestAnimationFrame(() => {\n          param(commentNode.parentElement, commentNode.nextElementSibling);\n          // commentNode.remove();\n        });\n      }\n    } else if (commentType === COMMENT_HTM) {\n      commentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n    }\n  }\n};\n\nexport const htmlArrayMap = <T>(\n  arr: FidanValue<T[]>,\n  renderCallback: (data: T) => DocumentFragment,\n  options?: {\n    useCloneNode: boolean;\n    renderMode?: \"reuse\" | \"reconcile\";\n  }\n) => {\n  options = Object.assign({ useCloneNode: false, reuseMode: false }, options);\n  if (options.useCloneNode) {\n    return (parentElement: Element, nextElement: Element) => {\n      let clonedNode = null;\n      let params = null;\n      let dataParamIndexes = [];\n      // let commentNodesAddresses: number[][] = null;\n      const arrayMapFn = data => {\n        let renderNode = null;\n        var commentNodes = [];\n        if (clonedNode === null) {\n          _templateMode = true;\n          renderNode = renderCallback(data);\n          _templateMode = false;\n          params = renderNode[\"$params\"];\n          for (var key in data) {\n            const indexes = data[key][\"$indexes\"];\n            if (indexes)\n              for (var i = 0; i < indexes.length; i++) {\n                dataParamIndexes.push(indexes[i], key);\n              }\n          }\n          clonedNode = renderNode.cloneNode(true);\n          // walkForCommentNodes(clonedNode, commentNodes);\n          // commentNodesAddresses = generateCommentNodesAddresses(commentNodes);\n        } else {\n          renderNode = clonedNode.cloneNode(true);\n        }\n        for (var i = 0; i < dataParamIndexes.length; i += 2) {\n          params[dataParamIndexes[i]] = data[dataParamIndexes[i + 1]];\n        }\n        // generateCommentNodesFromAddresses(\n        //   commentNodesAddresses,\n        //   renderNode,\n        //   commentNodes\n        // );\n        walkForCommentNodes(renderNode, commentNodes);\n        updateNodesByCommentNodes(commentNodes, params);\n        return renderNode;\n      };\n      arrayMap(arr, parentElement, nextElement, arrayMapFn, options.renderMode);\n    };\n  } else {\n    return function(parentElement: Element, nextElement: Element) {\n      arrayMap(arr as any, parentElement, nextElement, renderCallback);\n    };\n  }\n};\n\n// const generateCommentNodesAddresses = (commentNodes: Comment[]) => {\n//   const paths: number[][] = [];\n//   for (var i = 0; i < commentNodes.length; i++) {\n//     const path: number[] = [];\n//     let node = commentNodes[i] as Node & ChildNode;\n//     let parent = node.parentNode as Node & ParentNode;\n//     while (parent) {\n//       path.push(Array.from(parent.childNodes).indexOf(node));\n//       node = parent as any;\n//       parent = parent.parentNode;\n//     }\n//     paths.push(path.reverse());\n//   }\n//   return paths;\n// };\n// const generateCommentNodesFromAddresses = (\n//   commentNodesAddresses: number[][],\n//   element: Element,\n//   commentNodes: Comment[]\n// ) => {\n//   for (var i = 0; i < commentNodesAddresses.length; i++) {\n//     const path = commentNodesAddresses[i];\n//     let node = null;\n//     let parent = element;\n//     for (var p = 0; p < path.length; p++) {\n//       node = parent.childNodes.item(path[p]);\n//       parent = node;\n//     }\n//     commentNodes.push(node);\n//   }\n// };\n"],"names":["let","autoTrackDependencies","value","val","innerFn","undefined","indexOf","push","depends","length","i","beforeCompute","Array","isArray","overrideArrayMutators","compute","dependencies","deps","debugName","name","Object","defineProperty","toString","toJSON","fn","cmp","initalValue","const","dataArray","size","forEach","method","$val","arr","slice","size1","prototype","apply","arguments","size2","reuseNodes","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstChild","tmp","removeChild","textContent","tail","previousSibling","lastChild","_head","_mode","item","head","mode","insertBefore","appendChild","reconcile","nextElementSibling","firstElementChild","len","prevStart","newStart","loop","prevEnd","newEnd","a","b","prevStartNode","newStartNode","prevEndNode","previousElementSibling","lastElementChild","newEndNode","fixes","_node","next","P","I","Map","set","reusingNodes","toRemove","has","get","longestSeq","longestPositiveIncreasingSubsequence","nodes","tmpC","lisIdx","tmpD","ns","seq","is","l","pre","n","j","findGreatestIndexLEQ","lo","hi","mid","Math","floor","coditionalDom","condition","htmlFragment","parentElement","nextElement","childs","from","children","inserted","tmpNextElement","child","remove","insertToDom","index","itemElement","typeOf","document","createTextNode","arrayMap","parentDom","renderCallback","renderMode","nextVal","beforeVal","parentFragment","createDocumentFragment","renderFunction","nextItem","prevItem","injectToProperty","obj","propertyKey","descr","getOwnPropertyDescriptor","configurable","enumerable","v","inject","key","COMMENT_TEXT","COMMENT_DOM","COMMENT_FN","COMMENT_HTM","COMMENT_TEXT_OR_DOM","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","checked","disabled","readonly","contentEditable","_templateMode","template","createElement","putCommentToTagStart","htm","comment","p","lastIndexOf","substr","html","args","params","attributeName","param","isDynamic","hasOwnProperty","endsWith","commentType","cloneNode","join","element","content","commentNodes","walkForCommentNodes","updateNodesByCommentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","trim","startsWith","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","commentNode","commentValue","i1","i2","parseInt","paramIndex","addEventListener","setAttribute","window","requestAnimationFrame","htmlArrayMap","options","assign","useCloneNode","reuseMode","clonedNode","dataParamIndexes","arrayMapFn","renderNode","indexes"],"mappings":"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"}