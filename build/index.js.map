{"version":3,"file":"index.js","sources":["../src/evented-array.ts","../src/f.ts","../src/reuse-nodes.ts","../src/dom.ts","../src/util.ts","../src/html.ts","../src/observable.ts","../src/index.ts"],"sourcesContent":["export type ArrayMutableMethods =\n  | \"copyWithin\" // TODO ArrayMutableMethods copyWithin\n  | \"fill\" // TODO ArrayMutableMethods fill\n  | \"pop\"\n  | \"push\"\n  | \"reverse\" // TODO ArrayMutableMethods reverse\n  | \"shift\"\n  | \"sort\" // TODO ArrayMutableMethods sort\n  | \"splice\"\n  | \"unshift\";\n\n// TODO concat vs..\n\nexport function EventedArray(items) {\n  var _self = this,\n    _array = [];\n\n  _self._handlers = {\n    itemadded: [],\n    itemremoved: [],\n    itemset: [],\n    beforemulti: [],\n    aftermulti: []\n  };\n\n  function defineIndexProperty(index) {\n    if (!(index in _self)) {\n      Object.defineProperty(_self, index, {\n        configurable: true,\n        enumerable: true,\n        get: function() {\n          return _array[index];\n        },\n        set: function(v) {\n          _array[index] = v;\n          raiseEvent({\n            type: \"itemset\",\n            index: index,\n            item: v\n          });\n        }\n      });\n    }\n  }\n\n  function raiseEvent(event) {\n    _self._handlers[event.type].forEach(function(h) {\n      h.call(_self, event);\n    });\n  }\n\n  _self.on = function(eventName, handler) {\n    _self._handlers[eventName].push(handler);\n  };\n\n  _self.off = function(eventName, handler) {\n    var h = _self._handlers[eventName];\n    var ln = h.length;\n    while (--ln >= 0) {\n      if (h[ln] === handler) {\n        h.splice(ln, 1);\n      }\n    }\n  };\n\n  _self.push = function() {\n    var index;\n    arguments.length > 1 &&\n      raiseEvent({\n        type: \"beforemulti\"\n      });\n    for (var i = 0, ln = arguments.length; i < ln; i++) {\n      index = _array.length;\n      _array.push(arguments[i]);\n      defineIndexProperty(index);\n      raiseEvent({\n        type: \"itemadded\",\n        index: index,\n        item: arguments[i]\n      });\n    }\n    arguments.length > 1 &&\n      raiseEvent({\n        type: \"aftermulti\"\n      });\n    return _array.length;\n  };\n\n  _self.pop = function() {\n    if (_array.length > -1) {\n      var index = _array.length - 1,\n        item = _array.pop();\n      delete _self[index];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: index,\n        item: item\n      });\n      return item;\n    }\n  };\n\n  _self.unshift = function() {\n    for (var i = 0, ln = arguments.length; i < ln; i++) {\n      _array.splice(i, 0, arguments[i]);\n      defineIndexProperty(_array.length - 1);\n      raiseEvent({\n        type: \"itemadded\",\n        index: i,\n        item: arguments[i]\n      });\n    }\n    for (; i < _array.length; i++) {\n      raiseEvent({\n        type: \"itemset\",\n        index: i,\n        item: _array[i]\n      });\n    }\n    return _array.length;\n  };\n\n  _self.shift = function() {\n    if (_array.length > -1) {\n      var item = _array.shift();\n      delete _self[_array.length];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: 0,\n        item: item\n      });\n      return item;\n    }\n  };\n\n  _self.splice = function(index, howMany /*, element1, element2, ... */) {\n    var removed = [],\n      item,\n      pos;\n\n    index = index == null ? 0 : index < 0 ? _array.length + index : index;\n\n    howMany =\n      howMany == null ? _array.length - index : howMany > 0 ? howMany : 0;\n\n    while (howMany--) {\n      item = _array.splice(index, 1)[0];\n      removed.push(item);\n      delete _self[_array.length];\n      raiseEvent({\n        type: \"itemremoved\",\n        index: index + removed.length - 1,\n        item: item\n      });\n    }\n\n    for (var i = 2, ln = arguments.length; i < ln; i++) {\n      _array.splice(index, 0, arguments[i]);\n      defineIndexProperty(_array.length - 1);\n      raiseEvent({\n        type: \"itemadded\",\n        index: index,\n        item: arguments[i]\n      });\n      index++;\n    }\n\n    return removed;\n  };\n\n  Object.defineProperty(_self, \"length\", {\n    configurable: false,\n    enumerable: false,\n    get: function() {\n      return _array.length;\n    },\n    set: function(value) {\n      var n = Number(value);\n      var length = _array.length;\n      if (n % 1 === 0 && n >= 0) {\n        if (n < length) {\n          _self.splice(n);\n        } else if (n > length) {\n          _self.push.apply(_self, new Array(n - length));\n        }\n      } else {\n        throw new RangeError(\"Invalid array length\");\n      }\n      _array.length = n;\n      return value;\n    }\n  });\n\n  Object.defineProperty(_self, \"innerArray\", {\n    configurable: false,\n    enumerable: false,\n    get: function() {\n      return _array;\n    },\n    set: function(v) {\n      _array = v;\n      for (var i = 0; i < v.length; i++) {\n        defineIndexProperty(i);\n      }\n    }\n  });\n\n  Object.getOwnPropertyNames(Array.prototype).forEach(function(name) {\n    if (!(name in _self)) {\n      Object.defineProperty(_self, name, {\n        configurable: false,\n        enumerable: false,\n        writable: false,\n        value: Array.prototype[name]\n      });\n    }\n  });\n\n  _self.setEventsFrom = function(val) {\n    _self.on = val.on;\n    _self.off = val.off;\n    _self._handlers = val._handlers;\n  };\n\n  _self.toJSON = () => {\n    return _array;\n  };\n\n  if (Array.isArray(items)) {\n    _self.push.apply(_self, items);\n  }\n}\n","import { EventedArray } from \"./evented-array\";\r\nimport { FidanArray, FidanValue, FidanData } from \".\";\r\n\r\nexport const array = <T>(items: T[]): FidanArray<T> => {\r\n  const arr = value(new EventedArray(items)) as FidanArray<T>;\r\n  arr[\"toJSON\"] = () => arr.$val.innerArray;\r\n\r\n  arr.size = value(items.length);\r\n\r\n  arr.$val.on(\"itemadded\", () => arr.size(arr.$val.innerArray.length));\r\n  arr.$val.on(\"itemremoved\", () => arr.size(arr.$val.innerArray.length));\r\n\r\n  return arr;\r\n};\r\n\r\nexport const value = <T>(val?: T): FidanValue<T> => {\r\n  const innerFn: any = (val?) => {\r\n    if (val === undefined) {\r\n      return innerFn[\"$val\"];\r\n    } else {\r\n      if (Array.isArray(val)) {\r\n        val = new EventedArray(val.slice(0));\r\n        val.setEventsFrom(innerFn[\"$val\"]);\r\n      } else if (val && val.hasOwnProperty(\"innerArray\")) {\r\n        // val.innerArray = val.innerArray.slice(0); array reuseMode !!!\r\n        var arr = new EventedArray(val.innerArray.slice(0));\r\n        arr.setEventsFrom(val);\r\n        val = arr;\r\n      }\r\n      let depends = innerFn[\"bc_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i].beforeCompute(val, innerFn[\"$val\"], innerFn);\r\n        }\r\n      innerFn[\"$val\"] = val;\r\n      depends = innerFn[\"c_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i](depends[i].compute(val));\r\n        }\r\n\r\n      if (val.hasOwnProperty(\"innerArray\")) {\r\n        innerFn.size && innerFn.size(val.innerArray.length);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (Array.isArray(val)) {\r\n    val = new EventedArray(val.slice(0));\r\n  } else if (val && val.hasOwnProperty(\"innerArray\")) {\r\n    val = new EventedArray(val[\"innerArray\"].slice(0));\r\n  }\r\n  innerFn[\"$val\"] = val;\r\n  innerFn[\"bc_depends\"] = [];\r\n  innerFn[\"c_depends\"] = [];\r\n  innerFn.depends = (dependencies: () => FidanData<any>[]): FidanValue<T> => {\r\n    const deps = dependencies();\r\n    for (var i = 0; i < deps.length; i++) innerFn[\"c_depends\"].push(deps[i]);\r\n    return innerFn;\r\n  };\r\n  innerFn.debugName = (name: string) => {\r\n    Object.defineProperty(innerFn, \"name\", { value: name });\r\n    return innerFn;\r\n  };\r\n  innerFn.toString = innerFn.toJSON = () => innerFn[\"$val\"];\r\n  return innerFn;\r\n};\r\n\r\nexport const compute = <T>(\r\n  fn: (val: T, changedItem?) => any,\r\n  dependencies: () => FidanData<any>[]\r\n) => {\r\n  const cmp = value(fn(undefined));\r\n  cmp[\"compute\"] = fn;\r\n  const deps = dependencies();\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"c_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const beforeCompute = <T>(\r\n  initalValue: T,\r\n  fn: (nextValue?: T, prevValue?: T, changedItem?) => void,\r\n  dependencies: () => FidanData<any>[]\r\n) => {\r\n  const cmp = value(fn(initalValue));\r\n  cmp[\"beforeCompute\"] = fn;\r\n  const deps = dependencies();\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"bc_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const destroy = (item: any) => {\r\n  delete item[\"compute\"];\r\n  delete item[\"c_depends\"];\r\n};\r\n","// https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) => {\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n  if (renderedValues.length > data.length) {\n    let i = renderedValues.length,\n      tail =\n        afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n      tmp;\n    while (i > data.length) {\n      tmp = tail.previousSibling;\n      parent.removeChild(tail);\n      tail = tmp;\n      i--;\n    }\n  }\n\n  let _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n  if (_head === afterNode) _head = undefined;\n\n  let _mode = afterNode ? 1 : 0;\n  for (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n    item = data[i];\n    if (head) {\n      noOp(item, renderedValues[i]);\n    } else {\n      head = createFn(item);\n      mode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n    }\n    head = head.nextSibling;\n    if (head === afterNode) head = null;\n  }\n};\n","import { beforeCompute, compute } from \"./f\";\nimport { reuseNodes } from \"./reuse-nodes\";\nimport { FidanArray, FidanData } from \".\";\n\nexport const coditionalDom = (\n  condition: () => boolean,\n  htmlFragment: DocumentFragment,\n  dependencies: () => FidanData<any>[]\n) => (element: Element) => {\n  const dom = htmlFragment.firstElementChild;\n  compute(() => {\n    if (!element.nextElementSibling && condition()) {\n      element.parentElement.insertBefore(dom, element.nextElementSibling);\n    } else {\n      dom.remove();\n    }\n  }, dependencies);\n};\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n  const typeOf = typeof itemElement;\n  if (typeOf === \"function\") {\n    itemElement(parentElement);\n  } else {\n    if (typeOf !== \"object\") {\n      itemElement = document.createTextNode(itemElement);\n    }\n    parentElement.insertBefore(itemElement, parentElement.children[index]);\n  }\n};\n\nexport const arrayMap = <T>(\n  arr: FidanArray<T>,\n  parentDom: Node & ParentNode,\n  renderReturn: (item: any, idx?: number, isInsert?: boolean) => Node,\n  reuseMode?: boolean\n) => {\n  let parentRef: { parent: Node & ParentNode; next: Node } = null;\n  arr.$val.on(\"beforemulti\", function() {\n    if (parentDom.parentNode) {\n      parentRef = {\n        parent: parentDom,\n        next: (parentDom as Element).nextElementSibling\n      };\n      parentDom = document.createDocumentFragment();\n    }\n  });\n  arr.$val.on(\"aftermulti\", function() {\n    if (parentRef) {\n      parentRef.parent.insertBefore(parentDom, parentRef.next);\n      parentDom = parentRef.parent;\n    }\n  });\n\n  arr.$val.on(\"itemadded\", function(e) {\n    insertToDom(parentDom, e.index, renderReturn(e.item, e.index));\n  });\n\n  arr.$val.on(\"itemset\", function(e) {\n    parentDom.replaceChild(\n      renderReturn(e.item, e.index) as any,\n      parentDom.children.item(e.index)\n    );\n  });\n\n  arr.$val.on(\"itemremoved\", function(e) {\n    parentDom.removeChild(parentDom.children.item(e.index));\n  });\n\n  let firstRenderOnFragment = undefined;\n  const arrayComputeRenderAll = function(nextVal) {\n    if (!reuseMode) {\n      const parentFragment = document.createDocumentFragment();\n      parentDom.textContent = \"\";\n      for (var i = 0; i < nextVal.length; i++) {\n        parentFragment.appendChild(renderReturn(nextVal[i]));\n      }\n      parentDom.appendChild(parentFragment);\n    } else {\n      if (firstRenderOnFragment === undefined && nextVal && nextVal.length > 0)\n        firstRenderOnFragment = document.createDocumentFragment();\n      reuseNodes(\n        firstRenderOnFragment || parentDom,\n        arr.$val.innerArray,\n        nextVal || [],\n        nextItem => {\n          return renderReturn(nextItem);\n        },\n        (nextItem, prevItem) => {\n          for (var key in nextItem) {\n            if (prevItem[key].hasOwnProperty(\"$val\")) {\n              nextItem[key].c_depends = prevItem[key].c_depends;\n              nextItem[key].bc_depends = prevItem[key].bc_depends;\n              prevItem[key](nextItem[key]());\n            }\n          }\n        }\n      );\n      if (firstRenderOnFragment) {\n        parentDom.appendChild(firstRenderOnFragment);\n        firstRenderOnFragment = null;\n      }\n    }\n  };\n\n  beforeCompute(arr.$val, arrayComputeRenderAll, () => [arr]);\n};\n","import { value } from \"./f\";\n\nexport const setDefaults = <T>(\n  obj: T,\n  defaults: { [key in keyof T]?: any }\n) => {\n  for (var key in defaults) {\n    if (obj[key] === undefined) obj[key] = defaults[key];\n  }\n};\n\nexport const mapProperty = (obj: Object, propertyKey: string, value$: any) => {\n  const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n  if (descr.configurable)\n    Object.defineProperty(obj, propertyKey, {\n      configurable: false,\n      enumerable: true,\n      get: () => {\n        return value$.$val;\n      },\n      set: value$\n    });\n  else {\n    descr.set[\"depends\"].push(\n      value(() => {\n        value$(obj[propertyKey]);\n      })\n    );\n  }\n};\n\nexport const jsRoot = () => {\n  let root;\n\n  if (typeof self !== \"undefined\") {\n    root = self;\n  } else if (typeof window !== \"undefined\") {\n    root = window;\n  } else if (typeof global !== \"undefined\") {\n    root = global;\n  } else if (typeof module !== \"undefined\") {\n    root = module;\n  } else {\n    root = Function(\"return this\")();\n  }\n  return root;\n};\n","import { compute } from \"./f\";\nimport { arrayMap } from \"./dom\";\nimport { FidanArray } from \".\";\n\nconst COMMENT_TEXT = 1;\nconst COMMENT_DOM = 2;\nconst COMMENT_FN = 4;\nconst COMMENT_HTM = 8;\nconst COMMENT_TEXT_OR_DOM = COMMENT_TEXT | COMMENT_DOM;\n\nconst htmlProps = {\n  id: true,\n  nodeValue: true,\n  textContent: true,\n  className: true,\n  innerHTML: true,\n  innerText: true,\n  tabIndex: true,\n  value: true\n};\n\nlet _templateMode = false; // TODO kaldırılacak yerine başka bir yöntem geliştirilecek\nlet template = document.createElement(\"template\");\n\nconst putCommentToTagStart = (\n  htm: string[],\n  index: number,\n  comment: string\n) => {\n  for (var i = index; i >= 0; i--) {\n    let item = htm[i];\n    let p = item.lastIndexOf(\"<\");\n    if (p !== -1) {\n      htm[i] = item.substr(0, p) + comment + item.substr(p);\n      // htm[i] =\n      //   item.substr(0, p) + comment + item.substr(p, item.lastIndexOf(\" \") - p);\n      // if (htm[index + 1].substr(0, 1) === '\"') {\n      //   htm[index + 1] = htm[index + 1].substr(1);\n      // }\n      break;\n    }\n  }\n};\n\nexport const html = (...args) => {\n  const htm: string[] = args[0].slice();\n  const params = args.slice(1);\n  let attributeName: string = null;\n  let i = 0;\n\n  for (var index = 0; index < htm.length; index++) {\n    let item = htm[index];\n    const param = params[index];\n    if (param === undefined) {\n      break;\n    }\n    const isDynamic = param.hasOwnProperty(\"$val\");\n    if (isDynamic) {\n      if (param[\"$indexes\"] === undefined) {\n        param[\"$indexes\"] = [];\n      }\n      param[\"$indexes\"].push(index);\n    }\n    if (item.endsWith('=\"')) {\n      i = item.lastIndexOf(\" \") + 1;\n      attributeName = item.substr(i, item.length - i - 2);\n      putCommentToTagStart(\n        htm,\n        index,\n        `<!-- cmt_${COMMENT_DOM}_${index}_${attributeName} -->`\n      );\n    } else {\n      let commentType =\n        typeof param === \"function\" && !isDynamic\n          ? COMMENT_FN\n          : typeof param === \"object\"\n          ? COMMENT_HTM\n          : COMMENT_TEXT;\n      htm[index] = item + `<!-- cmt_${commentType}_${index} -->`;\n    }\n  }\n  template = template.cloneNode(false) as HTMLTemplateElement;\n  template.innerHTML = htm.join(\"\");\n  const element = template.content;\n  element[\"$params\"] = params;\n  if (!_templateMode) {\n    updateNodesByCommentNodes(element, params);\n  }\n  return element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n  var treeWalker = document.createTreeWalker(\n    element,\n    NodeFilter.SHOW_COMMENT,\n    {\n      acceptNode: function(node) {\n        var nodeValue = node.nodeValue.trim();\n        return nodeValue.startsWith(\"cmt_\")\n          ? NodeFilter.FILTER_ACCEPT\n          : NodeFilter.FILTER_REJECT;\n      }\n    },\n    false\n  );\n\n  while (treeWalker.nextNode()) {\n    commentNodes.push(treeWalker.currentNode);\n  }\n};\n\nconst updateNodesByCommentNodes = (element: Node, params: any[]) => {\n  var commentNodes = [];\n  walkForCommentNodes(element, commentNodes);\n\n  for (var i = 0; i < commentNodes.length; i++) {\n    const commentNode = commentNodes[i];\n    var commentValue = commentNode.nodeValue;\n    let element = null;\n    let attributeName: string = null;\n\n    let i1 = commentValue.indexOf(\"_\") + 1;\n    var i2 = commentValue.indexOf(\"_\", i1);\n    const commentType = parseInt(commentValue.substr(i1, i2 - i1));\n    i1 = commentValue.indexOf(\"_\", i2) + 1;\n    i2 = commentValue.indexOf(\"_\", i1);\n    if (i2 === -1) {\n      i2 = commentValue.indexOf(\" \", i1);\n    }\n    let paramIndex = parseInt(commentValue.substr(i1, i2 - i1));\n    let param = params[paramIndex];\n\n    if (commentType & COMMENT_TEXT_OR_DOM) {\n      if (commentType === COMMENT_TEXT) {\n        attributeName = \"textContent\";\n        element = document.createTextNode(param.$val);\n        commentNode.parentElement.insertBefore(\n          element,\n          commentNode.nextSibling\n        );\n        if (!param.hasOwnProperty(\"$val\")) {\n          if (Array.isArray(param)) {\n            for (var p = 0; p < param.length; p++) {\n              commentNode.parentElement.appendChild(param[p]);\n            }\n          }\n        }\n      } else if (commentType === COMMENT_DOM) {\n        attributeName = commentValue.substr(\n          i2 + 1,\n          commentValue.length - i2 - 2\n        );\n        element = commentNode.nextElementSibling;\n      }\n      if (attributeName.startsWith(\"on\")) {\n        (element as Element).addEventListener(attributeName.substr(2), param);\n      } else if (param.hasOwnProperty(\"$val\")) {\n        if (typeof param() === \"boolean\") {\n          compute(\n            () => {\n              param()\n                ? element.setAttribute(attributeName, true)\n                : element.removeAttribute(attributeName);\n            },\n            () => [param]\n          );\n        } else if (htmlProps[attributeName]) {\n          compute(\n            val => {\n              element[attributeName] = val;\n            },\n            () => [param]\n          ).debugName(\"[\" + attributeName + \"]\");\n          element[attributeName] = param();\n        } else {\n          compute(\n            val => {\n              element.setAttribute(attributeName, val);\n            },\n            () => [param]\n          ).debugName(\"attr(\" + attributeName + \")\");\n          element.setAttribute(attributeName, param());\n        }\n      } else {\n        if (typeof param === \"boolean\") {\n          param\n            ? element.setAttribute(attributeName, param)\n            : element.removeAttribute(attributeName);\n        } else if (typeof param === \"function\") {\n          param(element);\n        } else if (htmlProps[attributeName]) {\n          element[attributeName] = param;\n        } else {\n          element.setAttribute(attributeName, param);\n        }\n      }\n    } else if (commentType === COMMENT_FN) {\n      param(commentNode);\n    } else if (commentType === COMMENT_HTM) {\n      commentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n    }\n  }\n};\n\nexport const htmlArrayMap = <T>(\n  arr: FidanArray<T>,\n  renderCallback: (data: T) => DocumentFragment,\n  options?: {\n    useCloneNode: boolean;\n    reuseMode?: boolean;\n  }\n) => {\n  options = Object.assign({ useCloneNode: false, reuseMode: false }, options);\n  if (options.useCloneNode) {\n    return (commentNode: Node) => {\n      const element = commentNode.parentElement;\n      let clonedNode = null;\n      let params = null;\n      let dataParamIndexes = [];\n      const arrayMapFn = data => {\n        let renderNode = null;\n        if (clonedNode === null) {\n          _templateMode = true;\n          renderNode = renderCallback(data);\n          _templateMode = false;\n          params = renderNode[\"$params\"];\n          for (var key in data) {\n            const indexes = data[key][\"$indexes\"];\n            if (indexes)\n              for (var i = 0; i < indexes.length; i++) {\n                dataParamIndexes.push(indexes[i], key);\n              }\n          }\n          clonedNode = renderNode.cloneNode(true);\n        } else {\n          renderNode = clonedNode.cloneNode(true);\n        }\n        for (var i = 0; i < dataParamIndexes.length; i += 2) {\n          params[dataParamIndexes[i]] = data[dataParamIndexes[i + 1]];\n        }\n        updateNodesByCommentNodes(renderNode, params);\n        return renderNode;\n      };\n      arrayMap(arr, element, arrayMapFn, options.reuseMode);\n    };\n  } else {\n    return function(commentNode) {\n      var element = commentNode.parentElement;\n      arrayMap(arr as any, element, renderCallback);\n    };\n  }\n};\n","import { jsRoot } from \"./util\";\nimport { FidanValue } from \".\";\nimport { value } from \"./f\";\n\nfunction symbolObservablePonyfill(root) {\n  let result;\n  const Symbol = root.Symbol;\n\n  if (typeof Symbol === \"function\") {\n    if (Symbol.observable) {\n      result = Symbol.observable;\n    } else {\n      result = Symbol(\"observable\");\n      Symbol.observable = result;\n    }\n  } else {\n    result = \"@@observable\";\n  }\n\n  return result;\n}\n\nconst $$symbolObservable = symbolObservablePonyfill(jsRoot());\n\nclass Observer {\n  isUnsubscribed = false;\n  handlers: Partial<Observer> = null;\n  _unsubscribe = null;\n  constructor(handlers: Partial<Observer>) {\n    this.handlers = handlers;\n    this.isUnsubscribed = false;\n  }\n\n  next(value) {\n    if (this.handlers.next && !this.isUnsubscribed) {\n      this.handlers.next(value);\n    }\n  }\n\n  error(error) {\n    if (!this.isUnsubscribed) {\n      if (this.handlers.error) {\n        this.handlers.error(error);\n      }\n\n      this.unsubscribe();\n    }\n  }\n\n  complete() {\n    if (!this.isUnsubscribed) {\n      if (this.handlers.complete) {\n        this.handlers.complete();\n      }\n\n      this.unsubscribe();\n    }\n  }\n\n  unsubscribe() {\n    this.isUnsubscribed = true;\n\n    if (this._unsubscribe) {\n      this._unsubscribe();\n    }\n  }\n}\n\nclass Observable {\n  _subscribe: (observer: Observer) => () => void = null;\n  constructor(subscribe) {\n    this._subscribe = subscribe;\n  }\n\n  subscribe(obs: Partial<Observer>) {\n    const observer = new Observer(obs);\n\n    observer._unsubscribe = this._subscribe(observer);\n\n    return {\n      unsubscribe() {\n        observer.unsubscribe();\n      }\n    };\n  }\n\n  [$$symbolObservable]() {\n    return this;\n  }\n}\n\nexport const toObservable = <T>(data: FidanValue<any>): T => {\n  return new Observable(observer => {\n    var compute = value(() => {\n      observer.next(data.$val);\n    });\n    data[\"depends\"].push(compute);\n  }) as any;\n};\n","export interface FidanValue<T> {\n  (val?: T): T;\n  $val: T;\n  debugName: (name: string) => FidanValue<T>;\n  depends: (dependencies: () => FidanData<any>[]) => FidanValue<T>;\n}\n\nexport type FidanArrayEventType =\n  | \"itemadded\"\n  | \"itemset\"\n  | \"itemremoved\"\n  | \"beforemulti\"\n  | \"aftermulti\";\n\nexport interface EventedArrayReturnType<T> extends Array<T> {\n  on: (type: FidanArrayEventType, callback) => void;\n  off: any;\n  innerArray: T[];\n  setEventsFrom: (val: EventedArrayReturnType<T>) => void;\n}\n\nexport interface FidanArray<T> {\n  (val?: T[]): T[] & EventedArrayReturnType<T>;\n  readonly $val: T[] & EventedArrayReturnType<T>;\n  size?: FidanValue<number>;\n  debugName: (name: string) => FidanArray<T>;\n  depends: (dependencies: () => FidanData<any>[]) => FidanArray<T>;\n}\n\nexport type FidanData<T> = FidanValue<T> | FidanArray<T>;\n\nimport * as fidanObj from \"./index-libs\";\nexport const fidan = fidanObj;\n"],"names":["EventedArray","items","_self","_array","_handlers","itemadded","itemremoved","itemset","beforemulti","aftermulti","defineIndexProperty","index","Object","defineProperty","configurable","enumerable","get","set","v","raiseEvent","type","item","event","forEach","h","call","on","eventName","handler","push","off","ln","length","splice","arguments","i","pop","unshift","shift","howMany","removed","value","n","Number","apply","Array","RangeError","getOwnPropertyNames","prototype","name","writable","setEventsFrom","val","toJSON","isArray","const","array","arr","$val","innerArray","size","innerFn","undefined","slice","hasOwnProperty","depends","beforeCompute","compute","dependencies","deps","debugName","toString","fn","cmp","initalValue","destroy","reuseNodes","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstChild","tmp","removeChild","textContent","tail","previousSibling","lastChild","_head","_mode","let","head","mode","insertBefore","appendChild","coditionalDom","condition","htmlFragment","element","dom","firstElementChild","nextElementSibling","parentElement","remove","insertToDom","itemElement","typeOf","document","createTextNode","children","arrayMap","parentDom","renderReturn","reuseMode","parentRef","parentNode","next","createDocumentFragment","e","replaceChild","firstRenderOnFragment","arrayComputeRenderAll","nextVal","parentFragment","nextItem","prevItem","key","c_depends","bc_depends","setDefaults","obj","defaults","mapProperty","propertyKey","value$","descr","getOwnPropertyDescriptor","jsRoot","root","self","window","global","module","Function","COMMENT_TEXT","COMMENT_DOM","COMMENT_FN","COMMENT_HTM","COMMENT_TEXT_OR_DOM","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","_templateMode","template","createElement","putCommentToTagStart","htm","comment","p","lastIndexOf","substr","html","args","params","attributeName","param","isDynamic","endsWith","commentType","cloneNode","join","content","updateNodesByCommentNodes","walkForCommentNodes","commentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","trim","startsWith","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","commentNode","commentValue","i1","indexOf","i2","parseInt","paramIndex","addEventListener","setAttribute","removeAttribute","htmlArrayMap","renderCallback","options","assign","useCloneNode","clonedNode","dataParamIndexes","arrayMapFn","renderNode","indexes","symbolObservablePonyfill","result","Symbol","observable","$$symbolObservable","Observer","constructor","handlers","isUnsubscribed","error","unsubscribe","complete","_unsubscribe","Observable","subscribe","_subscribe","obs","observer","toObservable","fidan","fidanObj"],"mappings":"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"}