{"version":3,"file":"index.js","sources":["../src/f.ts","../src/reuse-nodes.ts","../src/reconcile.ts","../src/dom.ts","../src/util.ts","../src/html.ts"],"sourcesContent":["import { FidanValue, FidanArray, ComputionMethodArguments } from \".\";\r\n\r\nlet autoTrackDependencies: any[] = null;\r\n\r\nexport const value = <T>(val?: T): FidanValue<T> & (T extends Array<any> ? FidanArray<T> : unknown) => {\r\n  if (val && val.hasOwnProperty(\"$val\")) return val as any;\r\n  const innerFn: any = (val?: T, opt?: ComputionMethodArguments<T>) => {\r\n    if (val === undefined) {\r\n      if (\r\n        autoTrackDependencies &&\r\n        autoTrackDependencies.indexOf(innerFn) === -1\r\n      ) {\r\n        autoTrackDependencies.push(innerFn);\r\n      }\r\n      return innerFn[\"$val\"];\r\n    } else {\r\n      let depends = innerFn[\"bc_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i].beforeCompute(val, opt);\r\n        }\r\n      innerFn[\"$val\"] = val;\r\n      if (Array.isArray(val)) {\r\n        overrideArrayMutators(innerFn);\r\n      }\r\n      depends = innerFn[\"c_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          const dependFn = depends[i].compute ? depends[i].compute : depends[i];\r\n          dependFn(val, opt);\r\n        }\r\n    }\r\n  };\r\n\r\n  innerFn[\"$val\"] = val;\r\n  if (Array.isArray(val)) {\r\n    overrideArrayMutators(innerFn);\r\n  }\r\n  innerFn[\"bc_depends\"] = [];\r\n  innerFn[\"c_depends\"] = [];\r\n  innerFn.debugName = (name: string) => {\r\n    Object.defineProperty(innerFn, \"name\", { value: name });\r\n    return innerFn;\r\n  };\r\n  innerFn.toString = innerFn.toJSON = () => innerFn[\"$val\"] && innerFn[\"$val\"].toJSON ? innerFn[\"$val\"].toJSON() : innerFn[\"$val\"];\r\n  innerFn.depends = (deps:(FidanValue<any> | Function)[]): any => {\r\n    for (var i = 0; i < deps.length; i++) innerFn[\"c_depends\"].push(deps[i]);\r\n    innerFn(innerFn()); //trigger to c_depends\r\n    return innerFn;\r\n  };\r\n  return innerFn;\r\n};\r\n\r\nexport const computed = <T>(\r\n  fn: (val: T, opt?: ComputionMethodArguments<T>) => any,\r\n  dependencies?: any[]\r\n): any => {\r\n  autoTrackDependencies = dependencies ? null : [];\r\n  const cmp = value<T>();\r\n  const val = fn(undefined, { computedItem: cmp } as any);\r\n  cmp.$val = val;\r\n  if (Array.isArray(val)) {\r\n    overrideArrayMutators(cmp as any);\r\n  }\r\n  const deps = autoTrackDependencies ? autoTrackDependencies : dependencies;\r\n  autoTrackDependencies = null;\r\n  cmp[\"compute\"] = fn;\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"c_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const beforeCompute = <T>(\r\n  initalValue: T,\r\n  fn: (nextValue?: T, opt?: ComputionMethodArguments<T>) => void,\r\n  deps: FidanValue<any>[]\r\n) => {\r\n  const cmp = value<T>(fn(initalValue, { computedItem: {} } as any) as any);\r\n  cmp[\"beforeCompute\"] = fn;\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"bc_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nconst overrideArrayMutators = (dataArray: FidanArray<any[]>) => {\r\n  if (!dataArray.size) dataArray.size = value(dataArray.$val.length);\r\n  else dataArray.size(dataArray.$val.length);\r\n  if (dataArray.$val[\"$overrided\"]) return;\r\n  dataArray.$val[\"$overrided\"] = true;\r\n  [\r\n    \"copyWithin\",\r\n    \"fill\",\r\n    \"pop\",\r\n    \"push\",\r\n    \"reverse\",\r\n    \"shift\",\r\n    \"sort\",\r\n    \"splice\",\r\n    \"unshift\"\r\n  ].forEach(method => {\r\n    dataArray.$val[method] = function () {\r\n      const arr = dataArray.$val.slice(0);\r\n      const size1 = arr.length;\r\n      const ret = Array.prototype[method].apply(arr, arguments);\r\n      const size2 = arr.length;\r\n      if (size1 !== size2) dataArray.size(size2);\r\n      dataArray(arr, {\r\n        method,\r\n        computedItem: dataArray,\r\n        args: [...arguments]\r\n      });\r\n      return ret;\r\n    };\r\n  });\r\n};\r\n","// Original: https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) => {\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node && node !== afterNode) {\n        tmp = node.nextSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n  if (renderedValues.length > data.length) {\n    let i = renderedValues.length,\n      tail =\n        afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n      tmp;\n    while (i > data.length) {\n      tmp = tail.previousSibling;\n      parent.removeChild(tail);\n      tail = tmp;\n      i--;\n    }\n  }\n\n  let _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n  if (_head === afterNode) _head = undefined;\n\n  let _mode = afterNode ? 1 : 0;\n  for (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n    item = data[i];\n    if (head) {\n      noOp(item, renderedValues[i]);\n    } else {\n      head = createFn(item, i);\n      mode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n    }\n    head = head.nextSibling;\n    if (head === afterNode) head = null;\n  }\n};\n","// Original: https://github.com/Freak613/stage0/blob/master/reconcile.js\n\nexport function reconcile(\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) {\n  // Fast path for clear\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined\n            ? beforeNode.nextElementSibling\n            : parent.firstElementChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node && node !== afterNode) {\n        tmp = node.nextElementSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n\n  // Fast path for create\n  if (renderedValues.length === 0) {\n    let node,\n      mode = afterNode !== undefined ? 1 : 0;\n    for (let i = 0, len = data.length; i < len; i++) {\n      node = createFn(data[i], i);\n      mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n    }\n    return;\n  }\n\n  let prevStart = 0,\n    newStart = 0,\n    loop = true,\n    prevEnd = renderedValues.length - 1,\n    newEnd = data.length - 1,\n    a,\n    b,\n    prevStartNode = beforeNode\n      ? beforeNode.nextElementSibling\n      : parent.firstElementChild,\n    newStartNode = prevStartNode,\n    prevEndNode = afterNode\n      ? afterNode.previousElementSibling\n      : parent.lastElementChild,\n    newEndNode = prevEndNode;\n\n  fixes: while (loop) {\n    loop = false;\n    let _node;\n\n    // Skip prefix\n    (a = renderedValues[prevStart]), (b = data[newStart]);\n    while (a === b) {\n      noOp(prevStartNode, b);\n      prevStart++;\n      newStart++;\n      newStartNode = prevStartNode = prevStartNode.nextElementSibling;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevStart];\n      b = data[newStart];\n    }\n\n    // Skip suffix\n    (a = renderedValues[prevEnd]), (b = data[newEnd]);\n    while (a === b) {\n      noOp(prevEndNode, b);\n      prevEnd--;\n      newEnd--;\n      afterNode = prevEndNode;\n      newEndNode = prevEndNode = prevEndNode.previousElementSibling;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevEnd];\n      b = data[newEnd];\n    }\n\n    // Fast path to swap backward\n    (a = renderedValues[prevEnd]), (b = data[newStart]);\n    while (a === b) {\n      loop = true;\n      noOp(prevEndNode, b);\n      _node = prevEndNode.previousElementSibling;\n      parent.insertBefore(prevEndNode, newStartNode);\n      newEndNode = prevEndNode = _node;\n      newStart++;\n      prevEnd--;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevEnd];\n      b = data[newStart];\n    }\n\n    // Fast path to swap forward\n    (a = renderedValues[prevStart]), (b = data[newEnd]);\n    while (a === b) {\n      loop = true;\n      noOp(prevStartNode, b);\n      _node = prevStartNode.nextElementSibling;\n      parent.insertBefore(prevStartNode, afterNode);\n      prevStart++;\n      afterNode = newEndNode = prevStartNode;\n      prevStartNode = _node;\n      newEnd--;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevStart];\n      b = data[newEnd];\n    }\n  }\n\n  // Fast path for shrink\n  if (newEnd < newStart) {\n    if (prevStart <= prevEnd) {\n      let next;\n      while (prevStart <= prevEnd) {\n        if (prevEnd === 0) {\n          parent.removeChild(prevEndNode);\n        } else {\n          next = prevEndNode.previousElementSibling;\n          parent.removeChild(prevEndNode);\n          prevEndNode = next;\n        }\n        prevEnd--;\n      }\n    }\n    return;\n  }\n\n  // Fast path for add\n  if (prevEnd < prevStart) {\n    if (newStart <= newEnd) {\n      let node,\n        mode = afterNode ? 1 : 0;\n      while (newStart <= newEnd) {\n        node = createFn(data[newStart], newStart);\n        mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n        newStart++;\n      }\n    }\n    return;\n  }\n\n  // Positions for reusing nodes from current DOM state\n  const P = new Array(newEnd + 1 - newStart);\n  for (let i = newStart; i <= newEnd; i++) P[i] = -1;\n\n  // Index to resolve position from current to new\n  const I = new Map();\n  for (let i = newStart; i <= newEnd; i++) I.set(data[i], i);\n\n  let reusingNodes = newStart + data.length - 1 - newEnd,\n    toRemove = [];\n\n  for (let i = prevStart; i <= prevEnd; i++) {\n    if (I.has(renderedValues[i])) {\n      P[I.get(renderedValues[i])] = i;\n      reusingNodes++;\n    } else {\n      toRemove.push(i);\n    }\n  }\n\n  // Fast path for full replace\n  if (reusingNodes === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined\n            ? beforeNode.nextElementSibling\n            : parent.firstElementChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextElementSibling;\n        parent.removeChild(node);\n        node = tmp;\n        prevStart++;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n\n    let node,\n      mode = afterNode ? 1 : 0;\n    for (let i = newStart; i <= newEnd; i++) {\n      node = createFn(data[i], i);\n      mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n    }\n\n    return;\n  }\n\n  // What else?\n  const longestSeq = longestPositiveIncreasingSubsequence(P, newStart);\n\n  // Collect nodes to work with them\n  const nodes = [];\n  let tmpC = prevStartNode;\n  for (let i = prevStart; i <= prevEnd; i++) {\n    nodes[i] = tmpC;\n    tmpC = tmpC.nextElementSibling;\n  }\n\n  for (let i = 0; i < toRemove.length; i++)\n    parent.removeChild(nodes[toRemove[i]]);\n\n  let lisIdx = longestSeq.length - 1,\n    tmpD;\n  for (let i = newEnd; i >= newStart; i--) {\n    if (longestSeq[lisIdx] === i) {\n      afterNode = nodes[P[longestSeq[lisIdx]]];\n      noOp(afterNode, data[i]);\n      lisIdx--;\n    } else {\n      if (P[i] === -1) {\n        tmpD = createFn(data[i], i);\n      } else {\n        tmpD = nodes[P[i]];\n        noOp(tmpD, data[i]);\n      }\n      parent.insertBefore(tmpD, afterNode);\n      afterNode = tmpD;\n    }\n  }\n}\n\nexport default reconcile;\n\n// Picked from\n// https://github.com/adamhaile/surplus/blob/master/src/runtime/content.ts#L368\n\n// return an array of the indices of ns that comprise the longest increasing subsequence within ns\nfunction longestPositiveIncreasingSubsequence(ns, newStart) {\n  var seq = [],\n    is = [],\n    l = -1,\n    pre = new Array(ns.length);\n\n  for (var i = newStart, len = ns.length; i < len; i++) {\n    var n = ns[i];\n    if (n < 0) continue;\n    var j = findGreatestIndexLEQ(seq, n);\n    if (j !== -1) pre[i] = is[j];\n    if (j === l) {\n      l++;\n      seq[l] = n;\n      is[l] = i;\n    } else if (n < seq[j + 1]) {\n      seq[j + 1] = n;\n      is[j + 1] = i;\n    }\n  }\n\n  for (i = is[l]; l >= 0; i = pre[i], l--) {\n    seq[l] = i;\n  }\n\n  return seq;\n}\n\nfunction findGreatestIndexLEQ(seq, n) {\n  // invariant: lo is guaranteed to be index of a value <= n, hi to be >\n  // therefore, they actually start out of range: (-1, last + 1)\n  var lo = -1,\n    hi = seq.length;\n\n  // fast path for simple increasing sequences\n  if (hi > 0 && seq[hi - 1] <= n) return hi - 1;\n\n  while (hi - lo > 1) {\n    var mid = Math.floor((lo + hi) / 2);\n    if (seq[mid] > n) {\n      hi = mid;\n    } else {\n      lo = mid;\n    }\n  }\n\n  return lo;\n}\n","import { beforeCompute, computed } from './f';\nimport { reuseNodes } from './reuse-nodes';\nimport { FidanValue } from '.';\nimport reconcile from './reconcile';\n\nexport const htmlProps = {\n\tid: true,\n\tnodeValue: true,\n\ttextContent: true,\n\tclassName: true,\n\tinnerHTML: true,\n\tinnerText: true,\n\ttabIndex: true,\n\tvalue: true,\n\tchecked: true,\n\tdisabled: true,\n\treadonly: true,\n\tcontentEditable: true\n};\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n\tconst typeOf = typeof itemElement;\n\tif (typeOf === 'function') {\n\t\titemElement(parentElement);\n\t} else {\n\t\tif (typeOf !== 'object') {\n\t\t\titemElement = document.createTextNode(itemElement);\n\t\t}\n\t\tparentElement.insertBefore(itemElement, parentElement.children[index]);\n\t}\n};\n\nexport const arrayMap = <T>(\n\tarr: FidanValue<T[]>,\n\tparentDom: Node & ParentNode,\n\tnextElement: Element,\n\trenderCallback: (item: any, idx?: number, isInsert?: boolean) => Node,\n\trenderMode?: 'reuse' | 'reconcile'\n) => {\n\t// const prevElement = document.createDocumentFragment();\n\tconst prevElement = nextElement ? document.createTextNode('') : undefined;\n\tnextElement && parentDom.insertBefore(prevElement, nextElement);\n\tbeforeCompute(\n\t\tarr.$val,\n\t\t(nextVal, opt) => {\n\t\t\tconst beforeVal = opt.computedItem.$val;\n\t\t\tif (!renderMode) {\n\t\t\t\tconst parentFragment = document.createDocumentFragment();\n\t\t\t\tparentDom.textContent = '';\n\t\t\t\tfor (var i = 0; i < nextVal.length; i++) {\n\t\t\t\t\tinsertToDom(parentFragment, i, renderCallback(nextVal[i], i));\n\t\t\t\t}\n\t\t\t\tparentDom.appendChild(parentFragment);\n\t\t\t} else {\n\t\t\t\tlet renderFunction: (parent, renderedValues, data, createFn, noOp, beforeNode?, afterNode?) => void =\n\t\t\t\t\trenderMode === 'reconcile' ? reconcile : reuseNodes;\n\t\t\t\trenderFunction(\n\t\t\t\t\tparentDom,\n\t\t\t\t\tbeforeVal || [],\n\t\t\t\t\tnextVal || [],\n\t\t\t\t\t(nextItem, index) => {\n\t\t\t\t\t\t// create\n\t\t\t\t\t\treturn renderCallback(nextItem, index);\n\t\t\t\t\t},\n\t\t\t\t\t(nextItem, prevItem) => {\n\t\t\t\t\t\t// update\n\t\t\t\t\t\t// for (var key in nextItem) {\n\t\t\t\t\t\t//   if (prevItem[key].hasOwnProperty(\"$val\")) {\n\t\t\t\t\t\t//     nextItem[key].depends = prevItem[key].depends;\n\t\t\t\t\t\t//     prevItem[key](nextItem[key]());\n\t\t\t\t\t\t//   }\n\t\t\t\t\t\t// }\n\t\t\t\t\t},\n\t\t\t\t\tprevElement,\n\t\t\t\t\tnextElement\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\t[ arr ]\n\t);\n};\n","import { value } from './f';\nimport { FidanValue, FidanArray, DataArrayEvents, ComputionMethodArguments } from '.';\n\nexport const injectToProperty = (obj: Object, propertyKey: string, val: FidanValue<any>) => {\n\t// const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n\t// if (descr.configurable)\n\tObject.defineProperty(obj, propertyKey, {\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t\tget: () => {\n\t\t\tval();\n\t\t\treturn val;\n\t\t},\n\t\tset: (v) => (v.hasOwnProperty('$val') ? (val = v) : val(v))\n\t});\n\t// else {\n\t//   // descr.get().c_depends.push(val);\n\t//   // val[\"c_depends\"].push(descr.get());\n\t// }\n};\n\nexport const inject = <T extends Object>(obj: T): T => {\n\tfor (var key in obj) {\n\t\tinjectToProperty(obj, key, value(obj[key]));\n\t}\n\treturn obj;\n};\n\nexport const debounce = (func, wait, immediate?) => {\n\tlet timeout;\n\n\treturn function() {\n\t\tlet context = this;\n\t\tlet args = arguments;\n\t\tlet later = function() {\n\t\t\ttimeout = null;\n\t\t\tif (!immediate) func.apply(context, args);\n\t\t};\n\t\tlet callNow = immediate && !timeout;\n\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t\tif (callNow) func.apply(context, args);\n\t};\n};\n\nexport const transformToDataArrayEvents = <T>(opt: ComputionMethodArguments<T[]>, events: DataArrayEvents<T>) => {\n\t/*\n    \"copyWithin\",\n    \"fill\",\n    \"pop\",\n    \"push\",\n    \"reverse\",\n    \"shift\",\n    \"sort\",\n    \"splice\",\n    \"unshift\"\n  */\n\n\tconst { method, computedItem, args } = opt;\n\tif (!method) {\n\t\tconst vals: any[] = computedItem.$val;\n\t\tif (vals) {\n\t\t\tevents.onRemove(vals);\n\t\t\tevents.onAdd(vals);\n\t\t}\n\t} else if (method === 'push') {\n\t\targs && events.onAdd(args);\n\t} else if (method === 'splice') {\n\t\tconst start = args[0];\n\t\tconst deleteCount = args[1];\n\t\tconst addItems = args.slice(2);\n\t\tconst arr: any[] = computedItem.$val;\n\t\tevents.onRemove(arr.slice(start, start + deleteCount));\n\t\tevents.onAdd(addItems);\n\t}\n\t// TODO yukardaki diğer metodlar implemente edilecek.\n};\n","import { computed } from './f';\nimport { arrayMap, htmlProps } from './dom';\nimport { FidanValue } from '.';\n\nconst COMMENT_TEXT = 1;\nconst COMMENT_DOM = 2;\nconst COMMENT_FN = 4; // \"function\" && !isDynamic\nconst COMMENT_HTM = 8;\nconst COMMENT_TEXT_OR_DOM = COMMENT_TEXT | COMMENT_DOM;\n\nlet _templateMode = false; // TODO kaldırılacak yerine başka bir yöntem geliştirilecek\nlet template = document.createElement('template');\n\nexport const coditionalDom = (\n\tcondition: () => boolean,\n\tdependencies: FidanValue<any>[],\n\thtmlFragment: DocumentFragment\n) => (parentElement: Element, nextElement: Element) => {\n\tconst childs = Array.from(htmlFragment.children);\n\tlet inserted = false;\n\tcomputed(() => {\n\t\tif (condition()) {\n\t\t\tif (!inserted) {\n\t\t\t\tlet tmpNextElement = nextElement;\n\t\t\t\tfor (var i = childs.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst child = childs[i];\n\t\t\t\t\ttmpNextElement = parentElement.insertBefore(child, tmpNextElement);\n\t\t\t\t}\n\t\t\t\tinserted = true;\n\t\t\t}\n\t\t} else {\n\t\t\tchilds.forEach((child) => child.remove());\n\t\t\tinserted = false;\n\t\t}\n\t}, dependencies);\n};\n\nconst putCommentToTagStart = (htm: string[], index: number, comment: string) => {\n\tfor (var i = index; i >= 0; i--) {\n\t\tlet item = htm[i];\n\t\tlet p = item.lastIndexOf('<');\n\t\tif (p !== -1) {\n\t\t\thtm[i] = item.substr(0, p) + comment + item.substr(p);\n\t\t\t// htm[i] =\n\t\t\t//   item.substr(0, p) + comment + item.substr(p, item.lastIndexOf(\" \") - p);\n\t\t\t// if (htm[index + 1].substr(0, 1) === '\"') {\n\t\t\t//   htm[index + 1] = htm[index + 1].substr(1);\n\t\t\t// }\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\nexport const html = (...args) => {\n\tconst htm: string[] = args[0].slice();\n\tconst params = args.slice(1);\n\tlet attributeName: string = null;\n\tlet i = 0;\n\n\tfor (var index = 0; index < htm.length; index++) {\n\t\tlet item = htm[index];\n\t\tconst param = params[index];\n\t\tif (param === undefined) {\n\t\t\tbreak;\n\t\t}\n\t\tconst isDynamic = param && param.hasOwnProperty('$val');\n\t\tif (isDynamic) {\n\t\t\tif (param['$indexes'] === undefined) {\n\t\t\t\tparam['$indexes'] = [];\n\t\t\t}\n\t\t\tparam['$indexes'].push(index);\n\t\t}\n\t\tif (item.endsWith('=\"')) {\n\t\t\ti = item.lastIndexOf(' ') + 1;\n\t\t\tattributeName = item.substr(i, item.length - i - 2);\n\t\t\tputCommentToTagStart(htm, index, `<!-- cmt_${COMMENT_DOM}_${index}_${attributeName} -->`);\n\t\t} else {\n\t\t\tlet commentType =\n\t\t\t\ttypeof param === 'function' && !isDynamic\n\t\t\t\t\t? COMMENT_FN\n\t\t\t\t\t: typeof param === 'object' && param ? COMMENT_HTM : COMMENT_TEXT;\n\t\t\thtm[index] = item + `<!-- cmt_${commentType}_${index} -->`;\n\t\t}\n\t}\n\ttemplate = template.cloneNode(false) as HTMLTemplateElement;\n\ttemplate.innerHTML = htm.join('');\n\t/**    \n    .replace(/\\n/g, \"\")\n    .replace(/  /g, \" \")\n    .replace(/  /g, \"\")\n    .replace(/> /g, \">\")\n    .replace(/ </g, \"<\");\n     */\n\tconst element = template.content;\n\telement['$params'] = params;\n\tif (!_templateMode) {\n\t\tvar commentNodes = [];\n\t\twalkForCommentNodes(element, commentNodes);\n\t\tupdateNodesByCommentNodes(commentNodes, params);\n\t}\n\treturn element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n\tvar treeWalker = document.createTreeWalker(\n\t\telement,\n\t\tNodeFilter.SHOW_COMMENT,\n\t\t{\n\t\t\tacceptNode: function(node) {\n\t\t\t\tvar nodeValue = node.nodeValue.trim();\n\t\t\t\treturn nodeValue.startsWith('cmt_') ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;\n\t\t\t}\n\t\t},\n\t\tfalse\n\t);\n\n\twhile (treeWalker.nextNode()) {\n\t\tcommentNodes.push(treeWalker.currentNode);\n\t}\n};\n\nconst updateNodesByCommentNodes = (commentNodes: Comment[], params: any[]) => {\n\tfor (var i = 0; i < commentNodes.length; i++) {\n\t\tconst commentNode = commentNodes[i];\n\t\tvar commentValue = commentNode.nodeValue;\n\t\tlet element = null;\n\t\tlet attributeName: string = null;\n\n\t\tlet i1 = commentValue.indexOf('_') + 1;\n\t\tvar i2 = commentValue.indexOf('_', i1);\n\t\tconst commentType = parseInt(commentValue.substr(i1, i2 - i1));\n\t\ti1 = commentValue.indexOf('_', i2) + 1;\n\t\ti2 = commentValue.indexOf('_', i1);\n\t\tif (i2 === -1) {\n\t\t\ti2 = commentValue.indexOf(' ', i1);\n\t\t}\n\t\tlet paramIndex = parseInt(commentValue.substr(i1, i2 - i1));\n\t\tlet param = params[paramIndex];\n\t\tconst isDynamic = param && param.hasOwnProperty('$val');\n\n\t\tif (commentType & COMMENT_TEXT_OR_DOM) {\n\t\t\tif (commentType === COMMENT_TEXT) {\n\t\t\t\tattributeName = 'textContent';\n\t\t\t\telement = document.createTextNode(isDynamic ? param.$val : param);\n\t\t\t\tcommentNode.parentElement.insertBefore(element, commentNode.nextSibling);\n\t\t\t\tif (!isDynamic) {\n\t\t\t\t\tif (Array.isArray(param)) {\n\t\t\t\t\t\tfor (var p = 0; p < param.length; p++) {\n\t\t\t\t\t\t\tcommentNode.parentElement.appendChild(param[p]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (commentType === COMMENT_DOM) {\n\t\t\t\tattributeName = commentValue.substr(i2 + 1, commentValue.length - i2 - 2);\n\t\t\t\telement = commentNode.nextElementSibling;\n\t\t\t}\n\t\t\t// commentType !== COMMENT_FN && commentNode.remove();\n\t\t\tif (attributeName.startsWith('on')) {\n\t\t\t\t(element as Element).addEventListener(attributeName.substr(2), param);\n\t\t\t} else if (isDynamic) {\n\t\t\t\tif (htmlProps[attributeName]) {\n\t\t\t\t\tcomputed(\n\t\t\t\t\t\t(val) => {\n\t\t\t\t\t\t\telement[attributeName] = val;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[ param ]\n\t\t\t\t\t);\n\t\t\t\t\telement[attributeName] = param();\n\t\t\t\t} else {\n\t\t\t\t\tcomputed(\n\t\t\t\t\t\t(val) => {\n\t\t\t\t\t\t\telement.setAttribute(attributeName, val);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[ param ]\n\t\t\t\t\t);\n\t\t\t\t\telement.setAttribute(attributeName, param());\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (htmlProps[attributeName]) {\n\t\t\t\t\telement[attributeName] = param;\n\t\t\t\t} else if (typeof param === 'function') {\n\t\t\t\t\tparam(element);\n\t\t\t\t} else {\n\t\t\t\t\telement.setAttribute(attributeName, param);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (commentType === COMMENT_FN) {\n\t\t\tif (commentNode.parentElement) {\n\t\t\t\tparam(commentNode.parentElement, commentNode.nextElementSibling);\n\t\t\t\t// commentNode.remove();\n\t\t\t} else {\n\t\t\t\t//conditionalDom can be place on root\n\t\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t\tparam(commentNode.parentElement, commentNode.nextElementSibling);\n\t\t\t\t\t// commentNode.remove();\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (commentType === COMMENT_HTM) {\n\t\t\tcommentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n\t\t}\n\t}\n};\n\nexport const htmlArrayMap = <T>(\n\tarr: FidanValue<T[]>,\n\trenderCallback: (data: T) => DocumentFragment,\n\toptions?: {\n\t\tuseCloneNode: boolean;\n\t\trenderMode?: 'reuse' | 'reconcile';\n\t}\n) => {\n\toptions = Object.assign({ useCloneNode: false, reuseMode: false }, options);\n\tif (options.useCloneNode) {\n\t\treturn (parentElement: Element, nextElement: Element) => {\n\t\t\tlet clonedNode = null;\n\t\t\tlet params = null;\n\t\t\tlet dataParamIndexes = [];\n\t\t\t// let commentNodesAddresses: number[][] = null;\n\t\t\tconst arrayMapFn = (data) => {\n\t\t\t\tlet renderNode = null;\n\t\t\t\tvar commentNodes = [];\n\t\t\t\tif (clonedNode === null) {\n\t\t\t\t\t_templateMode = true;\n\t\t\t\t\trenderNode = renderCallback(data);\n\t\t\t\t\t_templateMode = false;\n\t\t\t\t\tparams = renderNode['$params'];\n\t\t\t\t\tfor (var key in data) {\n\t\t\t\t\t\tconst indexes = data[key]['$indexes'];\n\t\t\t\t\t\tif (indexes)\n\t\t\t\t\t\t\tfor (var i = 0; i < indexes.length; i++) {\n\t\t\t\t\t\t\t\tdataParamIndexes.push(indexes[i], key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tclonedNode = renderNode.cloneNode(true);\n\t\t\t\t\t// walkForCommentNodes(clonedNode, commentNodes);\n\t\t\t\t\t// commentNodesAddresses = generateCommentNodesAddresses(commentNodes);\n\t\t\t\t} else {\n\t\t\t\t\trenderNode = clonedNode.cloneNode(true);\n\t\t\t\t}\n\t\t\t\tfor (var i = 0; i < dataParamIndexes.length; i += 2) {\n\t\t\t\t\tparams[dataParamIndexes[i]] = data[dataParamIndexes[i + 1]];\n\t\t\t\t}\n\t\t\t\t// generateCommentNodesFromAddresses(\n\t\t\t\t//   commentNodesAddresses,\n\t\t\t\t//   renderNode,\n\t\t\t\t//   commentNodes\n\t\t\t\t// );\n\t\t\t\twalkForCommentNodes(renderNode, commentNodes);\n\t\t\t\tupdateNodesByCommentNodes(commentNodes, params);\n\t\t\t\treturn renderNode;\n\t\t\t};\n\t\t\tarrayMap(arr, parentElement, nextElement, arrayMapFn, options.renderMode);\n\t\t};\n\t} else {\n\t\treturn function(parentElement: Element, nextElement: Element) {\n\t\t\tarrayMap(arr as any, parentElement, nextElement, renderCallback);\n\t\t};\n\t}\n};\n\n// const generateCommentNodesAddresses = (commentNodes: Comment[]) => {\n//   const paths: number[][] = [];\n//   for (var i = 0; i < commentNodes.length; i++) {\n//     const path: number[] = [];\n//     let node = commentNodes[i] as Node & ChildNode;\n//     let parent = node.parentNode as Node & ParentNode;\n//     while (parent) {\n//       path.push(Array.from(parent.childNodes).indexOf(node));\n//       node = parent as any;\n//       parent = parent.parentNode;\n//     }\n//     paths.push(path.reverse());\n//   }\n//   return paths;\n// };\n// const generateCommentNodesFromAddresses = (\n//   commentNodesAddresses: number[][],\n//   element: Element,\n//   commentNodes: Comment[]\n// ) => {\n//   for (var i = 0; i < commentNodesAddresses.length; i++) {\n//     const path = commentNodesAddresses[i];\n//     let node = null;\n//     let parent = element;\n//     for (var p = 0; p < path.length; p++) {\n//       node = parent.childNodes.item(path[p]);\n//       parent = node;\n//     }\n//     commentNodes.push(node);\n//   }\n// };\n"],"names":["let","autoTrackDependencies","value","val","hasOwnProperty","innerFn","opt","undefined","indexOf","push","depends","length","i","beforeCompute","Array","isArray","overrideArrayMutators","dependFn","compute","debugName","name","Object","defineProperty","toString","toJSON","deps","computed","fn","dependencies","cmp","computedItem","$val","initalValue","const","dataArray","size","forEach","method","arr","slice","size1","ret","prototype","apply","arguments","size2","args","reuseNodes","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstChild","tmp","removeChild","textContent","tail","previousSibling","lastChild","_head","_mode","item","head","mode","insertBefore","appendChild","reconcile","nextElementSibling","firstElementChild","len","prevStart","newStart","loop","prevEnd","newEnd","a","b","prevStartNode","newStartNode","prevEndNode","previousElementSibling","lastElementChild","newEndNode","fixes","_node","next","P","I","Map","set","reusingNodes","toRemove","has","get","longestSeq","longestPositiveIncreasingSubsequence","nodes","tmpC","lisIdx","tmpD","ns","seq","is","l","pre","n","j","findGreatestIndexLEQ","lo","hi","mid","Math","floor","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","checked","disabled","readonly","contentEditable","insertToDom","parentElement","index","itemElement","typeOf","document","createTextNode","children","arrayMap","parentDom","nextElement","renderCallback","renderMode","prevElement","nextVal","beforeVal","parentFragment","createDocumentFragment","renderFunction","nextItem","prevItem","injectToProperty","obj","propertyKey","configurable","enumerable","v","inject","key","debounce","func","wait","immediate","timeout","context","later","callNow","clearTimeout","setTimeout","transformToDataArrayEvents","events","vals","onRemove","onAdd","start","deleteCount","addItems","COMMENT_TEXT","COMMENT_DOM","COMMENT_FN","COMMENT_HTM","COMMENT_TEXT_OR_DOM","_templateMode","template","createElement","coditionalDom","condition","htmlFragment","childs","from","inserted","tmpNextElement","child","remove","putCommentToTagStart","htm","comment","p","lastIndexOf","substr","html","params","attributeName","param","isDynamic","endsWith","commentType","cloneNode","join","element","content","commentNodes","walkForCommentNodes","updateNodesByCommentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","trim","startsWith","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","commentNode","commentValue","i1","i2","parseInt","paramIndex","addEventListener","setAttribute","window","requestAnimationFrame","htmlArrayMap","options","assign","useCloneNode","reuseMode","clonedNode","dataParamIndexes","arrayMapFn","renderNode","indexes"],"mappings":"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"}