{"version":3,"file":"index.js","sources":["../src/f.ts","../src/reuse-nodes.ts","../src/reconcile.ts","../src/dom.ts","../src/util.ts","../src/html.ts"],"sourcesContent":["import { FidanValue, FidanArray, ComputionMethodArguments } from \".\";\r\n\r\nlet autoTrackDependencies: any[] = null;\r\n\r\nexport const value = <T>(val?: T): FidanValue<T> & (T extends Array<any> ? FidanArray<T> : unknown) => {\r\n  if (val && val.hasOwnProperty(\"$val\")) return val as any;\r\n  const innerFn: any = (val?: T, opt?: ComputionMethodArguments<T>) => {\r\n    if (val === undefined) {\r\n      if (\r\n        autoTrackDependencies &&\r\n        autoTrackDependencies.indexOf(innerFn) === -1\r\n      ) {\r\n        autoTrackDependencies.push(innerFn);\r\n      }\r\n      return innerFn[\"$val\"];\r\n    } else {\r\n      let depends = innerFn[\"bc_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i].beforeCompute(val, opt);\r\n        }\r\n      innerFn[\"$val\"] = val;\r\n      if (Array.isArray(val)) {\r\n        overrideArrayMutators(innerFn);\r\n      }\r\n      depends = innerFn[\"c_depends\"];\r\n      if (depends.length)\r\n        for (var i = 0; i < depends.length; i++) {\r\n          depends[i](depends[i].compute(val, opt));\r\n        }\r\n    }\r\n  };\r\n\r\n  innerFn[\"$val\"] = val;\r\n  if (Array.isArray(val)) {\r\n    overrideArrayMutators(innerFn);\r\n  }\r\n  innerFn[\"bc_depends\"] = [];\r\n  innerFn[\"c_depends\"] = [];\r\n  innerFn.depends = (dependencies: () => FidanValue<any>[]): FidanValue<T> => {\r\n    const deps = dependencies();\r\n    for (var i = 0; i < deps.length; i++) innerFn[\"c_depends\"].push(deps[i]);\r\n    return innerFn;\r\n  };\r\n  innerFn.debugName = (name: string) => {\r\n    Object.defineProperty(innerFn, \"name\", { value: name });\r\n    return innerFn;\r\n  };\r\n  innerFn.toString = innerFn.toJSON = () => innerFn[\"$val\"].toJSON ? innerFn[\"$val\"].toJSON() : innerFn[\"$val\"];\r\n  return innerFn;\r\n};\r\n\r\nexport const compute = <T>(\r\n  fn: (val: T, opt?: ComputionMethodArguments<T>) => any,\r\n  dependencies?: any[]\r\n): any => {\r\n  autoTrackDependencies = dependencies ? null : [];\r\n  const cmp = value<T>();\r\n  const val = fn(undefined, { computedItem: cmp } as any);\r\n  cmp.$val = val;\r\n  if (Array.isArray(val)) {\r\n    overrideArrayMutators(cmp as any);\r\n  }\r\n  const deps = autoTrackDependencies ? autoTrackDependencies : dependencies;\r\n  autoTrackDependencies = null;\r\n  cmp[\"compute\"] = fn;\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"c_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nexport const beforeCompute = <T>(\r\n  initalValue: T,\r\n  fn: (nextValue?: T, opt?: ComputionMethodArguments<T>) => void,\r\n  deps: FidanValue<any>[]\r\n) => {\r\n  const cmp = value<T>(fn(initalValue, { computedItem: {} } as any) as any);\r\n  cmp[\"beforeCompute\"] = fn;\r\n  for (var i = 0; i < deps.length; i++) deps[i][\"bc_depends\"].push(cmp);\r\n  return cmp;\r\n};\r\n\r\nconst overrideArrayMutators = (dataArray: FidanArray<any[]>) => {\r\n  if (!dataArray.size) dataArray.size = value(dataArray.$val.length);\r\n  else dataArray.size(dataArray.$val.length);\r\n  if (dataArray.$val[\"$overrided\"]) return;\r\n  dataArray.$val[\"$overrided\"] = true;\r\n  [\r\n    \"copyWithin\",\r\n    \"fill\",\r\n    \"pop\",\r\n    \"push\",\r\n    \"reverse\",\r\n    \"shift\",\r\n    \"sort\",\r\n    \"splice\",\r\n    \"unshift\"\r\n  ].forEach(method => {\r\n    dataArray.$val[method] = function () {\r\n      const arr = dataArray.$val.slice(0);\r\n      const size1 = arr.length;\r\n      const ret = Array.prototype[method].apply(arr, arguments);\r\n      const size2 = arr.length;\r\n      if (size1 !== size2) dataArray.size(size2);\r\n      dataArray(arr, {\r\n        method,\r\n        computedItem: dataArray,\r\n        args: [...arguments]\r\n      });\r\n      return ret;\r\n    };\r\n  });\r\n};\r\n","// Original: https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) => {\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node && node !== afterNode) {\n        tmp = node.nextSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n  if (renderedValues.length > data.length) {\n    let i = renderedValues.length,\n      tail =\n        afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n      tmp;\n    while (i > data.length) {\n      tmp = tail.previousSibling;\n      parent.removeChild(tail);\n      tail = tmp;\n      i--;\n    }\n  }\n\n  let _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n  if (_head === afterNode) _head = undefined;\n\n  let _mode = afterNode ? 1 : 0;\n  for (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n    item = data[i];\n    if (head) {\n      noOp(item, renderedValues[i]);\n    } else {\n      head = createFn(item, i);\n      mode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n    }\n    head = head.nextSibling;\n    if (head === afterNode) head = null;\n  }\n};\n","// Original: https://github.com/Freak613/stage0/blob/master/reconcile.js\n\nexport function reconcile(\n  parent,\n  renderedValues,\n  data,\n  createFn,\n  noOp,\n  beforeNode?,\n  afterNode?\n) {\n  // Fast path for clear\n  if (data.length === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined\n            ? beforeNode.nextElementSibling\n            : parent.firstElementChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node && node !== afterNode) {\n        tmp = node.nextElementSibling;\n        parent.removeChild(node);\n        node = tmp;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n    return;\n  }\n\n  // Fast path for create\n  if (renderedValues.length === 0) {\n    let node,\n      mode = afterNode !== undefined ? 1 : 0;\n    for (let i = 0, len = data.length; i < len; i++) {\n      node = createFn(data[i], i);\n      mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n    }\n    return;\n  }\n\n  let prevStart = 0,\n    newStart = 0,\n    loop = true,\n    prevEnd = renderedValues.length - 1,\n    newEnd = data.length - 1,\n    a,\n    b,\n    prevStartNode = beforeNode\n      ? beforeNode.nextElementSibling\n      : parent.firstElementChild,\n    newStartNode = prevStartNode,\n    prevEndNode = afterNode\n      ? afterNode.previousElementSibling\n      : parent.lastElementChild,\n    newEndNode = prevEndNode;\n\n  fixes: while (loop) {\n    loop = false;\n    let _node;\n\n    // Skip prefix\n    (a = renderedValues[prevStart]), (b = data[newStart]);\n    while (a === b) {\n      noOp(prevStartNode, b);\n      prevStart++;\n      newStart++;\n      newStartNode = prevStartNode = prevStartNode.nextElementSibling;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevStart];\n      b = data[newStart];\n    }\n\n    // Skip suffix\n    (a = renderedValues[prevEnd]), (b = data[newEnd]);\n    while (a === b) {\n      noOp(prevEndNode, b);\n      prevEnd--;\n      newEnd--;\n      afterNode = prevEndNode;\n      newEndNode = prevEndNode = prevEndNode.previousElementSibling;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevEnd];\n      b = data[newEnd];\n    }\n\n    // Fast path to swap backward\n    (a = renderedValues[prevEnd]), (b = data[newStart]);\n    while (a === b) {\n      loop = true;\n      noOp(prevEndNode, b);\n      _node = prevEndNode.previousElementSibling;\n      parent.insertBefore(prevEndNode, newStartNode);\n      newEndNode = prevEndNode = _node;\n      newStart++;\n      prevEnd--;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevEnd];\n      b = data[newStart];\n    }\n\n    // Fast path to swap forward\n    (a = renderedValues[prevStart]), (b = data[newEnd]);\n    while (a === b) {\n      loop = true;\n      noOp(prevStartNode, b);\n      _node = prevStartNode.nextElementSibling;\n      parent.insertBefore(prevStartNode, afterNode);\n      prevStart++;\n      afterNode = newEndNode = prevStartNode;\n      prevStartNode = _node;\n      newEnd--;\n      if (prevEnd < prevStart || newEnd < newStart) break fixes;\n      a = renderedValues[prevStart];\n      b = data[newEnd];\n    }\n  }\n\n  // Fast path for shrink\n  if (newEnd < newStart) {\n    if (prevStart <= prevEnd) {\n      let next;\n      while (prevStart <= prevEnd) {\n        if (prevEnd === 0) {\n          parent.removeChild(prevEndNode);\n        } else {\n          next = prevEndNode.previousElementSibling;\n          parent.removeChild(prevEndNode);\n          prevEndNode = next;\n        }\n        prevEnd--;\n      }\n    }\n    return;\n  }\n\n  // Fast path for add\n  if (prevEnd < prevStart) {\n    if (newStart <= newEnd) {\n      let node,\n        mode = afterNode ? 1 : 0;\n      while (newStart <= newEnd) {\n        node = createFn(data[newStart], newStart);\n        mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n        newStart++;\n      }\n    }\n    return;\n  }\n\n  // Positions for reusing nodes from current DOM state\n  const P = new Array(newEnd + 1 - newStart);\n  for (let i = newStart; i <= newEnd; i++) P[i] = -1;\n\n  // Index to resolve position from current to new\n  const I = new Map();\n  for (let i = newStart; i <= newEnd; i++) I.set(data[i], i);\n\n  let reusingNodes = newStart + data.length - 1 - newEnd,\n    toRemove = [];\n\n  for (let i = prevStart; i <= prevEnd; i++) {\n    if (I.has(renderedValues[i])) {\n      P[I.get(renderedValues[i])] = i;\n      reusingNodes++;\n    } else {\n      toRemove.push(i);\n    }\n  }\n\n  // Fast path for full replace\n  if (reusingNodes === 0) {\n    if (beforeNode !== undefined || afterNode !== undefined) {\n      let node =\n          beforeNode !== undefined\n            ? beforeNode.nextElementSibling\n            : parent.firstElementChild,\n        tmp;\n\n      if (afterNode === undefined) afterNode = null;\n\n      while (node !== afterNode) {\n        tmp = node.nextElementSibling;\n        parent.removeChild(node);\n        node = tmp;\n        prevStart++;\n      }\n    } else {\n      parent.textContent = \"\";\n    }\n\n    let node,\n      mode = afterNode ? 1 : 0;\n    for (let i = newStart; i <= newEnd; i++) {\n      node = createFn(data[i], i);\n      mode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n    }\n\n    return;\n  }\n\n  // What else?\n  const longestSeq = longestPositiveIncreasingSubsequence(P, newStart);\n\n  // Collect nodes to work with them\n  const nodes = [];\n  let tmpC = prevStartNode;\n  for (let i = prevStart; i <= prevEnd; i++) {\n    nodes[i] = tmpC;\n    tmpC = tmpC.nextElementSibling;\n  }\n\n  for (let i = 0; i < toRemove.length; i++)\n    parent.removeChild(nodes[toRemove[i]]);\n\n  let lisIdx = longestSeq.length - 1,\n    tmpD;\n  for (let i = newEnd; i >= newStart; i--) {\n    if (longestSeq[lisIdx] === i) {\n      afterNode = nodes[P[longestSeq[lisIdx]]];\n      noOp(afterNode, data[i]);\n      lisIdx--;\n    } else {\n      if (P[i] === -1) {\n        tmpD = createFn(data[i], i);\n      } else {\n        tmpD = nodes[P[i]];\n        noOp(tmpD, data[i]);\n      }\n      parent.insertBefore(tmpD, afterNode);\n      afterNode = tmpD;\n    }\n  }\n}\n\nexport default reconcile;\n\n// Picked from\n// https://github.com/adamhaile/surplus/blob/master/src/runtime/content.ts#L368\n\n// return an array of the indices of ns that comprise the longest increasing subsequence within ns\nfunction longestPositiveIncreasingSubsequence(ns, newStart) {\n  var seq = [],\n    is = [],\n    l = -1,\n    pre = new Array(ns.length);\n\n  for (var i = newStart, len = ns.length; i < len; i++) {\n    var n = ns[i];\n    if (n < 0) continue;\n    var j = findGreatestIndexLEQ(seq, n);\n    if (j !== -1) pre[i] = is[j];\n    if (j === l) {\n      l++;\n      seq[l] = n;\n      is[l] = i;\n    } else if (n < seq[j + 1]) {\n      seq[j + 1] = n;\n      is[j + 1] = i;\n    }\n  }\n\n  for (i = is[l]; l >= 0; i = pre[i], l--) {\n    seq[l] = i;\n  }\n\n  return seq;\n}\n\nfunction findGreatestIndexLEQ(seq, n) {\n  // invariant: lo is guaranteed to be index of a value <= n, hi to be >\n  // therefore, they actually start out of range: (-1, last + 1)\n  var lo = -1,\n    hi = seq.length;\n\n  // fast path for simple increasing sequences\n  if (hi > 0 && seq[hi - 1] <= n) return hi - 1;\n\n  while (hi - lo > 1) {\n    var mid = Math.floor((lo + hi) / 2);\n    if (seq[mid] > n) {\n      hi = mid;\n    } else {\n      lo = mid;\n    }\n  }\n\n  return lo;\n}\n","import { beforeCompute, compute } from \"./f\";\nimport { reuseNodes } from \"./reuse-nodes\";\nimport { FidanValue } from \".\";\nimport reconcile from \"./reconcile\";\n\nexport const htmlProps = {\n  id: true,\n  nodeValue: true,\n  textContent: true,\n  className: true,\n  innerHTML: true,\n  innerText: true,\n  tabIndex: true,\n  value: true,\n  checked: true,\n  disabled: true,\n  readonly: true,\n  contentEditable: true\n};\n\nexport const insertToDom = (parentElement, index, itemElement) => {\n  const typeOf = typeof itemElement;\n  if (typeOf === \"function\") {\n    itemElement(parentElement);\n  } else {\n    if (typeOf !== \"object\") {\n      itemElement = document.createTextNode(itemElement);\n    }\n    parentElement.insertBefore(itemElement, parentElement.children[index]);\n  }\n};\n\nexport const arrayMap = <T>(\n  arr: FidanValue<T[]>,\n  parentDom: Node & ParentNode,\n  nextElement: Element,\n  renderCallback: (item: any, idx?: number, isInsert?: boolean) => Node,\n  renderMode?: \"reuse\" | \"reconcile\"\n) => {\n  // const prevElement = document.createDocumentFragment();\n  const prevElement = nextElement ? document.createTextNode(\"\") : undefined;\n  nextElement && parentDom.insertBefore(prevElement, nextElement);\n  beforeCompute(\n    arr.$val,\n    (nextVal, opt) => {\n      const beforeVal = opt.computedItem.$val;\n      if (!renderMode) {\n        const parentFragment = document.createDocumentFragment();\n        parentDom.textContent = \"\";\n        for (var i = 0; i < nextVal.length; i++) {\n          insertToDom(parentFragment, i, renderCallback(nextVal[i], i));\n        }\n        parentDom.appendChild(parentFragment);\n      } else {\n        let renderFunction: (\n          parent,\n          renderedValues,\n          data,\n          createFn,\n          noOp,\n          beforeNode?,\n          afterNode?\n        ) => void = renderMode === \"reconcile\" ? reconcile : reuseNodes;\n        renderFunction(\n          parentDom,\n          beforeVal || [],\n          nextVal || [],\n          (nextItem, index) => {\n            // create\n            return renderCallback(nextItem, index);\n          },\n          (nextItem, prevItem) => {\n            // update\n            // for (var key in nextItem) {\n            //   if (prevItem[key].hasOwnProperty(\"$val\")) {\n            //     nextItem[key].depends = prevItem[key].depends;\n            //     prevItem[key](nextItem[key]());\n            //   }\n            // }\n          },\n          prevElement,\n          nextElement\n        );\n      }\n    },\n    [arr]\n  );\n};\n","import { value } from \"./f\";\nimport { FidanValue, FidanArray, DataArrayEvents, ComputionMethodArguments } from \".\";\n\nexport const injectToProperty = (\n  obj: Object,\n  propertyKey: string,\n  val: FidanValue<any>\n) => {\n  // const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n  // if (descr.configurable)\n  Object.defineProperty(obj, propertyKey, {\n    configurable: true,\n    enumerable: true,\n    get: () => {\n      val();\n      return val;\n    },\n    set: v => (v.hasOwnProperty(\"$val\") ? (val = v) : val(v))\n  });\n  // else {\n  //   // descr.get().c_depends.push(val);\n  //   // val[\"c_depends\"].push(descr.get());\n  // }\n};\n\nexport const inject = <T extends Object>(obj: T): T => {\n  for (var key in obj) {\n    injectToProperty(obj, key, value(obj[key]));\n  }\n  return obj;\n};\n\nexport const debounce = (func, wait, immediate?) => {\n  let timeout;\n\n  return function () {\n    let context = this;\n    let args = arguments;\n    let later = function () {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    };\n    let callNow = immediate && !timeout;\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n};\n\nexport const transformToDataArrayEvents = <T>(\n  opt: ComputionMethodArguments<T[]>,\n  events: DataArrayEvents<T>\n) => {\n  /*\n    \"copyWithin\",\n    \"fill\",\n    \"pop\",\n    \"push\",\n    \"reverse\",\n    \"shift\",\n    \"sort\",\n    \"splice\",\n    \"unshift\"\n  */\n\n  const { method, computedItem, args } = opt;\n\n  if (method === \"push\") {\n    events.onAdd(args)\n  } else if (method === \"splice\") {\n    const start = args[0]\n    const deleteCount = args[1]\n    const addItems = args.slice(2)\n    const arr: any[] = computedItem.$val\n    events.onRemove(arr.slice(start, start + deleteCount))\n    events.onAdd(addItems)\n  }\n  // TODO yukardaki diğer metodlar implemente edilecek.\n}","import { compute } from \"./f\";\nimport { arrayMap, htmlProps } from \"./dom\";\nimport { FidanValue } from \".\";\n\nconst COMMENT_TEXT = 1;\nconst COMMENT_DOM = 2;\nconst COMMENT_FN = 4; // \"function\" && !isDynamic\nconst COMMENT_HTM = 8;\nconst COMMENT_TEXT_OR_DOM = COMMENT_TEXT | COMMENT_DOM;\n\nlet _templateMode = false; // TODO kaldırılacak yerine başka bir yöntem geliştirilecek\nlet template = document.createElement(\"template\");\n\nexport const coditionalDom = (\n  condition: () => boolean,\n  dependencies: FidanValue<any>[],\n  htmlFragment: DocumentFragment\n) => (parentElement: Element, nextElement: Element) => {\n  const childs = Array.from(htmlFragment.children);\n  let inserted = false;\n  compute(() => {\n    if (condition()) {\n      if (!inserted) {\n        let tmpNextElement = nextElement;\n        for (var i = childs.length - 1; i >= 0; i--) {\n          const child = childs[i];\n          tmpNextElement = parentElement.insertBefore(child, tmpNextElement);\n        }\n        inserted = true;\n      }\n    } else {\n      childs.forEach(child => child.remove());\n      inserted = false;\n    }\n  }, dependencies);\n};\n\nconst putCommentToTagStart = (\n  htm: string[],\n  index: number,\n  comment: string\n) => {\n  for (var i = index; i >= 0; i--) {\n    let item = htm[i];\n    let p = item.lastIndexOf(\"<\");\n    if (p !== -1) {\n      htm[i] = item.substr(0, p) + comment + item.substr(p);\n      // htm[i] =\n      //   item.substr(0, p) + comment + item.substr(p, item.lastIndexOf(\" \") - p);\n      // if (htm[index + 1].substr(0, 1) === '\"') {\n      //   htm[index + 1] = htm[index + 1].substr(1);\n      // }\n      break;\n    }\n  }\n};\n\nexport const html = (...args) => {\n  const htm: string[] = args[0].slice();\n  const params = args.slice(1);\n  let attributeName: string = null;\n  let i = 0;\n\n  for (var index = 0; index < htm.length; index++) {\n    let item = htm[index];\n    const param = params[index];\n    if (param === undefined) {\n      break;\n    }\n    const isDynamic = param && param.hasOwnProperty(\"$val\");\n    if (isDynamic) {\n      if (param[\"$indexes\"] === undefined) {\n        param[\"$indexes\"] = [];\n      }\n      param[\"$indexes\"].push(index);\n    }\n    if (item.endsWith('=\"')) {\n      i = item.lastIndexOf(\" \") + 1;\n      attributeName = item.substr(i, item.length - i - 2);\n      putCommentToTagStart(\n        htm,\n        index,\n        `<!-- cmt_${COMMENT_DOM}_${index}_${attributeName} -->`\n      );\n    } else {\n      let commentType =\n        typeof param === \"function\" && !isDynamic\n          ? COMMENT_FN\n          : typeof param === \"object\" && param\n          ? COMMENT_HTM\n          : COMMENT_TEXT;\n      htm[index] = item + `<!-- cmt_${commentType}_${index} -->`;\n    }\n  }\n  template = template.cloneNode(false) as HTMLTemplateElement;\n  template.innerHTML = htm.join(\"\");\n  /**    \n    .replace(/\\n/g, \"\")\n    .replace(/  /g, \" \")\n    .replace(/  /g, \"\")\n    .replace(/> /g, \">\")\n    .replace(/ </g, \"<\");\n     */\n  const element = template.content;\n  element[\"$params\"] = params;\n  if (!_templateMode) {\n    var commentNodes = [];\n    walkForCommentNodes(element, commentNodes);\n    updateNodesByCommentNodes(commentNodes, params);\n  }\n  return element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n  var treeWalker = document.createTreeWalker(\n    element,\n    NodeFilter.SHOW_COMMENT,\n    {\n      acceptNode: function(node) {\n        var nodeValue = node.nodeValue.trim();\n        return nodeValue.startsWith(\"cmt_\")\n          ? NodeFilter.FILTER_ACCEPT\n          : NodeFilter.FILTER_REJECT;\n      }\n    },\n    false\n  );\n\n  while (treeWalker.nextNode()) {\n    commentNodes.push(treeWalker.currentNode);\n  }\n};\n\nconst updateNodesByCommentNodes = (commentNodes: Comment[], params: any[]) => {\n  for (var i = 0; i < commentNodes.length; i++) {\n    const commentNode = commentNodes[i];\n    var commentValue = commentNode.nodeValue;\n    let element = null;\n    let attributeName: string = null;\n\n    let i1 = commentValue.indexOf(\"_\") + 1;\n    var i2 = commentValue.indexOf(\"_\", i1);\n    const commentType = parseInt(commentValue.substr(i1, i2 - i1));\n    i1 = commentValue.indexOf(\"_\", i2) + 1;\n    i2 = commentValue.indexOf(\"_\", i1);\n    if (i2 === -1) {\n      i2 = commentValue.indexOf(\" \", i1);\n    }\n    let paramIndex = parseInt(commentValue.substr(i1, i2 - i1));\n    let param = params[paramIndex];\n    const isDynamic = param && param.hasOwnProperty(\"$val\");\n\n    if (commentType & COMMENT_TEXT_OR_DOM) {\n      if (commentType === COMMENT_TEXT) {\n        attributeName = \"textContent\";\n        element = document.createTextNode(isDynamic ? param.$val : param);\n        commentNode.parentElement.insertBefore(\n          element,\n          commentNode.nextSibling\n        );\n        if (!isDynamic) {\n          if (Array.isArray(param)) {\n            for (var p = 0; p < param.length; p++) {\n              commentNode.parentElement.appendChild(param[p]);\n            }\n          }\n        }\n      } else if (commentType === COMMENT_DOM) {\n        attributeName = commentValue.substr(\n          i2 + 1,\n          commentValue.length - i2 - 2\n        );\n        element = commentNode.nextElementSibling;\n      }\n      // commentType !== COMMENT_FN && commentNode.remove();\n      if (attributeName.startsWith(\"on\")) {\n        (element as Element).addEventListener(attributeName.substr(2), param);\n      } else if (isDynamic) {\n        if (htmlProps[attributeName]) {\n          compute(\n            val => {\n              element[attributeName] = val;\n            },\n            [param]\n          );\n          element[attributeName] = param();\n        } else {\n          compute(\n            val => {\n              element.setAttribute(attributeName, val);\n            },\n            [param]\n          );\n          element.setAttribute(attributeName, param());\n        }\n      } else {\n        if (htmlProps[attributeName]) {\n          element[attributeName] = param;\n        } else if (typeof param === \"function\") {\n          param(element);\n        } else {\n          element.setAttribute(attributeName, param);\n        }\n      }\n    } else if (commentType === COMMENT_FN) {\n      if (commentNode.parentElement) {\n        param(commentNode.parentElement, commentNode.nextElementSibling);\n        // commentNode.remove();\n      } else {\n        //conditionalDom can be place on root\n        window.requestAnimationFrame(() => {\n          param(commentNode.parentElement, commentNode.nextElementSibling);\n          // commentNode.remove();\n        });\n      }\n    } else if (commentType === COMMENT_HTM) {\n      commentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n    }\n  }\n};\n\nexport const htmlArrayMap = <T>(\n  arr: FidanValue<T[]>,\n  renderCallback: (data: T) => DocumentFragment,\n  options?: {\n    useCloneNode: boolean;\n    renderMode?: \"reuse\" | \"reconcile\";\n  }\n) => {\n  options = Object.assign({ useCloneNode: false, reuseMode: false }, options);\n  if (options.useCloneNode) {\n    return (parentElement: Element, nextElement: Element) => {\n      let clonedNode = null;\n      let params = null;\n      let dataParamIndexes = [];\n      // let commentNodesAddresses: number[][] = null;\n      const arrayMapFn = data => {\n        let renderNode = null;\n        var commentNodes = [];\n        if (clonedNode === null) {\n          _templateMode = true;\n          renderNode = renderCallback(data);\n          _templateMode = false;\n          params = renderNode[\"$params\"];\n          for (var key in data) {\n            const indexes = data[key][\"$indexes\"];\n            if (indexes)\n              for (var i = 0; i < indexes.length; i++) {\n                dataParamIndexes.push(indexes[i], key);\n              }\n          }\n          clonedNode = renderNode.cloneNode(true);\n          // walkForCommentNodes(clonedNode, commentNodes);\n          // commentNodesAddresses = generateCommentNodesAddresses(commentNodes);\n        } else {\n          renderNode = clonedNode.cloneNode(true);\n        }\n        for (var i = 0; i < dataParamIndexes.length; i += 2) {\n          params[dataParamIndexes[i]] = data[dataParamIndexes[i + 1]];\n        }\n        // generateCommentNodesFromAddresses(\n        //   commentNodesAddresses,\n        //   renderNode,\n        //   commentNodes\n        // );\n        walkForCommentNodes(renderNode, commentNodes);\n        updateNodesByCommentNodes(commentNodes, params);\n        return renderNode;\n      };\n      arrayMap(arr, parentElement, nextElement, arrayMapFn, options.renderMode);\n    };\n  } else {\n    return function(parentElement: Element, nextElement: Element) {\n      arrayMap(arr as any, parentElement, nextElement, renderCallback);\n    };\n  }\n};\n\n// const generateCommentNodesAddresses = (commentNodes: Comment[]) => {\n//   const paths: number[][] = [];\n//   for (var i = 0; i < commentNodes.length; i++) {\n//     const path: number[] = [];\n//     let node = commentNodes[i] as Node & ChildNode;\n//     let parent = node.parentNode as Node & ParentNode;\n//     while (parent) {\n//       path.push(Array.from(parent.childNodes).indexOf(node));\n//       node = parent as any;\n//       parent = parent.parentNode;\n//     }\n//     paths.push(path.reverse());\n//   }\n//   return paths;\n// };\n// const generateCommentNodesFromAddresses = (\n//   commentNodesAddresses: number[][],\n//   element: Element,\n//   commentNodes: Comment[]\n// ) => {\n//   for (var i = 0; i < commentNodesAddresses.length; i++) {\n//     const path = commentNodesAddresses[i];\n//     let node = null;\n//     let parent = element;\n//     for (var p = 0; p < path.length; p++) {\n//       node = parent.childNodes.item(path[p]);\n//       parent = node;\n//     }\n//     commentNodes.push(node);\n//   }\n// };\n"],"names":["let","autoTrackDependencies","value","val","hasOwnProperty","innerFn","opt","undefined","indexOf","push","depends","length","i","beforeCompute","Array","isArray","overrideArrayMutators","compute","dependencies","deps","debugName","name","Object","defineProperty","toString","toJSON","fn","cmp","computedItem","$val","initalValue","const","dataArray","size","forEach","method","arr","slice","size1","ret","prototype","apply","arguments","size2","args","reuseNodes","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstChild","tmp","removeChild","textContent","tail","previousSibling","lastChild","_head","_mode","item","head","mode","insertBefore","appendChild","reconcile","nextElementSibling","firstElementChild","len","prevStart","newStart","loop","prevEnd","newEnd","a","b","prevStartNode","newStartNode","prevEndNode","previousElementSibling","lastElementChild","newEndNode","fixes","_node","next","P","I","Map","set","reusingNodes","toRemove","has","get","longestSeq","longestPositiveIncreasingSubsequence","nodes","tmpC","lisIdx","tmpD","ns","seq","is","l","pre","n","j","findGreatestIndexLEQ","lo","hi","mid","Math","floor","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","checked","disabled","readonly","contentEditable","insertToDom","parentElement","index","itemElement","typeOf","document","createTextNode","children","arrayMap","parentDom","nextElement","renderCallback","renderMode","prevElement","nextVal","beforeVal","parentFragment","createDocumentFragment","renderFunction","nextItem","prevItem","injectToProperty","obj","propertyKey","configurable","enumerable","v","inject","key","debounce","func","wait","immediate","timeout","context","later","callNow","clearTimeout","setTimeout","transformToDataArrayEvents","events","onAdd","start","deleteCount","addItems","onRemove","COMMENT_TEXT","COMMENT_DOM","COMMENT_FN","COMMENT_HTM","COMMENT_TEXT_OR_DOM","_templateMode","template","createElement","coditionalDom","condition","htmlFragment","childs","from","inserted","tmpNextElement","child","remove","putCommentToTagStart","htm","comment","p","lastIndexOf","substr","html","params","attributeName","param","isDynamic","endsWith","commentType","cloneNode","join","element","content","commentNodes","walkForCommentNodes","updateNodesByCommentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","trim","startsWith","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","commentNode","commentValue","i1","i2","parseInt","paramIndex","addEventListener","setAttribute","window","requestAnimationFrame","htmlArrayMap","options","assign","useCloneNode","reuseMode","clonedNode","dataParamIndexes","arrayMapFn","renderNode","indexes"],"mappings":"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"}