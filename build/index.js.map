{"version":3,"file":"index.js","sources":["../src/f.ts","../src/util.ts","../src/reconcile.ts","../src/reuse-nodes.ts","../src/html.ts"],"sourcesContent":["import { FidanValue, ComputionMethodArguments, FidanValueFn, FidanArray } from './types';\nconst simpleMutationMethods = [ 'pop', 'push', 'shift', 'splice', 'unshift' ];\nconst complexMutationMethods = [ 'copyWithin', 'fill', 'reverse', 'sort' ];\nconst mutationMethods = simpleMutationMethods.concat(complexMutationMethods);\nconst nonMutationmethods = [\n\t'concat',\n\t'entries',\n\t'every',\n\t'filter',\n\t'find',\n\t'findIndex',\n\t'forEach',\n\t'from',\n\t'includes',\n\t'indexOf',\n\t'isArray',\n\t'join',\n\t'keys',\n\t'lastIndexOf',\n\t'map',\n\t'reduce',\n\t'reduceRight',\n\t'slice',\n\t'some',\n\t'toString',\n\t'valueOf'\n];\n\nlet autoTracks: any[] = null;\n\nexport const value = <T>(val?: T): FidanValueFn<T> => {\n\tif (val && val.hasOwnProperty('$val')) return val as any;\n\tconst innerFn: any = (val?: T, opt?: ComputionMethodArguments<T>) => {\n\t\tif (val === undefined) {\n\t\t\tif (autoTracks && autoTracks.indexOf(innerFn) === -1) autoTracks.push(innerFn);\n\t\t\treturn innerFn['$val'];\n\t\t} else {\n\t\t\tconst updateAfter = Array.isArray(val);\n\t\t\tif (!updateAfter) {\n\t\t\t\tinnerFn['$val'] = val;\n\t\t\t}\n\t\t\tlet depends: FidanValue<any>[] = innerFn['c_depends'];\n\t\t\tif (depends.length)\n\t\t\t\tfor (var i = 0; i < depends.length; i++) {\n\t\t\t\t\tif (depends[i].compute) {\n\t\t\t\t\t\tdepends[i](depends[i].compute(val, { caller: innerFn }), { caller: depends[i] });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdepends[i](innerFn.$val, innerFn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\tif (updateAfter) {\n\t\t\t\tinnerFn['$val'] = val;\n\t\t\t}\n\t\t}\n\t};\n\n\tinnerFn['$val'] = val;\n\tinnerFn['c_depends'] = [];\n\tinnerFn.debugName = (name: string) => {\n\t\tObject.defineProperty(innerFn, 'name', { value: name });\n\t\treturn innerFn;\n\t};\n\tinnerFn.toString = innerFn.toJSON = () =>\n\t\tinnerFn['$val'] && innerFn['$val'].toJSON ? innerFn['$val'].toJSON() : innerFn['$val'];\n\tinnerFn.depends = (...deps: (FidanValue<any> | Function)[]): any => {\n\t\tfor (var i = 0; i < deps.length; i++) innerFn['c_depends'].push(deps[i]);\n\t\tinnerFn(innerFn()); //trigger to c_depends\n\t\treturn innerFn;\n\t};\n\n\tif (Array.isArray(val)) {\n\t\tcreateFidanArray(innerFn);\n\t}\n\n\treturn innerFn;\n};\n\nexport const computed = <T>(fn: (val: T, opt?: ComputionMethodArguments<T>) => any, dependencies?: any[]): any => {\n\tautoTracks = dependencies ? null : [];\n\tconst cmp = value<T>(undefined);\n\tconst val = fn(undefined, { caller: cmp } as any);\n\tcmp.$val = val;\n\tif (Array.isArray(val)) {\n\t\tcreateFidanArray(cmp as any);\n\t}\n\tconst deps = autoTracks ? autoTracks : dependencies;\n\tautoTracks = null;\n\tcmp['compute'] = fn;\n\tfor (var i = 0; i < deps.length; i++) deps[i]['c_depends'].push(cmp);\n\treturn cmp;\n};\n\nexport const createFidanArray = (dataArray: FidanArray<any[]>) => {\n\tif (dataArray.$val['$overrided']) return;\n\tdataArray.$val['$overrided'] = true;\n\tif (!dataArray.size) dataArray.size = value(dataArray.$val.length);\n\telse dataArray.size(dataArray.$val.length);\n\n\tnonMutationmethods.forEach((method) => {\n\t\tdataArray[method] = (...args) => dataArray.$val[method].apply(dataArray.$val, args);\n\t});\n\tdataArray['map'] = (renderFn, renderMode) => ({\n\t\tarr: dataArray,\n\t\trenderFn,\n\t\trenderMode\n\t});\n\tObject.defineProperty(dataArray, 'length', {\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t\tget: () => {\n\t\t\treturn dataArray.$val.length;\n\t\t},\n\t\tset: (v) => (dataArray.$val.length = v)\n\t});\n\tmutationMethods.forEach((method) => {\n\t\tdataArray[method] = function() {\n\t\t\tconst arr = dataArray.$val.slice(0);\n\t\t\tconst size1 = arr.length;\n\t\t\tconst ret = Array.prototype[method].apply(arr, arguments);\n\t\t\tconst size2 = arr.length;\n\t\t\tif (size1 !== size2) dataArray.size(size2);\n\t\t\t// TODO event based strategy for -> simpleMutationMethods\n\t\t\tdataArray(arr, {\n\t\t\t\tmethod,\n\t\t\t\tcaller: dataArray,\n\t\t\t\targs: [ ...arguments ]\n\t\t\t});\n\t\t\treturn ret;\n\t\t};\n\t});\n};\n","import { value } from './f';\nimport { FidanValue, FidanArray, DataArrayEvents, ComputionMethodArguments } from './types';\n\nexport const injectToProperty = (obj: Object, propertyKey: string, val: FidanValue<any>) => {\n\t// const descr = Object.getOwnPropertyDescriptor(obj, propertyKey);\n\t// if (descr.configurable)\n\tObject.defineProperty(obj, propertyKey, {\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t\tget: () => {\n\t\t\tval();\n\t\t\treturn val;\n\t\t},\n\t\tset: (v) => (v.hasOwnProperty('$val') ? (val = v) : val(v))\n\t});\n\t// else {\n\t//   // descr.get().c_depends.push(val);\n\t//   // val[\"c_depends\"].push(descr.get());\n\t// }\n};\n\nexport const inject = <T extends Object>(obj: T): T => {\n\tfor (var key in obj) {\n\t\tinjectToProperty(obj, key, value(obj[key]));\n\t}\n\treturn obj;\n};\n\nexport const debounce = (func, wait, immediate?) => {\n\tlet timeout;\n\n\treturn function() {\n\t\tlet context = this;\n\t\tlet args = arguments;\n\t\tlet later = function() {\n\t\t\ttimeout = null;\n\t\t\tif (!immediate) func.apply(context, args);\n\t\t};\n\t\tlet callNow = immediate && !timeout;\n\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t\tif (callNow) func.apply(context, args);\n\t};\n};\n","// Original: https://github.com/Freak613/stage0/blob/master/reconcile.js\n\nexport function reconcile(parent, renderedValues, data, createFn, noOp, beforeNode?, afterNode?) {\n\t// Fast path for clear\n\tif (data.length === 0) {\n\t\tif (beforeNode !== undefined || afterNode !== undefined) {\n\t\t\tlet node = beforeNode !== undefined ? beforeNode.nextSibling : parent.firstElementChild,\n\t\t\t\ttmp;\n\n\t\t\tif (afterNode === undefined) afterNode = null;\n\n\t\t\twhile (node && node !== afterNode) {\n\t\t\t\ttmp = node.nextSibling;\n\t\t\t\tparent.removeChild(node);\n\t\t\t\tnode = tmp;\n\t\t\t}\n\t\t} else {\n\t\t\tparent.textContent = '';\n\t\t}\n\t\treturn;\n\t}\n\n\t// Fast path for create\n\tif (renderedValues.length === 0) {\n\t\tlet node,\n\t\t\tmode = afterNode !== undefined ? 1 : 0;\n\t\tfor (let i = 0, len = data.length; i < len; i++) {\n\t\t\tnode = createFn(data[i], i);\n\t\t\tmode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n\t\t}\n\t\treturn;\n\t}\n\n\tlet prevStart = 0,\n\t\tnewStart = 0,\n\t\tloop = true,\n\t\tprevEnd = renderedValues.length - 1,\n\t\tnewEnd = data.length - 1,\n\t\ta,\n\t\tb,\n\t\tprevStartNode = beforeNode ? beforeNode.nextSibling : parent.firstElementChild,\n\t\tnewStartNode = prevStartNode,\n\t\tprevEndNode = afterNode ? afterNode.previousSibling : parent.lastElementChild,\n\t\tnewEndNode = prevEndNode;\n\n\tfixes: while (loop) {\n\t\tloop = false;\n\t\tlet _node;\n\n\t\t// Skip prefix\n\t\t(a = renderedValues[prevStart]), (b = data[newStart]);\n\t\twhile (a === b) {\n\t\t\tnoOp(prevStartNode, b);\n\t\t\tprevStart++;\n\t\t\tnewStart++;\n\t\t\tnewStartNode = prevStartNode = prevStartNode.nextSibling;\n\t\t\tif (prevEnd < prevStart || newEnd < newStart) break fixes;\n\t\t\ta = renderedValues[prevStart];\n\t\t\tb = data[newStart];\n\t\t}\n\n\t\t// Skip suffix\n\t\t(a = renderedValues[prevEnd]), (b = data[newEnd]);\n\t\twhile (a === b) {\n\t\t\tnoOp(prevEndNode, b);\n\t\t\tprevEnd--;\n\t\t\tnewEnd--;\n\t\t\tafterNode = prevEndNode;\n\t\t\tnewEndNode = prevEndNode = prevEndNode.previousSibling;\n\t\t\tif (prevEnd < prevStart || newEnd < newStart) break fixes;\n\t\t\ta = renderedValues[prevEnd];\n\t\t\tb = data[newEnd];\n\t\t}\n\n\t\t// Fast path to swap backward\n\t\t(a = renderedValues[prevEnd]), (b = data[newStart]);\n\t\twhile (a === b) {\n\t\t\tloop = true;\n\t\t\tnoOp(prevEndNode, b);\n\t\t\t_node = prevEndNode.previousSibling;\n\t\t\tparent.insertBefore(prevEndNode, newStartNode);\n\t\t\tnewEndNode = prevEndNode = _node;\n\t\t\tnewStart++;\n\t\t\tprevEnd--;\n\t\t\tif (prevEnd < prevStart || newEnd < newStart) break fixes;\n\t\t\ta = renderedValues[prevEnd];\n\t\t\tb = data[newStart];\n\t\t}\n\n\t\t// Fast path to swap forward\n\t\t(a = renderedValues[prevStart]), (b = data[newEnd]);\n\t\twhile (a === b) {\n\t\t\tloop = true;\n\t\t\tnoOp(prevStartNode, b);\n\t\t\t_node = prevStartNode.nextSibling;\n\t\t\tparent.insertBefore(prevStartNode, afterNode);\n\t\t\tprevStart++;\n\t\t\tafterNode = newEndNode = prevStartNode;\n\t\t\tprevStartNode = _node;\n\t\t\tnewEnd--;\n\t\t\tif (prevEnd < prevStart || newEnd < newStart) break fixes;\n\t\t\ta = renderedValues[prevStart];\n\t\t\tb = data[newEnd];\n\t\t}\n\t}\n\n\t// Fast path for shrink\n\tif (newEnd < newStart) {\n\t\tif (prevStart <= prevEnd) {\n\t\t\tlet next;\n\t\t\twhile (prevStart <= prevEnd) {\n\t\t\t\tif (prevEnd === 0) {\n\t\t\t\t\tparent.removeChild(prevEndNode);\n\t\t\t\t} else {\n\t\t\t\t\tnext = prevEndNode.previousSibling;\n\t\t\t\t\tparent.removeChild(prevEndNode);\n\t\t\t\t\tprevEndNode = next;\n\t\t\t\t}\n\t\t\t\tprevEnd--;\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\t// Fast path for add\n\tif (prevEnd < prevStart) {\n\t\tif (newStart <= newEnd) {\n\t\t\tlet node,\n\t\t\t\tmode = afterNode ? 1 : 0;\n\t\t\twhile (newStart <= newEnd) {\n\t\t\t\tnode = createFn(data[newStart], newStart);\n\t\t\t\tmode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n\t\t\t\tnewStart++;\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\t// Positions for reusing nodes from current DOM state\n\tconst P = new Array(newEnd + 1 - newStart);\n\tfor (let i = newStart; i <= newEnd; i++) P[i] = -1;\n\n\t// Index to resolve position from current to new\n\tconst I = new Map();\n\tfor (let i = newStart; i <= newEnd; i++) I.set(data[i], i);\n\n\tlet reusingNodes = newStart + data.length - 1 - newEnd,\n\t\ttoRemove = [];\n\n\tfor (let i = prevStart; i <= prevEnd; i++) {\n\t\tif (I.has(renderedValues[i])) {\n\t\t\tP[I.get(renderedValues[i])] = i;\n\t\t\treusingNodes++;\n\t\t} else {\n\t\t\ttoRemove.push(i);\n\t\t}\n\t}\n\n\t// Fast path for full replace\n\tif (reusingNodes === 0) {\n\t\tif (beforeNode !== undefined || afterNode !== undefined) {\n\t\t\tlet node = beforeNode !== undefined ? beforeNode.nextSibling : parent.firstElementChild,\n\t\t\t\ttmp;\n\n\t\t\tif (afterNode === undefined) afterNode = null;\n\n\t\t\twhile (node !== afterNode) {\n\t\t\t\ttmp = node.nextSibling;\n\t\t\t\tparent.removeChild(node);\n\t\t\t\tnode = tmp;\n\t\t\t\tprevStart++;\n\t\t\t}\n\t\t} else {\n\t\t\tparent.textContent = '';\n\t\t}\n\n\t\tlet node,\n\t\t\tmode = afterNode ? 1 : 0;\n\t\tfor (let i = newStart; i <= newEnd; i++) {\n\t\t\tnode = createFn(data[i], i);\n\t\t\tmode ? parent.insertBefore(node, afterNode) : parent.appendChild(node);\n\t\t}\n\n\t\treturn;\n\t}\n\n\t// What else?\n\tconst longestSeq = longestPositiveIncreasingSubsequence(P, newStart);\n\n\t// Collect nodes to work with them\n\tconst nodes = [];\n\tlet tmpC = prevStartNode;\n\tfor (let i = prevStart; i <= prevEnd; i++) {\n\t\tnodes[i] = tmpC;\n\t\ttmpC = tmpC.nextSibling;\n\t}\n\n\tfor (let i = 0; i < toRemove.length; i++) parent.removeChild(nodes[toRemove[i]]);\n\n\tlet lisIdx = longestSeq.length - 1,\n\t\ttmpD;\n\tfor (let i = newEnd; i >= newStart; i--) {\n\t\tif (longestSeq[lisIdx] === i) {\n\t\t\tafterNode = nodes[P[longestSeq[lisIdx]]];\n\t\t\tnoOp(afterNode, data[i]);\n\t\t\tlisIdx--;\n\t\t} else {\n\t\t\tif (P[i] === -1) {\n\t\t\t\ttmpD = createFn(data[i], i);\n\t\t\t} else {\n\t\t\t\ttmpD = nodes[P[i]];\n\t\t\t\tnoOp(tmpD, data[i]);\n\t\t\t}\n\t\t\tparent.insertBefore(tmpD, afterNode);\n\t\t\tafterNode = tmpD;\n\t\t}\n\t}\n}\n\nexport default reconcile;\n\n// Picked from\n// https://github.com/adamhaile/surplus/blob/master/src/runtime/content.ts#L368\n\n// return an array of the indices of ns that comprise the longest increasing subsequence within ns\nfunction longestPositiveIncreasingSubsequence(ns, newStart) {\n\tvar seq = [],\n\t\tis = [],\n\t\tl = -1,\n\t\tpre = new Array(ns.length);\n\n\tfor (var i = newStart, len = ns.length; i < len; i++) {\n\t\tvar n = ns[i];\n\t\tif (n < 0) continue;\n\t\tvar j = findGreatestIndexLEQ(seq, n);\n\t\tif (j !== -1) pre[i] = is[j];\n\t\tif (j === l) {\n\t\t\tl++;\n\t\t\tseq[l] = n;\n\t\t\tis[l] = i;\n\t\t} else if (n < seq[j + 1]) {\n\t\t\tseq[j + 1] = n;\n\t\t\tis[j + 1] = i;\n\t\t}\n\t}\n\n\tfor (i = is[l]; l >= 0; i = pre[i], l--) {\n\t\tseq[l] = i;\n\t}\n\n\treturn seq;\n}\n\nfunction findGreatestIndexLEQ(seq, n) {\n\t// invariant: lo is guaranteed to be index of a value <= n, hi to be >\n\t// therefore, they actually start out of range: (-1, last + 1)\n\tvar lo = -1,\n\t\thi = seq.length;\n\n\t// fast path for simple increasing sequences\n\tif (hi > 0 && seq[hi - 1] <= n) return hi - 1;\n\n\twhile (hi - lo > 1) {\n\t\tvar mid = Math.floor((lo + hi) / 2);\n\t\tif (seq[mid] > n) {\n\t\t\thi = mid;\n\t\t} else {\n\t\t\tlo = mid;\n\t\t}\n\t}\n\n\treturn lo;\n}\n","// Original: https://github.com/Freak613/stage0/blob/master/reuseNodes.js\n\nexport const reuseNodes = (parent, renderedValues, data, createFn, noOp, beforeNode?, afterNode?) => {\n\tif (data.length === 0) {\n\t\tif (beforeNode !== undefined || afterNode !== undefined) {\n\t\t\tlet node = beforeNode !== undefined ? beforeNode.nextSibling : parent.firstChild,\n\t\t\t\ttmp;\n\n\t\t\tif (afterNode === undefined) afterNode = null;\n\n\t\t\twhile (node && node !== afterNode) {\n\t\t\t\ttmp = node.nextSibling;\n\t\t\t\tparent.removeChild(node);\n\t\t\t\tnode = tmp;\n\t\t\t}\n\t\t} else {\n\t\t\tparent.textContent = '';\n\t\t}\n\t\treturn;\n\t}\n\tif (renderedValues.length > data.length) {\n\t\tlet i = renderedValues.length,\n\t\t\ttail = afterNode !== undefined ? afterNode.previousSibling : parent.lastChild,\n\t\t\ttmp;\n\t\twhile (i > data.length) {\n\t\t\ttmp = tail.previousSibling;\n\t\t\tparent.removeChild(tail);\n\t\t\ttail = tmp;\n\t\t\ti--;\n\t\t}\n\t}\n\n\tlet _head = beforeNode ? beforeNode.nextSibling : parent.firstChild;\n\tif (_head === afterNode) _head = undefined;\n\n\tlet _mode = afterNode ? 1 : 0;\n\tfor (let i = 0, item, head = _head, mode = _mode; i < data.length; i++) {\n\t\titem = data[i];\n\t\tif (head) {\n\t\t\tnoOp(item, renderedValues[i]);\n\t\t} else {\n\t\t\thead = createFn(item, i);\n\t\t\tmode ? parent.insertBefore(head, afterNode) : parent.appendChild(head);\n\t\t}\n\t\thead = head.nextSibling;\n\t\tif (head === afterNode) head = null;\n\t}\n};\n","// https://github.com/ismail-codar/fidan/blob/master/src/html.ts\n\nimport { computed } from './f';\nimport { FidanValue } from './types';\nimport reconcile from './reconcile';\nimport { reuseNodes } from './reuse-nodes';\n\nconst TEXT = 1;\nconst DOM = 2;\nconst FN = 4; // \"function\" && !isDynamic\nconst HTM = 8;\nconst ARRAY = 16;\nconst TEXT_OR_DOM = TEXT | DOM;\n\nexport const htmlProps = {\n\tid: true,\n\tnodeValue: true,\n\ttextContent: true,\n\tclassName: true,\n\tinnerHTML: true,\n\tinnerText: true,\n\ttabIndex: true,\n\tvalue: true,\n\tchecked: true,\n\tdisabled: true,\n\treadonly: true,\n\tcontentEditable: true\n};\n\nlet template = document.createElement('template');\n\nexport const html = (literals, ...vars): DocumentFragment => {\n\tlet raw = literals.raw,\n\t\tresult = '',\n\t\ti = 0,\n\t\tlen = vars.length,\n\t\tstr = '';\n\n\twhile (i < len) {\n\t\tstr = raw[i];\n\t\tif (str.startsWith('\"')) {\n\t\t\tstr = str.substr(1);\n\t\t}\n\t\tif (raw[i].endsWith('=\"')) {\n\t\t\t//attributes\n\t\t\tvar p = str.lastIndexOf(' ') + 1;\n\t\t\tvar attr = str.substr(p, str.length - p - 2);\n\t\t\tp = str.lastIndexOf('<');\n\t\t\tvar comment = '<!--$cmt_' + attr + '-->';\n\t\t\tif (p === -1) {\n\t\t\t\t//next attributes\n\t\t\t\tp = result.lastIndexOf('<');\n\t\t\t\tresult =\n\t\t\t\t\tresult.substr(0, p) +\n\t\t\t\t\tcomment +\n\t\t\t\t\tresult.substr(p) +\n\t\t\t\t\tstr.substr(0, str.length - attr.length - 3).trim();\n\t\t\t} else {\n\t\t\t\t// fist attribute\n\t\t\t\tresult += str.substr(0, p) + comment + str.substr(p, str.length - p - attr.length - 3).trim();\n\t\t\t}\n\t\t} else {\n\t\t\t//text nodes\n\t\t\tresult += str + '<!--$cmt' + '-->';\n\t\t}\n\t\ti++;\n\t}\n\tlet extra = raw[raw.length - 1];\n\tif (extra.startsWith('\"')) {\n\t\textra = extra.substr(1);\n\t}\n\tresult += extra;\n\n\ttemplate = template.cloneNode(false) as HTMLTemplateElement;\n\ttemplate.innerHTML = result;\n\n\tconst element = template.content;\n\tconst commentNodes = [];\n\twalkForCommentNodes(element, commentNodes);\n\tupdateNodesByCommentNodes(commentNodes, vars);\n\n\treturn element;\n};\n\nconst walkForCommentNodes = (element, commentNodes) => {\n\tvar treeWalker = document.createTreeWalker(\n\t\telement,\n\t\tNodeFilter.SHOW_COMMENT,\n\t\t{\n\t\t\tacceptNode: function(node) {\n\t\t\t\tvar nodeValue = node.nodeValue.trim();\n\t\t\t\treturn nodeValue.startsWith('$cmt') ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;\n\t\t\t}\n\t\t},\n\t\tfalse\n\t);\n\n\twhile (treeWalker.nextNode()) {\n\t\tcommentNodes.push(treeWalker.currentNode);\n\t}\n};\n\nconst updateNodesByCommentNodes = (commentNodes: Comment[], params: any[]) => {\n\tfor (var i = 0; i < commentNodes.length; i++) {\n\t\tconst commentNode = commentNodes[i];\n\t\tvar commentValue = commentNode.nodeValue;\n\t\tlet element = null;\n\t\tlet attributeName: string = null;\n\t\tlet param = params[i];\n\t\tconst isDynamic = param && param.hasOwnProperty('$val');\n\n\t\tconst attrIdx = commentValue.indexOf('_');\n\t\tconst paramType =\n\t\t\tattrIdx !== -1\n\t\t\t\t? DOM\n\t\t\t\t: typeof param === 'function' && !isDynamic\n\t\t\t\t\t? FN\n\t\t\t\t\t: Array.isArray(param) ? ARRAY : typeof param === 'object' && param ? HTM : TEXT;\n\n\t\tif (paramType & TEXT_OR_DOM) {\n\t\t\tif (paramType === TEXT) {\n\t\t\t\tattributeName = 'textContent';\n\t\t\t\telement = document.createTextNode(isDynamic ? param.$val : param);\n\t\t\t\tcommentNode.parentElement.insertBefore(element, commentNode.nextSibling);\n\t\t\t\tif (!isDynamic) {\n\t\t\t\t\tif (Array.isArray(param)) {\n\t\t\t\t\t\tfor (var p = 0; p < param.length; p++) {\n\t\t\t\t\t\t\tcommentNode.parentElement.appendChild(param[p]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (paramType === DOM) {\n\t\t\t\tattributeName = commentValue.substr(attrIdx + 1);\n\t\t\t\telement = commentNode.nextElementSibling;\n\t\t\t}\n\t\t\tparamType !== FN && commentNode.remove();\n\t\t\tif (attributeName.startsWith('on')) {\n\t\t\t\t(element as Element).addEventListener(attributeName.substr(2), param);\n\t\t\t} else if (isDynamic) {\n\t\t\t\tif (htmlProps[attributeName]) {\n\t\t\t\t\tcomputed(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\telement[attributeName] = param();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[ param ]\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tcomputed(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\telement.setAttribute(attributeName, param());\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[ param ]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (htmlProps[attributeName]) {\n\t\t\t\t\telement[attributeName] = param;\n\t\t\t\t} else if (typeof param === 'function') {\n\t\t\t\t\tparam(element);\n\t\t\t\t} else {\n\t\t\t\t\telement.setAttribute(attributeName, param);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (paramType === FN) {\n\t\t\tif (commentNode.parentElement) {\n\t\t\t\tparam(commentNode.parentElement, commentNode.nextElementSibling);\n\t\t\t\tcommentNode.remove();\n\t\t\t} else {\n\t\t\t\t//conditionalDom can be place on root\n\t\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t\tparam(commentNode.parentElement, commentNode.nextElementSibling);\n\t\t\t\t\tcommentNode.remove();\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (paramType === ARRAY) {\n\t\t\tconst fragment = document.createDocumentFragment();\n\t\t\tparam.forEach((p) => {\n\t\t\t\tfragment.appendChild(p);\n\t\t\t});\n\t\t\tcommentNode.parentElement.insertBefore(fragment, commentNode.nextSibling);\n\t\t} else if (paramType === HTM) {\n\t\t\tif (param.renderFn) {\n\t\t\t\tarrayMap(\n\t\t\t\t\tparam.arr,\n\t\t\t\t\tcommentNode.parentElement,\n\t\t\t\t\tcommentNode.nextSibling as any,\n\t\t\t\t\tparam.renderFn,\n\t\t\t\t\tparam.renderMode\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tcommentNode.parentElement.insertBefore(param, commentNode.nextSibling);\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport const arrayMap = <T>(\n\tarr: FidanValue<T[]>,\n\tparentDom: Node & ParentNode,\n\tnextElement: Element,\n\trenderCallback: (item: any, idx?: number, isInsert?: boolean) => Node,\n\trenderMode: 'reuse' | 'reconcile' = 'reconcile'\n) => {\n\tconst prevElement = nextElement ? document.createTextNode('') : undefined;\n\tnextElement && parentDom.insertBefore(prevElement, nextElement);\n\tcomputed<any[]>(\n\t\t(nextVal, { caller }) => {\n\t\t\tconst beforeVal = caller.$val;\n\t\t\tconst renderFunction: (parent, renderedValues, data, createFn, noOp, beforeNode?, afterNode?) => void =\n\t\t\t\trenderMode === 'reconcile' ? reconcile : reuseNodes;\n\t\t\trenderFunction(\n\t\t\t\tparentDom,\n\t\t\t\tbeforeVal || [],\n\t\t\t\tnextVal || [],\n\t\t\t\t(nextItem, index) => {\n\t\t\t\t\tlet rendered = renderCallback(nextItem, index) as any;\n\t\t\t\t\treturn rendered instanceof Node ? rendered : document.createTextNode(rendered);\n\t\t\t\t},\n\t\t\t\t() => {},\n\t\t\t\tprevElement,\n\t\t\t\tnextElement\n\t\t\t);\n\t\t},\n\t\t[ arr ]\n\t);\n\tconst nextVal = arr.$val.slice(0);\n\tarr.$val = [];\n\tarr(nextVal);\n};\n"],"names":["simpleMutationMethods","complexMutationMethods","mutationMethods","concat","nonMutationmethods","autoTracks","value","val","hasOwnProperty","innerFn","opt","undefined","indexOf","push","updateAfter","Array","isArray","depends","length","i","compute","caller","$val","debugName","name","Object","defineProperty","toString","toJSON","deps","createFidanArray","computed","fn","dependencies","cmp","dataArray","size","forEach","method","apply","renderFn","renderMode","arr","configurable","enumerable","get","set","v","slice","size1","ret","prototype","arguments","size2","args","injectToProperty","obj","propertyKey","inject","key","debounce","func","wait","immediate","timeout","context","later","callNow","clearTimeout","setTimeout","reconcile","parent","renderedValues","data","createFn","noOp","beforeNode","afterNode","node","nextSibling","firstElementChild","tmp","removeChild","textContent","mode","len","insertBefore","appendChild","prevStart","newStart","loop","prevEnd","newEnd","a","b","prevStartNode","newStartNode","prevEndNode","previousSibling","lastElementChild","newEndNode","fixes","_node","next","P","I","Map","reusingNodes","toRemove","has","longestSeq","longestPositiveIncreasingSubsequence","nodes","tmpC","lisIdx","tmpD","ns","seq","is","l","pre","n","j","findGreatestIndexLEQ","lo","hi","mid","Math","floor","reuseNodes","firstChild","tail","lastChild","_head","_mode","item","head","TEXT","DOM","FN","HTM","ARRAY","TEXT_OR_DOM","htmlProps","id","nodeValue","className","innerHTML","innerText","tabIndex","checked","disabled","readonly","contentEditable","template","document","createElement","html","literals","vars","raw","result","str","startsWith","substr","endsWith","p","lastIndexOf","attr","comment","trim","extra","cloneNode","element","content","commentNodes","walkForCommentNodes","updateNodesByCommentNodes","treeWalker","createTreeWalker","NodeFilter","SHOW_COMMENT","acceptNode","FILTER_ACCEPT","FILTER_REJECT","nextNode","currentNode","params","commentNode","commentValue","attributeName","param","isDynamic","attrIdx","paramType","createTextNode","parentElement","nextElementSibling","remove","addEventListener","setAttribute","window","requestAnimationFrame","fragment","createDocumentFragment","arrayMap","parentDom","nextElement","renderCallback","prevElement","nextVal","beforeVal","renderFunction","nextItem","index","rendered","Node"],"mappings":"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"}